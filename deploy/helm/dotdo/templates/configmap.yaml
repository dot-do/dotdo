apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ include "dotdo.configMapName" . }}
  labels:
    {{- include "dotdo.labels" . | nindent 4 }}
data:
  # Node.js environment
  NODE_ENV: {{ .Values.env.NODE_ENV | quote }}
  LOG_LEVEL: {{ .Values.env.LOG_LEVEL | quote }}

  # Database configuration
  {{- if .Values.env.TURSO_URL }}
  TURSO_URL: {{ .Values.env.TURSO_URL | quote }}
  {{- end }}

  # Object storage (R2-compatible)
  {{- if .Values.env.R2_ENDPOINT }}
  R2_ENDPOINT: {{ .Values.env.R2_ENDPOINT | quote }}
  {{- end }}
  {{- if .Values.env.R2_BUCKET }}
  R2_BUCKET: {{ .Values.env.R2_BUCKET | quote }}
  {{- end }}

  # Cross-pod communication
  {{- if .Values.env.REDIS_URL }}
  REDIS_URL: {{ .Values.env.REDIS_URL | quote }}
  {{- end }}

  # Durable Objects configuration
  DO_MAX_CONCURRENT: {{ .Values.env.DO_MAX_CONCURRENT | quote }}
  DO_IDLE_TIMEOUT: {{ .Values.env.DO_IDLE_TIMEOUT | quote }}
  DO_RPC_TIMEOUT: {{ .Values.env.DO_RPC_TIMEOUT | quote }}

  # Service discovery
  SERVICE_NAME: {{ include "dotdo.fullname" . | quote }}
  HEADLESS_SERVICE: {{ include "dotdo.fullname" . }}-headless
  SERVICE_PORT: {{ .Values.service.port | quote }}
  RPC_PORT: {{ .Values.service.rpcPort | quote }}
