---
title: trigger.do
description: Edge-native background jobs on Cloudflare Workers with Durable Object storage and zero cold starts.
---

# trigger.do

**Background Jobs on the Edge** - Trigger.dev-compatible task execution running entirely on Cloudflare Workers, with zero cold starts, unlimited duration, and global edge deployment.

```typescript
import { task, wait, configure } from '@dotdo/trigger'
import { CFWorkflowsBackend } from '@dotdo/workflows/backends'

// Configure for production edge execution
configure({
  storage: new CFWorkflowsBackend(env.MY_WORKFLOW),
})

export const processOrder = task({
  id: 'process-order',
  run: async (payload, { ctx }) => {
    const user = await ctx.run('fetch-user', async () => {
      return await db.users.findById(payload.userId)
    })

    await wait.for({ minutes: 5 })  // FREE on CF Workflows!

    await ctx.run('send-email', async () => {
      await email.send(user.email, 'order-confirmed', payload)
    })

    return { orderId: payload.orderId, status: 'processed' }
  },
})
```

<Callout type="info">
Looking for a testing/development setup? See [@dotdo/trigger](/docs/integrations/trigger/package) for in-memory execution without infrastructure.
</Callout>

## Why trigger.do?

Traditional background job systems require separate infrastructure, have cold start latency, and charge per execution. trigger.do eliminates all of that by running directly on Cloudflare's edge network:

- **Zero Cold Starts** - V8 isolates start instantly, no container spin-up
- **Global by Default** - Tasks execute at the edge, close to your users
- **Trigger.dev Compatible** - Drop-in replacement for @trigger.dev/sdk/v3
- **Unlimited Duration** - Durable Objects have no time limits
- **FREE Sleep** - Wait operations on CF Workflows don't cost anything
- **Serverless Economics** - Pay only for actual compute, not idle time

## Features

| Feature | Trigger.dev | trigger.do |
|---------|-------------|------------|
| **API compatibility** | - | 100% v3 API |
| **Payloads leave infra** | Yes | No |
| **Cold start** | ~100ms | 0ms (V8 isolates) |
| **Global edge** | Limited regions | 300+ cities |
| **Max duration** | Varies by plan | Unlimited (DO) |
| **Pricing** | Per-task run | Included in compute |
| **Self-hosted** | Enterprise only | Always available |
| **DO integration** | N/A | Native |
| **CF Workflows** | N/A | Native backend |

### Core Capabilities

| Capability | Description |
|------------|-------------|
| **Task definition** | Full Trigger.dev v3 API support |
| **Durable execution** | ctx.run() steps persist and replay |
| **Retry configuration** | Exponential, linear, and preset strategies |
| **Queue management** | Concurrency limits, rate limiting |
| **Scheduled tasks** | Native cron trigger support |
| **Batch operations** | Efficient batch trigger and await |
| **Run observability** | Status tracking, result polling, cancellation |

## Installation

```bash
npm install @dotdo/trigger
```

## Backend Options

trigger.do supports multiple execution backends - choose based on your workload:

| Backend | Best For | Durability | Max Duration | Cost Model |
|---------|----------|------------|--------------|------------|
| **Durable Objects** | Real-time, interactive | Transactional | Unlimited | Wall-clock billing |
| **CF Workflows** | Background jobs, long waits | Event-sourced | 24h | CPU-only (sleep is FREE) |
| **Pipelines** | High-throughput batch | At-least-once | 5m/step | Batch writes |

### Durable Objects Backend

Best for real-time tasks and unlimited duration:

```typescript
import { task, configure } from '@dotdo/trigger'

export class MyDO extends DurableObject {
  constructor(ctx: DurableObjectState, env: Env) {
    super(ctx, env)

    // Configure trigger.do to use DO storage
    configure({
      state: ctx.state,
    })
  }

  async processOrder(payload: OrderPayload) {
    // Tasks execute within the DO context
    const result = await processOrder.triggerAndWait(payload)
    return result
  }
}
```

### Cloudflare Workflows Backend

Best for background jobs where sleep time should be free:

```typescript
import { configure } from '@dotdo/trigger'
import { CFWorkflowsBackend } from '@dotdo/workflows/backends'

// Use CF Workflows backend for cost-efficient background jobs
configure({
  storage: new CFWorkflowsBackend(env.MY_WORKFLOW),
})

// Sleep operations are FREE - only billed for actual CPU time
export const longRunningTask = task({
  id: 'long-running',
  run: async (payload, { ctx }) => {
    await ctx.run('step-1', async () => {
      // Do some work
    })

    // This 24-hour wait costs nothing!
    await wait.for({ hours: 24 })

    await ctx.run('step-2', async () => {
      // Continue after the wait
    })
  },
})
```

## Quick Start

### Deploy to Cloudflare Workers

```typescript
// src/index.ts
import { task, configure } from '@dotdo/trigger'

export default {
  async fetch(request: Request, env: Env) {
    configure({ state: env.TASK_STATE })

    const processWebhook = task({
      id: 'process-webhook',
      run: async (payload: WebhookPayload) => {
        // Process the webhook
        return { processed: true }
      },
    })

    const body = await request.json()
    const result = await processWebhook.triggerAndWait(body)

    return Response.json(result)
  },
}
```

```jsonc
// wrangler.jsonc
{
  "name": "my-trigger-app",
  "main": "src/index.ts",
  "compatibility_date": "2025-01-01",
  "compatibility_flags": ["nodejs_compat"],
  "durable_objects": {
    "bindings": [{ "name": "TASK_STATE", "class_name": "TaskStateDO" }]
  },
  "migrations": [{ "tag": "v1", "new_sqlite_classes": ["TaskStateDO"] }]
}
```

```bash
npx wrangler deploy
```

## Examples

### Order Processing Workflow

```typescript
import { task, retry, abort } from '@dotdo/trigger'

export const processOrder = task({
  id: 'process-order',
  retry: retry.exponential(5),

  run: async (payload, { ctx }) => {
    // Validate
    const order = await ctx.run('validate', async () => {
      const order = await db.orders.findById(payload.orderId)
      if (!order) abort('Order not found')
      return order
    })

    // Charge payment
    const payment = await ctx.run('charge', async () => {
      return await stripe.paymentIntents.create({
        amount: order.total,
        customer: order.customerId,
      })
    })

    // Fulfill
    await ctx.run('fulfill', async () => {
      await inventory.reserve(order.items)
      await shipping.createLabel(order)
    })

    // Notify
    await ctx.run('notify', async () => {
      await email.send(order.email, 'order-confirmation', { order })
    })

    return { orderId: order.id, paymentId: payment.id }
  },
})
```

### Scheduled Reports

```typescript
import { schedules } from '@dotdo/trigger'

export const dailyDigest = schedules({
  id: 'daily-digest',
  cron: '0 8 * * *',  // 8 AM daily
  timezone: 'America/New_York',

  run: async (payload, { ctx }) => {
    const stats = await ctx.run('gather-stats', async () => {
      return await analytics.getDailyStats()
    })

    const users = await ctx.run('get-subscribers', async () => {
      return await db.users.findSubscribers()
    })

    await ctx.run('send-emails', async () => {
      await Promise.all(
        users.map(user => email.send(user.email, 'daily-digest', stats))
      )
    })

    return { sentTo: users.length }
  },
})
```

### Webhook Processing with Queue

```typescript
import { task, queue } from '@dotdo/trigger'

export const processWebhook = task({
  id: 'process-webhook',
  queue: queue.create('webhooks', { concurrency: 50 }),

  run: async (payload, { ctx }) => {
    const { event, data } = payload

    switch (event) {
      case 'customer.created':
        await ctx.run('sync-crm', () => crm.createContact(data))
        break

      case 'payment.succeeded':
        await ctx.run('update-subscription', () =>
          db.subscriptions.activate(data.subscriptionId)
        )
        break

      case 'subscription.cancelled':
        await ctx.run('cleanup', () =>
          db.subscriptions.deactivate(data.subscriptionId)
        )
        break
    }

    return { processed: event }
  },
})
```

### Long-Running Data Pipeline

```typescript
import { task, wait } from '@dotdo/trigger'

export const dataPipeline = task({
  id: 'data-pipeline',

  run: async (payload, { ctx }) => {
    // Step 1: Start data export
    const exportJob = await ctx.run('start-export', async () => {
      return await datawarehouse.startExport(payload.query)
    })

    // Wait for export to complete (FREE on CF Workflows!)
    let status = 'running'
    while (status === 'running') {
      await wait.for({ minutes: 1 })
      status = await ctx.run(`check-status-${Date.now()}`, async () => {
        return await datawarehouse.getJobStatus(exportJob.id)
      })
    }

    // Step 2: Process the exported data
    const results = await ctx.run('process-data', async () => {
      return await transform.process(exportJob.outputPath)
    })

    // Step 3: Upload to destination
    await ctx.run('upload-results', async () => {
      await destination.upload(results)
    })

    return { rowsProcessed: results.length }
  },
})
```

## Outbound Mode - Connecting to Trigger.dev

For hybrid deployments, you can forward tasks to real Trigger.dev infrastructure:

```typescript
import { Stripe } from '@dotdo/trigger/outbound'

// Configure to forward to Trigger.dev
const trigger = new TriggerClient({
  apiKey: env.TRIGGER_DEV_API_KEY,
  apiUrl: 'https://api.trigger.dev',
})

// Tasks forward to Trigger.dev
export const myTask = trigger.defineTask({
  id: 'my-task',
  run: async (payload) => {
    // Executes on Trigger.dev infrastructure
  },
})
```

## Architecture

```
+-------------------------------------------------------------+
|                    Your Application                          |
|                                                              |
|  const task = task({ id: 'my-task', run: ... })             |
|  await task.trigger({ orderId: '123' })                      |
+-------------------------------------------------------------+
                              |
              +---------------+---------------+
              |                               |
              v                               v
+-------------------------+     +-------------------------+
|   Durable Objects        |     |   Cloudflare Workflows  |
+-------------------------+     +-------------------------+
|                         |     |                         |
|  - Real-time execution  |     |  - CPU-only billing     |
|  - Unlimited duration   |     |  - Sleep is FREE        |
|  - Transactional        |     |  - Up to 24h duration   |
|  - WebSocket support    |     |  - Event-sourced        |
|                         |     |                         |
+-------------------------+     +-------------------------+
                              |
                              v
+-------------------------------------------------------------+
|                     Edge Execution                           |
|                                                              |
|   +----------------------------------------------------+    |
|   |               V8 Isolate Runtime                    |    |
|   |   - 0ms cold start                                  |    |
|   |   - 300+ global locations                           |    |
|   |   - Automatic failover                              |    |
|   +----------------------------------------------------+    |
+-------------------------------------------------------------+
```

## Configuration

### With Durable Objects

```jsonc
// wrangler.jsonc
{
  "name": "my-trigger-app",
  "main": "src/index.ts",
  "compatibility_date": "2025-01-01",
  "durable_objects": {
    "bindings": [
      { "name": "TASK_STATE", "class_name": "TaskStateDO" }
    ]
  },
  "migrations": [
    { "tag": "v1", "new_sqlite_classes": ["TaskStateDO"] }
  ]
}
```

### With Cloudflare Workflows

```jsonc
// wrangler.jsonc
{
  "name": "my-trigger-app",
  "main": "src/index.ts",
  "compatibility_date": "2025-01-01",
  "workflows": [
    { "name": "MY_WORKFLOW", "binding": "MY_WORKFLOW", "class_name": "TaskWorkflow" }
  ]
}
```

## Run Observability

Track task execution and manage runs:

```typescript
// Trigger a task
const { id, handle } = await processOrder.trigger({ orderId: '123' })

// Check status
const status = await handle.status()
// 'PENDING' | 'QUEUED' | 'EXECUTING' | 'COMPLETED' | 'FAILED' | 'CANCELED'

// Poll for result
const result = await handle.result()  // Waits until complete

// Cancel execution
await handle.cancel()

// Get observability metrics
const failedRuns = processOrder.getFailedRuns()
const runningCount = processOrder.getRunningTaskCount()
await processOrder.waitForAllTasks()
```

## Migration from Trigger.dev

### Package Change

```bash
# Remove
npm uninstall @trigger.dev/sdk

# Install
npm install @dotdo/trigger
```

### Import Change

```typescript
// Before
import { task, wait, retry, queue } from '@trigger.dev/sdk/v3'

// After
import { task, wait, retry, queue } from '@dotdo/trigger'
```

### Code Compatibility

Your existing Trigger.dev code works unchanged:

```typescript
// This code works with both @trigger.dev/sdk and @dotdo/trigger
export const processOrder = task({
  id: 'process-order',
  retry: { maxAttempts: 3 },
  run: async (payload, { ctx }) => {
    const user = await ctx.run('fetch-user', async () => {
      return await fetchUser(payload.userId)
    })

    await wait.for({ seconds: 30 })

    return { userId: user.id, status: 'processed' }
  },
})

await processOrder.trigger({ orderId: '123' })
```

## Performance

- **29 tests** covering all functionality
- **0ms cold start** via V8 isolates
- **<1ms** task dispatch latency (edge)
- **Unlimited duration** with Durable Objects
- **Global edge** execution in 300+ cities
- **Automatic memoization** for ctx.run steps
- **Free sleep** on CF Workflows backend

## Requirements

- Cloudflare Workers environment
- Durable Objects with SQLite storage enabled (for DO backend)
- Cloudflare Workflows enabled (for Workflows backend)
- Node.js 18+ (for local development)

## Development

```bash
# Install dependencies
npm install

# Run locally
npm run dev

# Run tests
npm test

# Type check
npm run typecheck

# Deploy to Cloudflare
npm run deploy
```

## Related

- [@dotdo/trigger](/docs/integrations/trigger/package) - Trigger.dev SDK compatible package for testing
- [Workflows Overview](/docs/workflows) - Workflow primitives and DSL
- [Durable Objects](/docs/architecture/durable-objects) - DO-based execution
- [Deployment](/docs/deployment) - Deployment and infrastructure
- [Events](/docs/events) - Event-driven patterns
