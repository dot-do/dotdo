---
title: "@dotdo/auth0"
description: Auth0-compatible in-memory authentication for edge environments and testing.
---

# @dotdo/auth0

Auth0-compatible authentication that runs entirely in-memory. Provides a familiar Auth0 API for edge environments (Cloudflare Workers) and testing scenarios where no external auth service is needed.

```typescript
import { ManagementClient, AuthenticationClient } from '@dotdo/auth0'

const management = new ManagementClient({
  domain: 'test-tenant.auth0.com',
  clientId: 'test-client-id',
  clientSecret: 'test-client-secret',
})

const user = await management.users.create({
  email: 'alice@example.com',
  password: 'SecureP@ssw0rd!',
  connection: 'Username-Password-Authentication',
})
```

<Callout type="info">
Looking for persistent storage? See [auth0.do](/docs/integrations/auth0/service) for a fully managed Auth0-compatible edge service.
</Callout>

## Why @dotdo/auth0?

| Auth0 SDK | @dotdo/auth0 |
|-----------|--------------|
| Node.js runtime required | Edge-compatible (Cloudflare Workers) |
| Requires Auth0 tenant | In-memory, no external dependencies |
| Network latency | Zero latency |
| Connection management | Stateless, instant startup |
| Complex test setup | Perfect for unit tests |

**This is an in-memory implementation** with an Auth0-compatible API. Data does not persist between restarts. Ideal for testing, prototyping, and edge environments where you need authentication without external dependencies.

## Installation

```bash
npm install @dotdo/auth0
```

## Features

### Implemented (Core APIs)

**ManagementClient**
- `users.create()` / `users.get()` / `users.update()` / `users.delete()` - Full CRUD
- `users.getAll()` - List all users (with pagination)
- `users.getByEmail()` - Find users by email
- `users.getRoles()` / `users.assignRoles()` / `users.removeRoles()` - Role management
- `users.getPermissions()` - Permission aggregation from roles
- `users.getEnrollments()` / `users.deleteEnrollment()` - MFA management
- `users.link()` / `users.unlink()` - Identity linking
- `connections.create()` / `connections.get()` / `connections.getByName()` / `connections.update()` / `connections.delete()` / `connections.getAll()`
- `roles.create()` / `roles.get()` / `roles.update()` / `roles.delete()` / `roles.getAll()`
- `roles.getPermissions()` / `roles.addPermissions()` / `roles.removePermissions()`
- `roles.getUsers()` - Get users assigned to a role
- `clients.create()` / `clients.get()` / `clients.update()` / `clients.delete()` / `clients.getAll()`
- `clients.rotateSecret()` - Rotate client secrets
- `resourceServers.create()` / `resourceServers.get()` / `resourceServers.update()` / `resourceServers.delete()` / `resourceServers.getAll()`

**AuthenticationClient**
- `database.signUp()` - User registration
- `database.changePassword()` - Password reset flow
- `passwordless.start()` / `passwordless.verify()` - Email/SMS passwordless
- `oauth.authorizationUrl()` - Build authorization URLs
- `oauth.token()` - Token exchange (password, refresh_token, client_credentials)
- `oauth.revokeToken()` - Token revocation
- `oauth.userInfo()` - Get user info from access token
- `mfa.challenge()` / `mfa.verify()` - MFA flows
- `mfa.associate()` / `mfa.confirmAssociation()` - MFA enrollment

### Not Yet Implemented

- Organizations API (`organizations.*`)
- User blocking (`users.block()` / `users.unblock()`)
- Custom database connections
- Social connections (Google, GitHub, etc.) - use OAuth directly
- SAML/WS-Federation
- Anomaly detection
- Breached password detection
- Attack protection

## Quick Start

### User Management

```typescript
import { ManagementClient } from '@dotdo/auth0'

const management = new ManagementClient({
  domain: 'test-tenant.auth0.com',
  clientId: 'test-client-id',
  clientSecret: 'test-client-secret',
})

// Create a user
const user = await management.users.create({
  email: 'alice@example.com',
  password: 'SecureP@ssw0rd!',
  connection: 'Username-Password-Authentication',
  name: 'Alice Smith',
  user_metadata: {
    preferences: { theme: 'dark' },
  },
})

console.log(`Created user: ${user.user_id}`)

// Get user by ID
const fetchedUser = await management.users.get({ id: user.user_id })

// Update user
await management.users.update(
  { id: user.user_id },
  {
    name: 'Alice Johnson',
    user_metadata: { preferences: { theme: 'light' } },
  }
)

// Find user by email
const users = await management.users.getByEmail('alice@example.com')

// Delete user
await management.users.delete({ id: user.user_id })
```

### Authentication Flows

```typescript
import { AuthenticationClient } from '@dotdo/auth0'

const auth = new AuthenticationClient({
  domain: 'test-tenant.auth0.com',
  clientId: 'test-client-id',
  jwtSecret: 'test-jwt-secret',
})

// Sign up a new user
const newUser = await auth.database.signUp({
  client_id: 'test-client-id',
  email: 'bob@example.com',
  password: 'SecureP@ssw0rd!',
  connection: 'Username-Password-Authentication',
  name: 'Bob Wilson',
})

// Login with password grant
const tokens = await auth.oauth.token({
  grant_type: 'password',
  client_id: 'test-client-id',
  username: 'bob@example.com',
  password: 'SecureP@ssw0rd!',
  scope: 'openid profile email',
})

console.log('Access Token:', tokens.access_token)
console.log('ID Token:', tokens.id_token)
console.log('Refresh Token:', tokens.refresh_token)

// Refresh tokens
const refreshed = await auth.oauth.token({
  grant_type: 'refresh_token',
  client_id: 'test-client-id',
  refresh_token: tokens.refresh_token,
})

// Get user info
const userInfo = await auth.oauth.userInfo(tokens.access_token)
console.log('User:', userInfo.email, userInfo.name)

// Revoke token
await auth.oauth.revokeToken({
  client_id: 'test-client-id',
  token: tokens.refresh_token,
})
```

### Roles and Permissions

```typescript
import { ManagementClient } from '@dotdo/auth0'

const management = new ManagementClient({
  domain: 'test-tenant.auth0.com',
  token: 'management-api-token',
})

// Create a role
const adminRole = await management.roles.create({
  name: 'admin',
  description: 'Administrator with full access',
})

// Create a resource server (API)
const api = await management.resourceServers.create({
  name: 'My API',
  identifier: 'https://api.example.com',
  scopes: [
    { value: 'read:users', description: 'Read user data' },
    { value: 'write:users', description: 'Modify user data' },
    { value: 'delete:users', description: 'Delete users' },
  ],
})

// Add permissions to role
await management.roles.addPermissions(
  { id: adminRole.id },
  {
    permissions: [
      { permission_name: 'read:users', resource_server_identifier: 'https://api.example.com' },
      { permission_name: 'write:users', resource_server_identifier: 'https://api.example.com' },
      { permission_name: 'delete:users', resource_server_identifier: 'https://api.example.com' },
    ],
  }
)

// Assign role to user
await management.users.assignRoles(
  { id: 'user_123' },
  { roles: [adminRole.id] }
)

// Get user's effective permissions
const permissions = await management.users.getPermissions({ id: 'user_123' })
console.log('User permissions:', permissions.map(p => p.permission_name))
// ['read:users', 'write:users', 'delete:users']
```

### MFA (Multi-Factor Authentication)

```typescript
import { AuthenticationClient } from '@dotdo/auth0'

const auth = new AuthenticationClient({
  domain: 'test-tenant.auth0.com',
  jwtSecret: 'test-jwt-secret',
})

// Enroll TOTP authenticator
const enrollment = await auth.mfa.associate({
  client_id: 'test-client-id',
  access_token: userAccessToken,
  authenticator_types: ['otp'],
})

console.log('TOTP Secret:', enrollment.secret)
console.log('QR Code URI:', enrollment.barcode_uri)

// Confirm enrollment with first OTP
await auth.mfa.confirmAssociation({
  client_id: 'test-client-id',
  access_token: userAccessToken,
  factor_id: enrollment.factor_id,
  otp: '123456', // From authenticator app
})

// During login - MFA challenge
const challenge = await auth.mfa.challenge({
  client_id: 'test-client-id',
  mfa_token: mfaToken, // Returned when MFA is required
  challenge_type: 'otp',
})

// Verify MFA
const tokens = await auth.mfa.verify({
  client_id: 'test-client-id',
  mfa_token: mfaToken,
  otp: '654321',
})
```

### Passwordless Authentication

```typescript
import { AuthenticationClient } from '@dotdo/auth0'

const auth = new AuthenticationClient({
  domain: 'test-tenant.auth0.com',
  jwtSecret: 'test-jwt-secret',
})

// Start passwordless flow (email)
const { _id } = await auth.passwordless.start({
  client_id: 'test-client-id',
  connection: 'email',
  email: 'user@example.com',
  send: 'code',
})

// User receives code via email...

// Verify code and get tokens
const tokens = await auth.passwordless.verify({
  client_id: 'test-client-id',
  connection: 'email',
  email: 'user@example.com',
  verification_code: '123456',
  scope: 'openid profile email',
})
```

## TypeScript Types

Full TypeScript support with Auth0-compatible types:

```typescript
import type {
  // User types
  Auth0User,
  Auth0Identity,
  CreateUserParams,
  UpdateUserParams,

  // Connection types
  Auth0Connection,
  ConnectionOptions,
  CreateConnectionParams,

  // Role types
  Auth0Role,
  Auth0Permission,
  CreateRoleParams,

  // Client types
  Auth0Client,
  CreateClientParams,

  // Resource server types
  Auth0ResourceServer,
  CreateResourceServerParams,

  // Token types
  TokenResponse,
  AuthorizationParams,
  TokenExchangeParams,

  // Auth types
  SignupParams,
  ChangePasswordParams,
  PasswordlessStartParams,
  PasswordlessVerifyParams,

  // MFA types
  Auth0MFAEnrollment,
  Auth0MFAChallenge,

  // Log types
  Auth0Log,

  // Error types
  Auth0Error,

  // Pagination types
  PaginationParams,
  PaginatedResponse,
} from '@dotdo/auth0'

// Error class
import { Auth0APIError } from '@dotdo/auth0'
```

## Error Handling

```typescript
import { Auth0APIError } from '@dotdo/auth0'

try {
  await management.users.get({ id: 'invalid-user-id' })
} catch (error) {
  if (error instanceof Auth0APIError) {
    console.error('Status:', error.statusCode)      // 404
    console.error('Message:', error.message)        // 'User not found: invalid-user-id'
    console.error('Error Code:', error.errorCode)   // 'inexistent_user'
    console.error('Error:', error.error)            // 'Not Found'
  }
}
```

### Auth0APIError Properties

| Property | Type | Description |
|----------|------|-------------|
| `statusCode` | `number` | HTTP status code (e.g., 404, 401, 400) |
| `error` | `string` | Error type (e.g., 'Not Found', 'Unauthorized') |
| `message` | `string` | Human-readable error message |
| `errorCode` | `string?` | Auth0-specific error code (optional) |

### Common Error Codes

| Code | HTTP Status | Description |
|------|-------------|-------------|
| `inexistent_user` | 404 | User not found |
| `inexistent_connection` | 404 | Connection not found |
| `invalid_body` | 400 | Invalid request body |
| `invalid_query_string` | 400 | Invalid query parameters |
| `password_strength_error` | 400 | Password too weak |
| `user_exists` | 409 | User with email already exists |
| `invalid_token` | 401 | Token is invalid or expired |
| `insufficient_scope` | 403 | Token lacks required scopes |

### Authentication Errors

```typescript
import { AuthenticationClient, Auth0APIError } from '@dotdo/auth0'

const auth = new AuthenticationClient({
  domain: 'test-tenant.auth0.com',
  jwtSecret: 'test-jwt-secret',
})

try {
  await auth.oauth.token({
    grant_type: 'password',
    client_id: 'test-client-id',
    username: 'user@example.com',
    password: 'wrong-password',
  })
} catch (error) {
  if (error instanceof Auth0APIError) {
    switch (error.errorCode) {
      case 'invalid_grant':
        console.error('Invalid username or password')
        break
      case 'mfa_required':
        console.error('MFA required - use mfa.challenge() and mfa.verify()')
        break
      case 'too_many_attempts':
        console.error('Account locked due to too many failed attempts')
        break
    }
  }
}
```

## Testing with @dotdo/auth0

@dotdo/auth0 is ideal for unit tests - no external Auth0 tenant required:

```typescript
import { describe, it, expect, beforeEach } from 'vitest'
import { ManagementClient, AuthenticationClient } from '@dotdo/auth0'

describe('UserService', () => {
  let management: ManagementClient
  let auth: AuthenticationClient

  beforeEach(() => {
    // Fresh in-memory store for each test
    management = new ManagementClient({
      domain: 'test.auth0.com',
      clientId: 'test-client',
      clientSecret: 'test-secret',
    })

    auth = new AuthenticationClient({
      domain: 'test.auth0.com',
      clientId: 'test-client',
      jwtSecret: 'test-jwt-secret',
    })
  })

  it('should create and authenticate a user', async () => {
    // Create user via Management API
    const user = await management.users.create({
      email: 'test@example.com',
      password: 'SecureP@ssw0rd!',
      connection: 'Username-Password-Authentication',
    })

    expect(user.user_id).toBeDefined()
    expect(user.email).toBe('test@example.com')

    // Authenticate via Authentication API
    const tokens = await auth.oauth.token({
      grant_type: 'password',
      client_id: 'test-client',
      username: 'test@example.com',
      password: 'SecureP@ssw0rd!',
    })

    expect(tokens.access_token).toBeDefined()
    expect(tokens.id_token).toBeDefined()
  })

  it('should manage roles and permissions', async () => {
    const user = await management.users.create({
      email: 'admin@example.com',
      password: 'SecureP@ssw0rd!',
      connection: 'Username-Password-Authentication',
    })

    const role = await management.roles.create({
      name: 'admin',
      description: 'Administrator role',
    })

    await management.users.assignRoles(
      { id: user.user_id },
      { roles: [role.id] }
    )

    const userRoles = await management.users.getRoles({ id: user.user_id })
    expect(userRoles).toHaveLength(1)
    expect(userRoles[0].name).toBe('admin')
  })
})
```

## Edge Compatibility

Works in Cloudflare Workers without Node.js dependencies:

```typescript
// worker.ts
import { ManagementClient, AuthenticationClient } from '@dotdo/auth0'

export default {
  async fetch(request: Request, env: Env): Promise<Response> {
    const management = new ManagementClient({
      domain: env.AUTH0_DOMAIN,
      clientId: env.AUTH0_CLIENT_ID,
      clientSecret: env.AUTH0_CLIENT_SECRET,
    })

    const auth = new AuthenticationClient({
      domain: env.AUTH0_DOMAIN,
      clientId: env.AUTH0_CLIENT_ID,
      jwtSecret: env.JWT_SECRET,
    })

    const url = new URL(request.url)

    if (request.method === 'POST' && url.pathname === '/signup') {
      const body = await request.json()
      const user = await management.users.create({
        email: body.email,
        password: body.password,
        connection: 'Username-Password-Authentication',
      })
      return Response.json({ userId: user.user_id })
    }

    if (request.method === 'POST' && url.pathname === '/login') {
      const body = await request.json()
      const tokens = await auth.oauth.token({
        grant_type: 'password',
        client_id: env.AUTH0_CLIENT_ID,
        username: body.email,
        password: body.password,
      })
      return Response.json(tokens)
    }

    return new Response('Not Found', { status: 404 })
  },
}
```

## Migration from auth0

### Import Change

```typescript
// Before: Auth0 SDK
import { ManagementClient, AuthenticationClient } from 'auth0'

// After: dotdo
import { ManagementClient, AuthenticationClient } from '@dotdo/auth0'
```

### Code Migration

Replace `auth0` with `@dotdo/auth0`:

```typescript
// Before (with real Auth0)
const management = new ManagementClient({
  domain: 'your-tenant.auth0.com',
  clientId: process.env.AUTH0_CLIENT_ID,
  clientSecret: process.env.AUTH0_CLIENT_SECRET,
})

// After (in-memory for tests)
const management = new ManagementClient({
  domain: 'test-tenant.auth0.com',
  clientId: 'test-client-id',
  clientSecret: 'test-client-secret',
})

// All Auth0 operations work the same
const user = await management.users.create({
  email: 'alice@example.com',
  password: 'SecureP@ssw0rd!',
  connection: 'Username-Password-Authentication',
})
```

## Limitations

What's different from Auth0 Cloud:

| Feature | Status | Notes |
|---------|--------|-------|
| User management | Full | CRUD, metadata, identity linking |
| Password auth | Full | Signup, login, reset |
| JWT tokens | Full | HS256, RS256 support |
| Refresh tokens | Full | Rotation, revocation |
| MFA (TOTP) | Full | Enrollment, verification |
| MFA (Email/SMS) | Full | OTP delivery (bring your own transport) |
| Roles & Permissions | Full | RBAC with inheritance |
| Connections | Full | Create, update, delete connections |
| Clients | Full | Application management with secret rotation |
| Resource Servers | Full | API definitions with scopes |
| Data persistence | None | In-memory only |
| User blocking | Not implemented | Use user deletion or custom metadata |
| Organizations | Not implemented | Multi-tenancy planned |
| Social connections | Not implemented | Use OAuth directly |
| SAML | Not implemented | |
| Custom database | Not implemented | |
| Anomaly detection | Not implemented | |
| Breached passwords | Not implemented | |

## Related

- [auth0.do](/docs/integrations/auth0/service) - Managed Auth0 on the edge
- [Clerk Integration](/docs/integrations/clerk) - Alternative auth provider
- [Authentication Overview](/docs/security/authentication) - dotdo auth concepts
