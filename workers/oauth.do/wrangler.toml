# oauth.do - OAuth 2.0 Authorization Server
#
# A complete OAuth 2.0/OIDC provider platform service that enables dotdo apps
# to implement "Sign in with [YourApp]" functionality.

name = "oauth-do"
main = "index.ts"
compatibility_date = "2024-01-01"

# Workers configuration
workers_dev = true
route = { pattern = "oauth.dotdo.dev/*", zone_name = "dotdo.dev" }

# Environment variables
[vars]
OAUTH_ISSUER = "https://oauth.dotdo.dev"

# D1 Database binding
[[d1_databases]]
binding = "DB"
database_name = "oauth-db"
database_id = "placeholder-id"

# Durable Object bindings
[[durable_objects.bindings]]
name = "OAUTH_CLIENTS"
class_name = "OAuthClientDO"

[[durable_objects.bindings]]
name = "OAUTH_TOKENS"
class_name = "OAuthTokenDO"

# Durable Object migrations
[[migrations]]
tag = "v1"
new_classes = ["OAuthClientDO", "OAuthTokenDO"]

# Production environment
[env.production]
route = { pattern = "oauth.do/*", zone_name = "do" }

[env.production.vars]
OAUTH_ISSUER = "https://oauth.do"

# Staging environment
[env.staging]
route = { pattern = "oauth-staging.dotdo.dev/*", zone_name = "dotdo.dev" }

[env.staging.vars]
OAUTH_ISSUER = "https://oauth-staging.dotdo.dev"
