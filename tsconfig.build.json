{
  "extends": "./tsconfig.json",
  "compilerOptions": {
    // Output configuration
    "outDir": "dist",
    "declaration": true,
    "declarationMap": true,
    "sourceMap": true,
    "noEmit": false,

    // Library output settings
    "target": "ES2022",
    "module": "ESNext",
    "moduleResolution": "bundler",

    // Add .js extensions to relative imports for Node.js compatibility
    "rewriteRelativeImportExtensions": true,

    // Remove most path aliases for published package, keep stubs for missing deps
    "paths": {
      "fsx.do": ["./types/stubs/fsx.do.d.ts"],
      "@dotdo/fsx": ["./types/stubs/dotdo-fsx.d.ts"],
      "@dotdo/client": ["./types/stubs/dotdo-client.d.ts"]
    },

    // Ensure clean output
    "removeComments": false,
    "emitDeclarationOnly": false,

    // Relax strictness for declaration emit (mixin patterns)
    "stripInternal": true,

    // Skip checking declarations from dependencies
    "skipLibCheck": true,

    // Fail build on type errors - enforces strict TypeScript compilation
    // This prevents emitting any output files when there are type errors
    // NOTE: Build currently fails with ~640 type errors across 84 files including:
    // - objects/core/*, lib/executors/*, lib/human/*
    // - workflows/on.ts, workflows/data/*, workflows/worker-dsl.ts
    // - do/primitives/*, objects/unified-storage/*
    // See beads issue do-mjgd for the full error inventory
    "noEmitOnError": true
  },
  "include": [
    // All DO entry points
    "do/**/*.ts",
    // Core objects (includes presets/)
    "objects/**/*.ts",
    // Types and utilities
    "types/**/*.ts",
    // Library (includes mixins for fs/git/bash capabilities)
    "lib/**/*.ts",
    // Workflows (core only, not compat)
    "workflows/**/*.ts",
    // Streams (Cloudflare Pipelines SQL definitions)
    "db/streams/**/*.ts"
  ],
  "exclude": [
    "node_modules",
    "dist",
    "app",
    "examples",
    "packages",
    "**/*.test.ts",
    "**/*.test.tsx",
    "**/tests/**",
    "**/spikes/**",
    // Exclude areas with type errors or external deps
    "streaming/**/*",
    "db/**/*",
    "ai/**/*",
    "cli/**/*",
    "auth/**/*",
    "api/**/*",
    // DO capabilities (submodules)
    "do/capabilities/**/*",
    // Files with known build issues
    "lib/agent/**/*",
    "lib/tools/**/*",
    "lib/validation/**/*",
    "lib/executors/**/*",
    "lib/human/**/*",
    "lib/iterators/**/*",
    // Objects with type errors
    "objects/StatelessDOState.ts",
    "objects/CollectionDO.ts",
    "objects/mixins/npm.ts",
    "objects/transport/**/*",
    // Workflow areas with type errors
    "workflows/errors/**/*",
    "workflows/graph/**/*",
    "workflows/core/**/*",
    "workflows/context/shard.ts",
    // Types with stub dependencies
    "types/stubs/**/*",
    "types/stores.ts"
  ]
}
