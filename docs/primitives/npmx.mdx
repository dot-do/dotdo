---
title: npmx - NPM for Edge Runtimes
description: Package management without Node.js - install, run, and publish packages in V8 isolates
---

# npmx - NPM for Edge Runtimes

Run `npm install` and `npx` commands without Node.js. Package management that works in Cloudflare Workers, Deno, browsers, and any V8 isolate.

npmx provides full npm compatibility with zero cold starts. Uses [fsx](/docs/primitives/fsx) for all filesystem operations (tiered storage handled automatically).

## Quick Start

```typescript
import { npm, npx } from 'npmx.do'

// Install packages at runtime
await npm.install(['lodash', 'react@18'])

// Run npx commands
await npx('cowsay', ['hello'])

// Run package scripts
await npm.run('build')
```

## Installation

```typescript
import { createNpm, npx } from 'npmx.do'

// Create npm instance with custom config
const npm = createNpm({
  cwd: '/app',
  registry: 'https://registry.npmjs.org',
  token: process.env.NPM_TOKEN
})
```

## Core API

### npm.install

Install packages to the virtual filesystem:

```typescript
// Install multiple packages
await npm.install(['lodash', 'express', 'zod'])

// Install specific versions
await npm.install(['react@18.2.0', 'react-dom@18.2.0'])

// Install dev dependencies
await npm.install(['vitest', 'typescript'], { dev: true })

// Install exact versions (no semver resolution)
await npm.install(['lodash@4.17.21'], { exact: true })
```

#### Install Result

```typescript
const result = await npm.install(['lodash'])

console.log(result.installed)  // [{ name: 'lodash', version: '4.17.21' }]
console.log(result.stats)      // { resolved: 1, cached: 0, duration: 234 }
```

```typescript
interface InstallResult {
  installed: PackageVersion[]
  removed: PackageVersion[]
  updated: PackageUpdate[]
  stats: {
    resolved: number  // Packages fetched from registry
    cached: number    // Packages served from cache
    duration: number  // Total time in milliseconds
  }
}
```

### npm.uninstall

Remove packages:

```typescript
await npm.uninstall(['lodash', 'express'])
```

### npm.run

Execute package.json scripts:

```typescript
// Run a script
const result = await npm.run('build')
console.log(result.exitCode)  // 0
console.log(result.output)    // Build output

// Run with arguments
await npm.run('test', ['--watch'])
```

### npm.list

List installed packages:

```typescript
const packages = await npm.list()
// [{ name: 'lodash', version: '4.17.21' }, ...]

// With depth
const tree = await npm.list({ depth: 2 })
```

### npm.search

Search the npm registry:

```typescript
const results = await npm.search('state management')

for (const pkg of results) {
  console.log(`${pkg.name}@${pkg.version}: ${pkg.description}`)
}
```

### npm.info

Get package information:

```typescript
const info = await npm.info('react')
console.log(info.name)         // 'react'
console.log(info.version)      // '18.2.0'
console.log(info.description)  // 'A JavaScript library...'
console.log(info.dependencies) // { 'loose-envify': '^1.1.0' }

// Specific version
const info18 = await npm.info('react', '18.0.0')
```

## npx - Execute Packages

Run package binaries without global installation:

```typescript
import { npx } from 'npmx.do'

// Run cowsay
await npx('cowsay', ['hello world'])

// Create a Next.js app
await npx('create-next-app', ['my-app', '--typescript'])

// Run TypeScript compiler
await npx('tsc', ['--init'])
```

### With Configuration

```typescript
await npx('vitest', ['run'], {
  cwd: '/app/packages/core',
  registry: 'https://registry.npmjs.org'
})
```

## CLI Usage

npmx provides a CLI for terminal usage:

```bash
# Install packages
npx npmx.do install lodash express

# Install dev dependencies
npx npmx.do install -D vitest typescript

# Get package info
npx npmx.do info react

# Search packages
npx npmx.do search "state management"

# List installed packages
npx npmx.do list
```

## Architecture

npmx uses a layered architecture with zero Cloudflare dependencies in the core:

```
                    npmx.do
   ┌─────────────┬─────────────┬─────────────────────┐
   │  Registry   │  Resolver   │      Runner         │
   │  - fetch    │  - semver   │  - npm run          │
   │  - metadata │  - tree     │  - npx exec         │
   │  - extract  │  - lockfile │  - scripts          │
   └──────┬──────┴──────┬──────┴──────────┬──────────┘
          │             │                 │
          ▼             ▼                 ▼
   ┌─────────────────────────────────────────────────┐
   │                    fsx.do                       │
   │      (handles all storage - SQLite + R2)        │
   │                                                 │
   │   /node_modules/lodash/...  -> SQLite (hot)    │
   │   /cache/lodash-4.17.21.tgz -> R2 (cold)       │
   └─────────────────────────────────────────────────┘
```

### Core Modules

The `@dotdo/npmx` core library works in any JavaScript runtime:

```typescript
import { semver, resolver, pkg, tarball } from '@dotdo/npmx'

// Semver operations
semver.satisfies('1.2.3', '^1.0.0')  // true
semver.maxSatisfying(['1.0.0', '2.0.0'], '^1.0.0')  // '1.0.0'

// Resolve dependencies
const tree = await resolver.resolveDependencies('lodash', '^4.17.0')

// Parse package.json
const manifest = pkg.parse(packageJsonString)

// Extract tarball
const files = await tarball.extract(tarballBuffer)
```

## Semver Resolution

Full npm-compatible semantic versioning:

```typescript
import { semver } from '@dotdo/npmx'

// Version comparison
semver.gt('2.0.0', '1.0.0')   // true
semver.lt('1.0.0', '2.0.0')   // true
semver.eq('1.0.0', '1.0.0')   // true

// Range satisfaction
semver.satisfies('1.2.3', '^1.0.0')     // true
semver.satisfies('2.0.0', '^1.0.0')     // false
semver.satisfies('1.2.3', '>=1.0.0 <2.0.0')  // true

// Find best match
const versions = ['1.0.0', '1.1.0', '1.2.0', '2.0.0']
semver.maxSatisfying(versions, '^1.0.0')  // '1.2.0'
```

## Dependency Resolution

Build complete dependency trees:

```typescript
import { resolver } from '@dotdo/npmx'

// Resolve a package and all dependencies
const tree = await resolver.resolveDependencies('express', '^4.18.0', {
  includeDevDependencies: false
})

console.log(tree.root)        // { name: 'express', version: '4.18.2', ... }
console.log(tree.dependencies) // Map of all resolved packages
```

### Lock File Generation

```typescript
const lockfile = await resolver.generateLockFile(tree)
await $.fs.write('package-lock.json', JSON.stringify(lockfile, null, 2))
```

## Security

npmx includes security policy controls:

```typescript
import { SecurityPolicy } from '@dotdo/npmx'

const policy = new SecurityPolicy({
  allowedScopes: ['@company'],
  blockedPackages: ['malicious-package'],
  maxDependencyDepth: 10,
  requireIntegrity: true
})

// Check before install
const result = policy.check('some-package', '1.0.0')
if (!result.allowed) {
  console.error('Blocked:', result.violations)
}
```

## Tarball Handling

Extract and create npm tarballs:

```typescript
import { tarball } from '@dotdo/npmx'

// Extract a tarball
const response = await fetch('https://registry.npmjs.org/lodash/-/lodash-4.17.21.tgz')
const buffer = await response.arrayBuffer()

const entries = await tarball.extract(new Uint8Array(buffer))
for (const entry of entries) {
  console.log(entry.path, entry.size)
  await $.fs.write(entry.path, entry.content)
}

// Verify integrity
const hash = await tarball.integrity(buffer)
console.log(hash)  // 'sha512-...'
```

## Caching

npmx uses an LRU cache for bounded memory usage:

```typescript
import { LRUCache } from '@dotdo/npmx'

const cache = new LRUCache<string, PackageMetadata>({
  maxSize: 1000,
  ttl: 60 * 60 * 1000  // 1 hour
})

// Cache package metadata
cache.set('lodash', metadata)
const cached = cache.get('lodash')

// Get stats
console.log(cache.stats())  // { hits: 10, misses: 2, size: 50 }
```

## Integration with bashx

bashx routes npm/npx commands to npmx automatically:

```typescript
// These use npmx internally
await $.bash`npm install lodash`
await $.bash`npx cowsay hello`
await $.bash`npm run build`
```

## Workspace Support

Manage monorepos with workspace awareness:

```typescript
const npm = createNpm({ cwd: '/app' })

// Install workspace dependencies
await npm.install([], { workspaces: true })

// Run script in specific workspace
await npm.run('build', [], { workspace: '@app/core' })

// Run across all workspaces
await npm.run('test', [], { workspaces: true })
```

## Type Definitions

```typescript
interface NpmConfig {
  cwd?: string
  registry?: string
  token?: string
}

interface NpmSDK {
  install(packages?: string[], options?: InstallOptions): Promise<InstallResult>
  uninstall(packages: string[]): Promise<void>
  run(script: string, args?: string[]): Promise<{ exitCode: number; output: string }>
  list(options?: { depth?: number }): Promise<PackageVersion[]>
  search(query: string): Promise<SearchResult[]>
  info(name: string, version?: string): Promise<PackageInfo>
}

interface InstallOptions {
  dev?: boolean
  exact?: boolean
  workspaces?: boolean
  workspace?: string
}

interface PackageVersion {
  name: string
  version: string
}

interface PackageUpdate {
  name: string
  from: string
  to: string
}
```

## Next Steps

- [fsx](/docs/primitives/fsx) - Filesystem used for package storage
- [bashx](/docs/primitives/bashx) - Shell integration for npm commands
- [gitx](/docs/primitives/gitx) - Version control for your packages
