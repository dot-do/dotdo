---
title: Rate Limiting
description: Rate limiting types and capabilities
---

import { AutoTypeTable } from 'fumadocs-typescript/ui'

# Rate Limiting

Rate limiting types for controlling access and preventing abuse.

## RateLimitResult

Result from rate limit check/consume operations.

<AutoTypeTable type="RateLimitResult" />

### Properties

| Property | Type | Required | Description |
|----------|------|----------|-------------|
| `success` | `boolean` | Yes | Whether the action is allowed |
| `remaining` | `number` | Yes | Remaining quota in the current window |
| `resetAt` | `number` | No | When the limit resets (epoch ms) |
| `limit` | `number` | No | Limit that was checked |

## RateLimitCheckOptions

Options for rate limit check.

### Properties

| Property | Type | Default | Description |
|----------|------|---------|-------------|
| `limit` | `number` | - | Maximum requests allowed in the window |
| `windowMs` | `number` | - | Window size in milliseconds |
| `cost` | `number` | `1` | Cost of this operation |
| `name` | `string` | - | Named limit to use (e.g., 'api', 'auth') |

## RateLimitCapability

Rate limit capability on WorkflowContext.

### Methods

| Method | Description |
|--------|-------------|
| `check(key, options?)` | Check if action is rate limited without consuming quota |
| `consume(key, cost?)` | Consume rate limit quota |
| `status(key)` | Get current quota status |
| `reset(key)` | Reset rate limit for a key |

## Usage Examples

### Basic Rate Limiting

```typescript
const handleRequest = async ($: WorkflowContext, userId: string) => {
  if (!hasRateLimit($)) {
    throw new Error('Rate limiting not available')
  }

  const result = await $.rateLimit.check(userId, {
    limit: 100,
    windowMs: 60000 // 1 minute
  })

  if (!result.success) {
    throw new Error(`Rate limited. Try again in ${result.resetAt - Date.now()}ms`)
  }

  await $.rateLimit.consume(userId)
  // Process request...
}
```

### Named Limits

```typescript
// Check API rate limit
const apiLimit = await $.rateLimit.check(userId, { name: 'api' })

// Check auth rate limit (stricter)
const authLimit = await $.rateLimit.check(ip, { name: 'auth' })
```

### Variable Cost

```typescript
// Expensive operation costs more
await $.rateLimit.consume(userId, 5)

// Regular operation costs 1
await $.rateLimit.consume(userId)
```

## Type Guard

```typescript
import { hasRateLimit, WithRateLimit } from 'dotdo/types'

const rateLimitedHandler = async ($: WorkflowContext) => {
  if (hasRateLimit($)) {
    // $ is now typed as WithRateLimit
    const result = await $.rateLimit.check('key')
  }
}
```

## Related Types

- [WorkflowContext](/docs/sdk/workflow-context) - The $ context interface
- [Capabilities](/docs/sdk/capabilities) - Other capability modules
