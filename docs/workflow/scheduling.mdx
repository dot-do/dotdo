---
title: Scheduling DSL
description: Human-readable scheduling with every.Monday.at9am() and AI-powered parsing
---

# Scheduling DSL (every)

The scheduling DSL transforms complex CRON expressions into readable English. Instead of memorizing `0 9 * * 1`, write `every.Monday.at9am()`.

```typescript
import { every, createScheduleBuilderProxy } from 'dotdo/workflows'
```

## Day-Based Scheduling

### Specific Days

```typescript
// Every Monday at 9am
every.Monday.at9am(sendWeeklyReport)

// Every Friday at 5pm
every.Friday.at5pm(generateInvoices)

// Every Sunday at 6am
every.Sunday.at6am(runBackup)
```

Available days: `Monday`, `Tuesday`, `Wednesday`, `Thursday`, `Friday`, `Saturday`, `Sunday`

Available time shortcuts:
- `at6am` through `at6pm` (all hours)
- `atnoon` and `atmidnight`

For other times, use the `.at()` method with a time string.

### Custom Times

Use `.at(time)` for any time:

```typescript
// Every day at 6pm
every.day.at('6pm')(closeMarket)

// Every Monday at 9:30am
every.Monday.at('9:30am')(standupReminder)

// Every day at noon
every.day.atnoon(lunchNotification)

// Every day at midnight
every.day.atmidnight(dailyCleanup)

// Weekdays at 8:30am
every.weekday.at('8:30am')(sendDailyBriefing)

// Weekends at 10am
every.weekend.at('10am')(weekendSummary)
```

Time formats supported:
- `9am`, `5pm` - Hour with AM/PM
- `9:30am`, `6:45pm` - Hour:minute with AM/PM
- `14:30`, `09:00` - 24-hour format
- `noon`, `midnight` - Named times

## Interval Scheduling

### Simple Intervals

```typescript
// Every hour
every.hour(checkHealth)

// Every minute
every.minute(updateMetrics)
```

### Natural Language Scheduling

Use function call syntax for natural language schedules:

```typescript
// Every 5 minutes
every('every 5 minutes', syncExternalData)

// Daily at specific time
every('daily at 6am', prepareReports)

// Monthly patterns
every('first day of month at 9am', generateMonthlyInvoices)

// Weekly patterns
every('weekly on friday at 5pm', sendWeeklyNewsletter)
```

Pre-cached common patterns for fast parsing:
- `every minute`, `every hour`, `hourly`
- `every 5/10/15/30 minutes`
- `every 2/3/4/6/8/12 hours`
- `daily at 6am/9am/noon/midnight`
- `weekdays at 9am`, `weekends at 10am`
- `first day of month`, `15th of month`

## Unsubscribing

All schedule registrations return an unsubscribe function:

```typescript
// Register
const cancel = every.Monday.at9am(sendReport)

// Later: cancel the schedule
cancel()

// With context for grouped cleanup
every.day.at9am(handler, { context: 'reports' })
```

## CRON Expression Mapping

The DSL generates standard 5-field CRON expressions:

| DSL | CRON |
|-----|------|
| `every.Monday.at9am()` | `0 9 * * 1` |
| `every.Friday.at5pm()` | `0 17 * * 5` |
| `every.day.at6am()` | `0 6 * * *` |
| `every.day.at('6pm')()` | `0 18 * * *` |
| `every.day.at('9:30am')()` | `30 9 * * *` |
| `every.day.atnoon()` | `0 12 * * *` |
| `every.day.atmidnight()` | `0 0 * * *` |
| `every.weekday.at9am()` | `0 9 * * 1-5` |
| `every.weekend.at10am()` | `0 10 * * 0,6` |
| `every.hour()` | `0 * * * *` |
| `every.minute()` | `* * * * *` |
| `every('every 5 minutes')` | `*/5 * * * *` |
| `every('every 2 hours')` | `0 */2 * * *` |
| `every('first of month')` | `0 0 1 * *` |
| `every('15th of month at 9am')` | `0 9 15 * *` |

## AI-Powered Natural Language Parsing

When AI environment bindings are available, complex natural language schedules are parsed using Claude:

```typescript
import { createScheduleBuilderProxy } from 'dotdo/workflows'

// Create schedule builder with AI support
const every = createScheduleBuilderProxy({
  state: ctx.state,
  env: ctx.env  // Enables AI parsing when ANTHROPIC_API_KEY is set
})

// These work with or without AI (regex fallback)
every('every 5 minutes', handler)
every('daily at 9am', handler)

// These benefit from AI for accurate parsing
every('every second Tuesday at 3pm', handler)
every('last Friday of month', handler)
```

> **Warning**: Standard 5-field cron expressions do not support `last day of month`. Attempting to use this pattern will throw an error. Use a workaround like running on the 28th or implementing custom logic.

## Common Patterns

### Business Hours

```typescript
import { send } from 'dotdo/workflows'

// Market open (weekdays only)
every.weekday.at('9:30am')(() => {
  market.open()
  send.Market.opened({ timestamp: new Date() })
})

// Market close
every.weekday.at('4pm')(() => {
  market.close()
  send.Market.closed({ timestamp: new Date() })
})
```

### Maintenance Windows

```typescript
// Database maintenance at 3am
every.day.at('3am')(async () => {
  await database.vacuum()
  await database.analyzeIndexes()
})

// Weekly full backup
every.Sunday.at6am(async () => {
  await backup.full()
  await backup.verify()
})

// Monthly cleanup on the 1st
every('first of month at 2am', async () => {
  await archiveOldRecords()
  await compactDatabase()
})
```

### Periodic Reporting

```typescript
// Hourly metrics
every.hour(() => {
  metrics.aggregate()
  metrics.pushToTimeseries()
})

// Daily summary
every.day.at('6am')(async () => {
  const summary = await analytics.dailySummary()
  await email.send({
    to: 'team@company.com',
    subject: 'Daily Summary',
    body: formatSummary(summary)
  })
})

// Weekly report
every.Monday.at9am(async () => {
  const report = await analytics.weeklyReport()
  await slack.post('#reports', report)
})
```

### Health Checks

```typescript
// Every minute heartbeat
every.minute(() => {
  health.ping()
})

// Detailed health check every 5 minutes
every('every 5 minutes', async () => {
  const status = await health.check()
  if (!status.healthy) {
    await alerting.page('System unhealthy', status)
  }
})
```

## Day Constants

The day names map to CRON day-of-week values:

| Day/Group | CRON Value |
|-----------|------------|
| Sunday | 0 |
| Monday | 1 |
| Tuesday | 2 |
| Wednesday | 3 |
| Thursday | 4 |
| Friday | 5 |
| Saturday | 6 |
| day | * (every day) |
| weekday | 1-5 (Mon-Fri) |
| weekend | 0,6 (Sat-Sun) |

## Integration with Durable Objects

Use `createScheduleBuilderProxy` for DO integration with alarm management:

```typescript
import { createScheduleBuilderProxy } from 'dotdo/workflows'

class MyDO extends DurableObject {
  private every: ScheduleBuilderProxy

  constructor(ctx: DurableObjectState, env: Env) {
    super(ctx, env)

    this.every = createScheduleBuilderProxy({
      state: ctx.state,
      env: env,
      onScheduleRegistered: (cron, name, handler) => {
        console.log(`Registered schedule ${name}: ${cron}`)
      }
    })

    // Register schedules - automatically sets DO alarms
    this.every.Monday.at9am(() => this.weeklyReport())
    this.every('every 5 minutes', () => this.healthCheck())
  }

  async alarm() {
    // Called when alarm fires
  }
}
```

## API Reference

| Function | Description |
|----------|-------------|
| `every.Day.atTime(handler, options?)` | Schedule on specific day/time |
| `every.day.at('time')(handler)` | Schedule daily at custom time |
| `every.hour(handler)` | Schedule every hour |
| `every.minute(handler)` | Schedule every minute |
| `every('natural language', handler)` | Natural language scheduling |
| `createScheduleBuilderProxy(config)` | Create DO-integrated scheduler |

### Schedule Builder Options

```typescript
interface ScheduleBuilderConfig {
  state: DurableObjectState
  onScheduleRegistered?: (cron: string, name: string, handler: Function) => void
  env?: AIGatewayEnv  // Enables AI-powered parsing
}

interface EveryHandlerOptions {
  context?: string  // For grouped cleanup
}
```
