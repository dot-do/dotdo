---
title: Postmark
description: Drop-in replacement for postmark SDK with transactional email, templates, and exactly-once delivery guarantees.
---

# Postmark

Drop-in replacement for `postmark`. Same API, runs on Cloudflare Workers.

```typescript
// Before
import { ServerClient } from 'postmark'

// After
import { ServerClient } from '@dotdo/postmark'
```

Your existing Postmark code works unchanged. No migration required.

## Why postmark.do?

| Feature | Postmark | postmark.do |
|---------|----------|-------------|
| **API compatibility** | Native | 100% compatible |
| **Runtime** | Node.js | Edge (300+ cities) |
| **Cold start** | Variable | 0ms (V8 isolates) |
| **Template storage** | Postmark servers | DO SQLite |
| **Exactly-once delivery** | No | Yes (idempotency keys) |
| **Audit logs** | Separate product | Built-in temporal store |
| **Outbox pattern** | DIY | Built-in transactions |
| **Deliverability** | Industry-leading | Same + edge benefits |

## Features

| Feature | Status |
|---------|--------|
| Single email send | Supported |
| Batch email send | Supported |
| Email templates | Supported |
| Template CRUD | Supported |
| Message streams | Supported |
| Inbound email parsing | Supported |
| Bounce management | Supported |
| Server management | Supported |
| Stats & analytics | Supported |
| Exactly-once delivery | Supported |
| Webhooks | Supported |

## Quick Start

### Install

```bash
npm install @dotdo/postmark
```

### Basic Usage

```typescript
import { ServerClient } from '@dotdo/postmark'

const client = new ServerClient(process.env.POSTMARK_SERVER_TOKEN)

await client.sendEmail({
  From: 'sender@example.com',
  To: 'recipient@example.com',
  Subject: 'Hello from dotdo',
  TextBody: 'This is a test email.',
  HtmlBody: '<h1>Hello World</h1>',
})
```

### Multiple Recipients

```typescript
await client.sendEmail({
  From: 'sender@example.com',
  To: 'user1@example.com, user2@example.com',
  Subject: 'Team Update',
  HtmlBody: '<p>Important announcement...</p>',
})
```

### Batch Send

Send up to 500 emails in a single API call:

```typescript
await client.sendEmailBatch([
  {
    From: 'sender@example.com',
    To: 'user1@example.com',
    Subject: 'Personal Message 1',
    TextBody: 'Hello User 1',
  },
  {
    From: 'sender@example.com',
    To: 'user2@example.com',
    Subject: 'Personal Message 2',
    TextBody: 'Hello User 2',
  },
])
```

## Email Templates

Use Postmark-style templates with Mustache syntax.

### Send with Template

```typescript
await client.sendEmailWithTemplate({
  From: 'noreply@example.com',
  To: 'user@example.com',
  TemplateId: 12345,
  TemplateModel: {
    name: 'John',
    orderNumber: '12345',
    items: [
      { name: 'Widget', quantity: 2, price: 19.99 },
      { name: 'Gadget', quantity: 1, price: 49.99 },
    ],
  },
})
```

### Send with Template Alias

```typescript
await client.sendEmailWithTemplate({
  From: 'noreply@example.com',
  To: 'user@example.com',
  TemplateAlias: 'order-confirmation',
  TemplateModel: {
    name: 'John',
    orderNumber: '12345',
  },
})
```

### Batch Template Send

```typescript
await client.sendEmailBatchWithTemplates([
  {
    From: 'noreply@example.com',
    To: 'user1@example.com',
    TemplateAlias: 'welcome',
    TemplateModel: { name: 'Alice' },
  },
  {
    From: 'noreply@example.com',
    To: 'user2@example.com',
    TemplateAlias: 'welcome',
    TemplateModel: { name: 'Bob' },
  },
])
```

## Attachments

```typescript
await client.sendEmail({
  From: 'billing@example.com',
  To: 'user@example.com',
  Subject: 'Your Invoice',
  TextBody: 'Please find your invoice attached.',
  Attachments: [
    {
      Name: 'invoice.pdf',
      Content: Buffer.from(pdfData).toString('base64'),
      ContentType: 'application/pdf',
    },
    {
      Name: 'logo.png',
      Content: logoBase64,
      ContentType: 'image/png',
      ContentID: 'cid:logo',
    },
  ],
})
```

Inline attachments can be referenced in HTML with `<img src="cid:logo">`.

## Inbound Mode - Local Development

For local development and testing, use `postmark.do` as a drop-in replacement endpoint:

```typescript
import { ServerClient } from '@dotdo/postmark'

const client = new ServerClient('your-server-token', {
  baseUrl: 'https://postmark.do', // Routes to your local DO
})

await client.sendEmail({
  From: 'dev@example.com',
  To: 'test@example.com',
  Subject: 'Test Email',
  TextBody: 'Testing in development',
})
```

Emails are captured locally in DO SQLite for inspection without hitting Postmark servers.

## Outbound Mode - Production

In production, connect to real Postmark:

```typescript
import { ServerClient } from '@dotdo/postmark'

const client = new ServerClient(process.env.POSTMARK_SERVER_TOKEN)
// Default baseUrl: https://api.postmarkapp.com

await client.sendEmail({
  From: 'hello@yourcompany.com',
  To: 'customer@example.com',
  Subject: 'Welcome!',
  HtmlBody: '<h1>Welcome to our platform</h1>',
})
```

## Message Streams

Use message streams to separate transactional and broadcast emails:

```typescript
// Transactional (default)
await client.sendEmail({
  From: 'orders@example.com',
  To: 'customer@example.com',
  Subject: 'Order Confirmation',
  TextBody: 'Your order has been confirmed.',
  MessageStream: 'outbound',
})

// Broadcast
await client.sendEmail({
  From: 'newsletter@example.com',
  To: 'subscriber@example.com',
  Subject: 'Weekly Newsletter',
  HtmlBody: '<h1>This Week in Tech</h1>',
  MessageStream: 'broadcast',
})
```

## Durable Client

For exactly-once delivery guarantees with idempotency:

```typescript
import { DurablePostmarkClient } from '@dotdo/postmark'

const client = new DurablePostmarkClient({
  serverToken: process.env.POSTMARK_SERVER_TOKEN,
  eventIdTtl: 24 * 60 * 60 * 1000, // 24 hours
  maxBufferedEmails: 100,
})

// Idempotent send - safe to retry
await client.sendEmail({
  From: 'noreply@example.com',
  To: 'user@example.com',
  Subject: 'Order Confirmation',
  TextBody: 'Your order has been confirmed.',
}, { idempotencyKey: 'order-123-confirmation' })

// Check if already processed
if (await client.isProcessed('order-123-confirmation')) {
  console.log('Already sent')
}

// Transactional batch
await client.transaction(async (tx) => {
  await tx.queueEmail({ From: 'noreply@example.com', To: 'user1@example.com', Subject: 'Update', TextBody: '...' })
  await tx.queueEmail({ From: 'noreply@example.com', To: 'user2@example.com', Subject: 'Update', TextBody: '...' })
})
await client.flush()

// Email logs with time-travel
const log = await client.getEmailLog('order-123-confirmation')
const history = await client.getEmailStatusHistory('order-123-confirmation')
// [{ status: 'queued', timestamp: ... }, { status: 'sent', timestamp: ... }]
```

## Template Management

Manage templates locally with DO-backed storage:

```typescript
import { TemplateManager } from '@dotdo/postmark'

const manager = new TemplateManager({
  kv: env.TEMPLATES_KV, // or sql: ctx.storage.sql
})

// Create template
const template = await manager.create({
  Name: 'Order Confirmation',
  Alias: 'order-confirmation',
  Subject: 'Order #{{orderNumber}} Confirmed',
  HtmlBody: `
    <h1>Thank you, {{name}}!</h1>
    <p>Your order #{{orderNumber}} has been confirmed.</p>
    <ul>
      {{#items}}
        <li>{{name}} x {{quantity}}</li>
      {{/items}}
    </ul>
  `,
  TextBody: 'Thank you, {{name}}! Your order #{{orderNumber}} has been confirmed.',
})

// Render template
const { Subject, HtmlBody, TextBody } = await manager.render('order-confirmation', {
  name: 'John',
  orderNumber: '12345',
  items: [
    { name: 'Widget', quantity: 2 },
  ],
})

// List templates
const templates = await manager.list()

// Get template by alias
const orderTemplate = await manager.getByAlias('order-confirmation')
```

## Webhooks

Handle Postmark webhook events:

```typescript
import { PostmarkWebhook } from '@dotdo/postmark'

const webhook = new PostmarkWebhook({
  secret: process.env.POSTMARK_WEBHOOK_SECRET,
})

// In your Hono/Express handler
app.post('/webhooks/postmark', async (c) => {
  const event = await webhook.parse(c.req.raw)

  switch (event.RecordType) {
    case 'Delivery':
      await handleDelivery(event)
      break
    case 'Bounce':
      await handleBounce(event)
      break
    case 'SpamComplaint':
      await handleSpamComplaint(event)
      break
    case 'Open':
      await handleOpen(event)
      break
    case 'Click':
      await handleClick(event)
      break
  }

  return c.json({ received: true })
})
```

## Bounce Management

```typescript
// Get bounces
const bounces = await client.getBounces({
  count: 50,
  offset: 0,
  type: 'HardBounce',
})

// Get single bounce
const bounce = await client.getBounce(123456789)

// Activate a bounce (allow sending again)
await client.activateBounce(123456789)

// Get bounce tags
const tags = await client.getBounceTags()
```

## Server Management

```typescript
// Get server info
const server = await client.getServer()

// Update server settings
await client.editServer({
  Name: 'Production',
  Color: 'green',
  SmtpApiActivated: true,
  DeliveryHookUrl: 'https://yourapp.com/webhooks/postmark',
})
```

## TypeScript Types

Full TypeScript support with Postmark-compatible types:

```typescript
import type {
  // Message types
  Message,
  MessageSendingResponse,
  TemplatedMessage,
  Attachment,

  // Client types
  ServerClient,
  AccountClient,
  ClientOptions,

  // Template types
  Template,
  TemplateCreateRequest,
  TemplateEditRequest,
  TemplateValidationResponse,

  // Bounce types
  Bounce,
  Bounces,
  BounceActivateResponse,

  // Webhook types
  DeliveryWebhook,
  BounceWebhook,
  SpamComplaintWebhook,
  OpenWebhook,
  ClickWebhook,

  // Durable types
  DurablePostmarkClient,
  DurableSendOptions,
  EmailLog,
} from '@dotdo/postmark'
```

## Error Handling

```typescript
import { ServerClient, PostmarkError } from '@dotdo/postmark'

const client = new ServerClient(process.env.POSTMARK_SERVER_TOKEN)

try {
  await client.sendEmail({
    From: 'invalid@not-verified.com',
    To: 'user@example.com',
    Subject: 'Test',
    TextBody: 'Hello',
  })
} catch (error) {
  if (error instanceof PostmarkError) {
    console.error('Postmark error:', error.code, error.message)
    // Common error codes:
    // 10 - Bad or missing API token
    // 300 - Invalid email request
    // 406 - Inactive recipient
  }
}
```

## Migration from postmark

### Package Change

```bash
# Remove
npm uninstall postmark

# Install
npm install @dotdo/postmark
```

### Import Change

```typescript
// Before
import { ServerClient } from 'postmark'

// After
import { ServerClient } from '@dotdo/postmark'

// Everything else stays the same
const client = new ServerClient(process.env.POSTMARK_SERVER_TOKEN)
await client.sendEmail({ ... })
```

### Account Client

```typescript
// Before
import { AccountClient } from 'postmark'
const account = new AccountClient(process.env.POSTMARK_ACCOUNT_TOKEN)

// After
import { AccountClient } from '@dotdo/postmark'
const account = new AccountClient(process.env.POSTMARK_ACCOUNT_TOKEN)

// Same API
const servers = await account.getServers()
```

## Architecture

```
┌─────────────────────────────────────────────────────────────┐
│                 client.sendEmail(data)                       │
│            DurablePostmarkClient.sendEmail()                 │
└─────────────────────────────────────────────────────────────┘
                              │
              ┌───────────────┴───────────────┐
              ▼                               ▼
┌──────────────────────────┐    ┌──────────────────────────┐
│    Development Mode       │    │    Production Mode        │
│   baseUrl: postmark.do    │    │   baseUrl: api.postmarkapp.com │
│                           │    │                           │
│   ┌───────────────────┐  │    │   Real Postmark API       │
│   │    Durable Object  │  │    │   Emails delivered        │
│   │    SQLite Storage  │  │    │   Webhooks enabled        │
│   │                    │  │    │                           │
│   │  - Email logs      │  │    └──────────────────────────┘
│   │  - Templates       │  │
│   │  - Deduplication   │  │
│   │  - Audit trail     │  │
│   └───────────────────┘  │
└──────────────────────────┘
```

## Common Patterns

### Welcome Email Flow

```typescript
import { ServerClient } from '@dotdo/postmark'

const client = new ServerClient(process.env.POSTMARK_SERVER_TOKEN)

async function sendWelcomeEmail(user: { email: string; name: string }) {
  await client.sendEmailWithTemplate({
    From: 'welcome@yourapp.com',
    To: user.email,
    TemplateAlias: 'welcome',
    TemplateModel: {
      name: user.name,
      loginUrl: 'https://yourapp.com/login',
    },
  })
}
```

### Transactional Notifications

```typescript
import { DurablePostmarkClient } from '@dotdo/postmark'

const client = new DurablePostmarkClient({
  serverToken: process.env.POSTMARK_SERVER_TOKEN,
})

async function sendOrderConfirmation(order: Order) {
  await client.sendEmailWithTemplate({
    From: 'orders@yourstore.com',
    To: order.customerEmail,
    TemplateAlias: 'order-confirmation',
    TemplateModel: {
      orderNumber: order.id,
      items: order.items,
      total: order.total,
    },
  }, {
    // Idempotent - safe to retry if delivery uncertain
    idempotencyKey: `order-${order.id}-confirmation`,
  })
}
```

### Password Reset

```typescript
async function sendPasswordReset(email: string, resetToken: string) {
  await client.sendEmailWithTemplate({
    From: 'security@yourapp.com',
    To: email,
    TemplateAlias: 'password-reset',
    TemplateModel: {
      resetUrl: `https://yourapp.com/reset?token=${resetToken}`,
      expiresIn: '1 hour',
    },
    Tag: 'password-reset',
  })
}
```

## Integration with Email Channels

Use Postmark with dotdo's email channel system for human-in-the-loop workflows:

```typescript
import { EmailChannel } from 'dotdo/channels/email'

const email = new EmailChannel({
  provider: 'postmark',
  serverToken: process.env.POSTMARK_SERVER_TOKEN,
  from: 'approvals@yourcompany.com',
  tracking: { opens: true },
})

// Send notification
await email.send({
  to: 'manager@example.com',
  subject: 'Expense Report Submitted',
  message: 'John submitted an expense report for $500.',
})

// Use with approval workflows
import { renderApprovalEmail } from 'dotdo/channels/email'

const { html, text } = renderApprovalEmail({
  message: 'Please approve this expense report',
  requestId: 'expense-123',
  baseUrl: 'https://app.yourcompany.com',
  metadata: {
    amount: '$500',
    submitter: 'John Smith',
  },
  returnBoth: true,
})

await client.sendEmail({
  From: 'approvals@yourcompany.com',
  To: 'approver@example.com',
  Subject: 'Approval Required: Expense Report',
  HtmlBody: html,
  TextBody: text,
})
```

## Related

- [SendGrid Integration](/docs/integrations/sendgrid) - Alternative email provider
- [Messaging SDKs](/docs/compat/messaging) - Email, SMS, and more
- [Human Escalation](/docs/humans/escalation) - Email-based approval workflows
- [Compat SDKs Overview](/docs/compat) - All API-compatible SDKs
