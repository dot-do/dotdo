---
title: Salesforce
description: Drop-in replacement for the jsforce SDK with edge compatibility and local testing support.
---

# Salesforce

Drop-in replacement for the jsforce JavaScript SDK. Your existing Salesforce code works unchanged - just swap the import.

```typescript
// Before: jsforce
import jsforce from 'jsforce'

// After: dotdo
import jsforce from '@dotdo/salesforce'

// Code stays the same
const conn = new jsforce.Connection({
  loginUrl: 'https://login.salesforce.com',
})

await conn.login('user@example.com', 'password+securitytoken')

const result = await conn.query(
  "SELECT Id, Name, Industry FROM Account WHERE Industry = 'Technology'"
)

const account = await conn.sobject('Account').create({
  Name: 'Acme Inc',
  Industry: 'Technology',
})
```

## Why salesforce.do?

| jsforce SDK | @dotdo/salesforce |
|-------------|-------------------|
| Node.js runtime required | Edge-compatible (Cloudflare Workers) |
| Real API calls in tests | Local testing with SalesforceLocal (planned) |
| Network latency | Zero latency in local mode |
| Complex SOAP setup | Simplified REST-first API |
| Bulky dependencies | Lightweight, tree-shakeable |

**This is a proxy/compatibility layer.** It connects to real Salesforce APIs for production use. The API surface matches jsforce's official SDK, making migration seamless.

## Features

### Implemented (Core APIs)

**SObjects (Full CRUD)**
- `create()` - Create single or multiple records
- `retrieve()` - Get records by ID with field selection
- `update()` - Update single or multiple records
- `destroy()` - Delete single or multiple records
- `upsert()` - Insert or update by external ID
- `describe()` - Get SObject metadata (with caching)
- `find()` - Query builder interface

**SOQL Queries**
- `query()` - Execute SOQL queries
- `queryAll()` - Include deleted/archived records
- `queryMore()` - Paginate through large result sets
- Query builder with `select()`, `where()`, `orderBy()`, `limit()`, `offset()`

**Bulk API 2.0**
- `bulk.createJob()` - Create insert/update/upsert/delete jobs
- `bulk.query()` - Bulk query for large datasets
- `bulk.queryAll()` - Bulk query including deleted records
- CSV data handling
- Job status monitoring

**OAuth 2.0 Authentication**
- Username/password flow
- Web server flow (authorization code)
- JWT bearer token flow
- Client credentials flow
- Token refresh

**Analytics (Reports & Dashboards)**
- `analytics.report()` - Get report by ID
- `report.execute()` - Run reports with filters
- `report.executeAsync()` - Async report execution
- `report.describe()` - Report metadata
- `analytics.dashboards()` - List dashboards

**Metadata API**
- `metadata.read()` - Read metadata components
- `metadata.list()` - List metadata by type

**Other**
- `describeGlobal()` - List all SObjects
- `identity()` - Get current user info
- `limits()` - Get org API limits

### Standard SObjects

Works with all standard Salesforce objects including:

| Object | Description |
|--------|-------------|
| Account | Companies and organizations |
| Contact | People associated with accounts |
| Lead | Potential customers |
| Opportunity | Sales deals and pipeline |
| Case | Customer service issues |
| Task | To-do items and activities |
| Event | Calendar events |
| User | Salesforce users |
| Campaign | Marketing campaigns |
| Product2 | Products in your catalog |
| PricebookEntry | Product prices |
| Quote | Sales quotes |
| Contract | Customer contracts |
| Order | Customer orders |

### Not Yet Implemented

- Streaming API (PushTopic, Platform Events, CDC)
- Apex REST/SOAP callouts
- Tooling API
- Chatter API
- SalesforceLocal (local testing mode)

## Quick Start

### Install

```bash
npm install @dotdo/salesforce
```

### Basic Usage

```typescript
import jsforce from '@dotdo/salesforce'

const conn = new jsforce.Connection({
  loginUrl: 'https://login.salesforce.com',
})

// Authenticate
await conn.login('user@example.com', 'password+securitytoken')

// Query accounts
const result = await conn.query(`
  SELECT Id, Name, Industry, Website
  FROM Account
  WHERE Industry = 'Technology'
  LIMIT 10
`)

console.log(`Found ${result.totalSize} accounts`)
for (const account of result.records) {
  console.log(`- ${account.Name} (${account.Industry})`)
}
```

### Create Records

```typescript
// Create a single account
const account = await conn.sobject('Account').create({
  Name: 'Acme Inc',
  Industry: 'Technology',
  Website: 'https://acme.com',
  Description: 'A technology company',
})

console.log('Created account:', account.id)

// Create a contact linked to the account
const contact = await conn.sobject('Contact').create({
  FirstName: 'John',
  LastName: 'Doe',
  Email: 'john@acme.com',
  AccountId: account.id,
})
```

### Create Multiple Records

```typescript
// Batch create (up to 200 records)
const accounts = await conn.sobject('Account').create([
  { Name: 'Company A', Industry: 'Finance' },
  { Name: 'Company B', Industry: 'Healthcare' },
  { Name: 'Company C', Industry: 'Retail' },
])

for (const result of accounts) {
  if (result.success) {
    console.log('Created:', result.id)
  } else {
    console.error('Failed:', result.errors)
  }
}
```

### Update Records

```typescript
// Update a single record
const result = await conn.sobject('Account').update({
  Id: '001xx000003DGxYAAW',
  Website: 'https://newsite.com',
  Description: 'Updated description',
})

// Update multiple records
const results = await conn.sobject('Account').update([
  { Id: '001xx000003DGxYAAW', Industry: 'Technology' },
  { Id: '001xx000003DGxZAAW', Industry: 'Finance' },
])
```

### Upsert Records

```typescript
// Insert or update by external ID
const result = await conn.sobject('Account').upsert(
  {
    External_ID__c: 'EXT-001',
    Name: 'Acme Inc',
    Industry: 'Technology',
  },
  'External_ID__c' // External ID field name
)

console.log(result.created ? 'Inserted' : 'Updated', result.id)
```

### Delete Records

```typescript
// Delete a single record
await conn.sobject('Account').destroy('001xx000003DGxYAAW')

// Delete multiple records
await conn.sobject('Account').destroy([
  '001xx000003DGxYAAW',
  '001xx000003DGxZAAW',
])
```

## Inbound - Using salesforce.do Locally

> **Coming Soon:** SalesforceLocal will provide a complete in-memory Salesforce implementation for testing and development.

```typescript
// Planned API
import { SalesforceLocal } from '@dotdo/salesforce/local'

const conn = new SalesforceLocal()

// Use exactly like real Salesforce
const account = await conn.sobject('Account').create({
  Name: 'Test Account',
})

const result = await conn.query('SELECT Id, Name FROM Account')
```

For now, use Salesforce sandbox orgs or developer editions for testing.

## Outbound - Connecting to Real Salesforce

For production, connect to Salesforce's APIs:

```typescript
import { Connection } from '@dotdo/salesforce'

// Production org
const conn = new Connection({
  loginUrl: 'https://login.salesforce.com',
})

// Sandbox org
const sandboxConn = new Connection({
  loginUrl: 'https://test.salesforce.com',
})

await conn.login(env.SF_USERNAME, env.SF_PASSWORD + env.SF_SECURITY_TOKEN)
```

### Edge Compatibility

Works in Cloudflare Workers without Node.js dependencies:

```typescript
// worker.ts
import { Connection } from '@dotdo/salesforce'

export default {
  async fetch(request: Request, env: Env): Promise<Response> {
    const conn = new Connection({
      instanceUrl: env.SF_INSTANCE_URL,
      accessToken: env.SF_ACCESS_TOKEN,
    })

    const accounts = await conn.query(
      'SELECT Id, Name FROM Account LIMIT 5'
    )

    return Response.json(accounts.records)
  },
}
```

### Pre-Authenticated Sessions

If you already have tokens (e.g., from OAuth callback):

```typescript
const conn = new Connection({
  instanceUrl: 'https://na1.salesforce.com',
  accessToken: 'existing_access_token',
  refreshToken: 'existing_refresh_token',
  oauth2: {
    clientId: env.SF_CLIENT_ID,
    clientSecret: env.SF_CLIENT_SECRET,
    redirectUri: 'https://myapp.com/callback',
  },
})

// Refresh token when expired
await conn.oauth2.refreshToken()
```

### Custom Configuration

```typescript
const conn = new Connection({
  loginUrl: 'https://login.salesforce.com',
  version: '59.0',              // API version
  maxNetworkRetries: 3,         // Retry count
  timeout: 60000,               // Request timeout (ms)
  fetch: customFetch,           // Custom fetch implementation
})
```

## SOQL Queries

### Basic Queries

```typescript
// Simple query
const result = await conn.query('SELECT Id, Name FROM Account')

// With WHERE clause
const techAccounts = await conn.query(`
  SELECT Id, Name, Industry, AnnualRevenue
  FROM Account
  WHERE Industry = 'Technology'
    AND AnnualRevenue > 1000000
  ORDER BY AnnualRevenue DESC
  LIMIT 100
`)
```

### Query Builder

```typescript
// Fluent query building
const result = await conn
  .sobject('Account')
  .find({ Industry: 'Technology' })
  .select(['Id', 'Name', 'Website', 'AnnualRevenue'])
  .orderBy('AnnualRevenue', 'DESC')
  .limit(50)
  .execute()
```

### Advanced Where Conditions

```typescript
// Using operators
const result = await conn
  .sobject('Opportunity')
  .find({
    Amount: { $gte: 100000 },
    StageName: { $in: ['Prospecting', 'Qualification', 'Negotiation'] },
    CloseDate: { $lte: new Date('2024-12-31') },
  })
  .execute()

// Available operators:
// $eq, $ne, $lt, $lte, $gt, $gte
// $like, $in, $nin
// $includes, $excludes (for multi-select picklists)
```

### Paginated Results

```typescript
// Handle large result sets
let result = await conn.query('SELECT Id, Name FROM Account')
let allRecords = [...result.records]

while (!result.done) {
  result = await conn.queryMore(result.nextRecordsUrl!)
  allRecords.push(...result.records)
}

console.log(`Total records: ${allRecords.length}`)
```

### Include Deleted Records

```typescript
// Query including deleted/archived records
const result = await conn.queryAll(
  'SELECT Id, Name, IsDeleted FROM Account'
)
```

## Bulk API

Use the Bulk API 2.0 for large data operations (thousands to millions of records).

### Bulk Insert

```typescript
const job = conn.bulk.createJob('Account', 'insert')
const batch = job.createBatch()

// Add records (can be array or CSV string)
batch.execute([
  { Name: 'Account 1', Industry: 'Technology' },
  { Name: 'Account 2', Industry: 'Finance' },
  { Name: 'Account 3', Industry: 'Healthcare' },
  // ... thousands more
])

// Wait for batch to be queued
await new Promise(resolve => batch.on('queue', resolve))

// Poll for results
const results = await batch.poll()

for (const result of results) {
  if (result.success) {
    console.log('Created:', result.id)
  } else {
    console.error('Failed:', result.errors)
  }
}
```

### Bulk Update

```typescript
const job = conn.bulk.createJob('Account', 'update')
const batch = job.createBatch()

batch.execute([
  { Id: '001xx000003DGxYAAW', Website: 'https://site1.com' },
  { Id: '001xx000003DGxZAAW', Website: 'https://site2.com' },
])

await new Promise(resolve => batch.on('queue', resolve))
const results = await batch.poll()
```

### Bulk Upsert

```typescript
const job = conn.bulk.createJob('Account', 'upsert', {
  externalIdFieldName: 'External_ID__c',
})
const batch = job.createBatch()

batch.execute([
  { External_ID__c: 'EXT-001', Name: 'Account 1' },
  { External_ID__c: 'EXT-002', Name: 'Account 2' },
])
```

### Bulk Delete

```typescript
const job = conn.bulk.createJob('Account', 'delete')
const batch = job.createBatch()

batch.execute([
  { Id: '001xx000003DGxYAAW' },
  { Id: '001xx000003DGxZAAW' },
])
```

### Bulk Query

```typescript
// For querying millions of records
const queryJob = await conn.bulk.query(
  'SELECT Id, Name, Industry FROM Account'
)

const records = await queryJob.poll()
console.log(`Retrieved ${records.length} records`)
```

## OAuth 2.0 Flows

### Web Server Flow

```typescript
const conn = new Connection({
  loginUrl: 'https://login.salesforce.com',
  oauth2: {
    clientId: env.SF_CLIENT_ID,
    clientSecret: env.SF_CLIENT_SECRET,
    redirectUri: 'https://myapp.com/oauth/callback',
  },
})

// 1. Generate authorization URL
const authUrl = conn.oauth2.getAuthorizationUrl({
  scope: 'api refresh_token',
  state: 'random_state_string',
})
// Redirect user to authUrl

// 2. Handle callback with authorization code
await conn.authorize({ code: authorizationCodeFromCallback })

// 3. Now authenticated - make API calls
const accounts = await conn.query('SELECT Id, Name FROM Account')
```

### JWT Bearer Token Flow

For server-to-server authentication:

```typescript
const conn = new Connection({
  loginUrl: 'https://login.salesforce.com',
})

await conn.authorize({
  grant_type: 'urn:ietf:params:oauth:grant-type:jwt-bearer',
  assertion: jwtToken, // Your signed JWT
})
```

### Client Credentials Flow

```typescript
const conn = new Connection({
  loginUrl: 'https://login.salesforce.com',
  oauth2: {
    clientId: env.SF_CLIENT_ID,
    clientSecret: env.SF_CLIENT_SECRET,
  },
})

await conn.authorize({
  grant_type: 'client_credentials',
})
```

### Token Refresh

```typescript
// Refresh expired access token
await conn.oauth2.refreshToken()
```

## Reports & Analytics

### Execute Reports

```typescript
// Get a report
const report = await conn.analytics.report('00Oxx0000004567AAA')

// Execute synchronously
const result = await report.execute({
  details: true, // Include detail rows
})

// Access aggregates
const totalAmount = result.factMap['T!T'].aggregates[0].value

// Access detail rows
for (const row of result.factMap['T!T'].rows || []) {
  console.log(row.dataCells.map(cell => cell.label).join(', '))
}
```

### Execute with Filters

```typescript
const result = await report.execute({
  details: true,
  reportFilters: [
    { column: 'ACCOUNT.INDUSTRY', operator: 'equals', value: 'Technology' },
  ],
})
```

### Async Report Execution

For long-running reports:

```typescript
const report = await conn.analytics.report('00Oxx0000004567AAA')

// Start async execution
const instance = await report.executeAsync()
console.log('Report instance:', instance.id)

// Poll for completion (instance status: New, Running, Success, Error)
```

### List Dashboards

```typescript
const dashboards = await conn.analytics.dashboards()

for (const dashboard of dashboards.dashboards) {
  console.log(`${dashboard.name} (${dashboard.id})`)
}
```

## Metadata Operations

### Describe Objects

```typescript
// List all objects
const global = await conn.describeGlobal()

for (const obj of global.sobjects) {
  if (obj.queryable) {
    console.log(`${obj.name} - ${obj.label}`)
  }
}

// Describe specific object
const accountMeta = await conn.sobject('Account').describe()

console.log('Fields:')
for (const field of accountMeta.fields) {
  console.log(`  ${field.name} (${field.type}) - ${field.label}`)
}
```

### Read Metadata

```typescript
// Read custom object metadata
const metadata = await conn.metadata.read('CustomObject', 'MyObject__c')

// List metadata components
const components = await conn.metadata.list([
  { type: 'CustomObject' },
  { type: 'ApexClass' },
])
```

### Check Org Limits

```typescript
const limits = await conn.limits()

console.log('API Requests:',
  `${limits.DailyApiRequests.Remaining}/${limits.DailyApiRequests.Max}`)
console.log('Data Storage:',
  `${limits.DataStorageMB.Remaining}/${limits.DataStorageMB.Max} MB`)
```

## Error Handling

```typescript
import { Connection, SalesforceError } from '@dotdo/salesforce'

try {
  await conn.query('SELECT InvalidField FROM Account')
} catch (error) {
  if (error instanceof SalesforceError) {
    console.log('Error Code:', error.errorCode)   // 'MALFORMED_QUERY'
    console.log('Message:', error.message)        // Error description
    console.log('Status:', error.statusCode)      // HTTP status code
    console.log('Fields:', error.fields)          // Affected fields (if any)
  }
}
```

### Common Error Codes

| Error Code | Description |
|------------|-------------|
| `INVALID_FIELD` | Field doesn't exist on object |
| `MALFORMED_QUERY` | Invalid SOQL syntax |
| `INVALID_TYPE` | SObject type doesn't exist |
| `REQUIRED_FIELD_MISSING` | Required field not provided |
| `DUPLICATE_VALUE` | Unique constraint violation |
| `INVALID_CROSS_REFERENCE_KEY` | Invalid relationship ID |
| `INSUFFICIENT_ACCESS_ON_CROSS_REFERENCE_ENTITY` | No access to related record |
| `ENTITY_IS_DELETED` | Record has been deleted |
| `REQUEST_LIMIT_EXCEEDED` | API limits exceeded |

## Types

Full TypeScript support with comprehensive type definitions:

```typescript
import type {
  // Core types
  SObject,
  SaveResult,
  UpsertResult,
  QueryResult,
  UserInfo,
  Identity,

  // Connection types
  ConnectionConfig,
  TokenResponse,
  OAuth2Config,

  // Describe types
  DescribeGlobalResult,
  DescribeSObjectResult,
  DescribeField,
  FieldType,

  // Bulk types
  BulkOperation,
  BulkJobInfo,
  BulkJob,
  BulkBatch,
  BulkResult,

  // Analytics types
  Report,
  ReportResult,
  ReportMetadata,

  // Query builder types
  WhereConditions,
  OrderDirection,

  // Error types
  SalesforceErrorData,
} from '@dotdo/salesforce'
```

## Migration from jsforce

### Package Change

```bash
# Remove
npm uninstall jsforce

# Install
npm install @dotdo/salesforce
```

### Import Change

```typescript
// Before
import jsforce from 'jsforce'
const conn = new jsforce.Connection({...})

// After (default import - matches jsforce)
import jsforce from '@dotdo/salesforce'
const conn = new jsforce.Connection({...})

// Or named import
import { Connection } from '@dotdo/salesforce'
const conn = new Connection({...})
```

### Code Compatibility

Your existing jsforce code should work unchanged:

```typescript
// This code works with both jsforce and @dotdo/salesforce
const conn = new jsforce.Connection({
  loginUrl: 'https://login.salesforce.com',
})

await conn.login('user@example.com', 'password+token')

const accounts = await conn.query('SELECT Id, Name FROM Account')

const newAccount = await conn.sobject('Account').create({
  Name: 'New Account',
})

const job = conn.bulk.createJob('Account', 'insert')
```

## Architecture

```
+-------------------------------------------------------------+
|                    Your Application                          |
|                                                              |
|  const conn = new Connection(config)                         |
|  await conn.query(...)                                       |
+-------------------------------------------------------------+
                              |
              +---------------+---------------+
              |                               |
              v                               v
+-------------------------+     +-------------------------+
|   Production Mode       |     |     Local Mode          |
|   (Connection)          |     |     (SalesforceLocal)   |
+-------------------------+     +-------------------------+
|                         |     |                         |
|  -> login.salesforce.com|     |  -> In-memory storage   |
|  -> Real API calls      |     |  -> No network calls    |
|  -> OAuth flows         |     |  -> Test data           |
|  -> Full Salesforce API |     |  -> Coming soon!        |
|                         |     |                         |
+-------------------------+     +-------------------------+
```

## Common Patterns

### CRM Data Sync

```typescript
import { Connection } from '@dotdo/salesforce'

const conn = new Connection({
  instanceUrl: env.SF_INSTANCE_URL,
  accessToken: env.SF_ACCESS_TOKEN,
})

// Sync accounts from Salesforce to your system
async function syncAccounts(lastSyncDate: Date) {
  const result = await conn.query(`
    SELECT Id, Name, Industry, Website, Phone, BillingAddress
    FROM Account
    WHERE LastModifiedDate > ${lastSyncDate.toISOString()}
  `)

  for (const account of result.records) {
    await upsertToLocalDB({
      salesforceId: account.Id,
      name: account.Name,
      industry: account.Industry,
      website: account.Website,
    })
  }

  return result.totalSize
}
```

### Lead Capture

```typescript
async function captureWebLead(formData: LeadForm) {
  const lead = await conn.sobject('Lead').create({
    FirstName: formData.firstName,
    LastName: formData.lastName,
    Email: formData.email,
    Company: formData.company,
    LeadSource: 'Web',
    Status: 'New',
    Description: formData.message,
  })

  return lead.id
}
```

### Opportunity Pipeline

```typescript
async function getOpenOpportunities(accountId: string) {
  return conn.query(`
    SELECT Id, Name, Amount, StageName, CloseDate, Probability
    FROM Opportunity
    WHERE AccountId = '${accountId}'
      AND IsClosed = false
    ORDER BY CloseDate ASC
  `)
}

async function updateOpportunityStage(
  opportunityId: string,
  newStage: string
) {
  return conn.sobject('Opportunity').update({
    Id: opportunityId,
    StageName: newStage,
  })
}
```

### Bulk Data Import

```typescript
async function importContacts(contacts: Contact[]) {
  const job = conn.bulk.createJob('Contact', 'insert')
  const batch = job.createBatch()

  batch.execute(
    contacts.map(c => ({
      FirstName: c.firstName,
      LastName: c.lastName,
      Email: c.email,
      Phone: c.phone,
      AccountId: c.accountId,
    }))
  )

  await new Promise(resolve => batch.on('queue', resolve))
  return batch.poll()
}
```

## API Coverage

| Resource | Coverage | Notes |
|----------|----------|-------|
| SObject CRUD | Full | All operations + composite |
| SOQL Query | Full | Including queryAll, queryMore |
| Query Builder | Full | Fluent interface |
| Bulk API 2.0 | Full | Insert, update, upsert, delete, query |
| OAuth 2.0 | Full | All flows |
| Describe | Full | Global and per-object |
| Analytics | Full | Reports and dashboards |
| Metadata API | Partial | Read and list |
| Identity | Full | User info |
| Limits | Full | Org limits |
| Streaming API | Not yet | PushTopic, Platform Events |
| Tooling API | Not yet | |
| Chatter API | Not yet | |

## Related

- [Events Overview](/docs/events) - Event handling patterns
- [Compat SDKs](/docs/compat) - All API-compatible SDKs
- [Stripe Integration](/docs/integrations/stripe) - Payment processing
- [Algolia Integration](/docs/integrations/algolia) - Search integration
