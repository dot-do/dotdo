---
title: "@dotdo/clerk"
description: Clerk-compatible authentication SDK for edge environments and testing.
---

# @dotdo/clerk

Drop-in replacement for `@clerk/clerk-sdk-node`. Same API, runs in-memory for testing and edge environments.

```typescript
import { createClerkClient } from '@dotdo/clerk'

const clerk = createClerkClient({
  secretKey: 'sk_test_...',
  publishableKey: 'pk_test_...',
})

const user = await clerk.users.createUser({
  email_address: ['alice@example.com'],
  password: 'SecurePassword123!',
  first_name: 'Alice',
})
```

<Callout type="info">
Looking for persistent storage? See [clerk.do](/docs/integrations/clerk/service) for a fully managed Clerk-compatible edge service.
</Callout>

## Why @dotdo/clerk?

| Clerk SDK | @dotdo/clerk |
|-----------|--------------|
| Node.js runtime required | Edge-compatible (Cloudflare Workers) |
| Requires Clerk account | In-memory, no external dependencies |
| Network latency | Zero latency |
| Per-MAU pricing | Free for testing |
| Complex test setup | Perfect for unit tests |

**This is an in-memory implementation** with a Clerk-compatible API. Data does not persist between restarts. Ideal for testing, prototyping, and development where you need authentication without external dependencies.

## Installation

```bash
npm install @dotdo/clerk
```

## Features

### Implemented (Core APIs)

**User Management**
- `createUser()`, `getUser()`, `getUserList()` - User CRUD
- `updateUser()`, `deleteUser()` - User modifications
- `banUser()`, `unbanUser()` - User banning
- `lockUser()`, `unlockUser()` - Account locking
- `verifyPassword()` - Password verification
- User metadata (public/private/unsafe)

**Sessions**
- `getSession()`, `getSessionList()` - Session retrieval
- `getToken()` - JWT generation with templates
- `revokeSession()` - Session revocation
- `verifyToken()` - JWT verification

**Organizations**
- `createOrganization()`, `getOrganization()` - Org CRUD
- `updateOrganization()`, `deleteOrganization()`
- `createOrganizationMembership()` - Add members
- `updateOrganizationMembership()` - Update roles
- `deleteOrganizationMembership()` - Remove members
- `createOrganizationInvitation()` - Send invites
- `revokeOrganizationInvitation()` - Revoke invites

**Roles & Permissions**
- `createOrganizationRole()` - Define custom roles
- Role-based permissions

**JWT Templates**
- `createJWTTemplate()` - Create templates
- `getJWTTemplate()`, `listJWTTemplates()`
- `updateJWTTemplate()`, `deleteJWTTemplate()`

**Verification**
- Email verification with codes
- Phone verification with codes
- TOTP verification
- MFA disable

**Webhooks**
- Svix-compatible webhook verification
- All standard Clerk event types

### Not Yet Implemented

- OAuth providers (Google, GitHub, etc.)
- SAML SSO
- Full TOTP enrollment flow
- Passkeys/WebAuthn

## Quick Start

### User Management

```typescript
import { createClerkClient } from '@dotdo/clerk'

const clerk = createClerkClient({
  secretKey: 'sk_test_...',
  publishableKey: 'pk_test_...',
})

// Create a user
const user = await clerk.users.createUser({
  email_address: ['user@example.com'],
  password: 'SecurePassword123!',
  first_name: 'John',
  last_name: 'Doe',
  public_metadata: { plan: 'pro' },
  private_metadata: { internal_id: 'usr_123' },
})

console.log(user.id) // user_abc123...

// Get user by ID
const fetchedUser = await clerk.users.getUser(user.id)

// Update user
const updated = await clerk.users.updateUser(user.id, {
  first_name: 'Jane',
  public_metadata: { plan: 'enterprise' },
})

// Delete user
await clerk.users.deleteUser(user.id)
```

### List & Search Users

```typescript
// List users by email
const { data: users } = await clerk.users.getUserList({
  email_address: ['user@example.com'],
})

// List users by ID
const { data: specific } = await clerk.users.getUserList({
  user_id: ['user_abc', 'user_def'],
})

// Paginated list
const { data, total_count } = await clerk.users.getUserList({
  limit: 20,
  offset: 0,
  order_by: '-created_at',
})
```

### Sessions

```typescript
// Get session by ID
const session = await clerk.sessions.getSession('sess_123')

// Get session token (JWT)
const { jwt } = await clerk.sessions.getToken(session.id)

// Verify token
const { userId, sessionId, claims } = await clerk.verifyToken(jwt, {
  authorizedParties: ['https://myapp.com'],
})

// List user sessions
const { data: sessions } = await clerk.sessions.getSessionList({
  user_id: user.id,
})

// Revoke session
await clerk.sessions.revokeSession(session.id)
```

### Organizations

```typescript
// Create organization
const org = await clerk.organizations.createOrganization({
  name: 'Acme Inc',
  slug: 'acme',
  created_by: user.id,
})

// Add member
const membership = await clerk.organizations.createOrganizationMembership({
  organizationId: org.id,
  userId: 'user_456',
  role: 'member',
})

// Update member role
await clerk.organizations.updateOrganizationMembership({
  organizationId: org.id,
  userId: 'user_456',
  role: 'admin',
})

// Send invitation
const invitation = await clerk.organizations.createOrganizationInvitation(org.id, {
  email_address: 'newuser@example.com',
  role: 'member',
  inviter_user_id: user.id,
})

// List organization members
const { data: members } = await clerk.organizations.getOrganizationMembershipList({
  organizationId: org.id,
})
```

### JWT Templates

```typescript
// Create JWT template for third-party integration
const template = await clerk.jwtTemplates.createJWTTemplate({
  name: 'supabase',
  claims: {
    role: 'authenticated',
    aud: 'authenticated',
  },
  lifetime: 3600,
})

// Get session token with template
const { jwt } = await clerk.sessions.getToken(session.id, 'supabase')
```

### User Verification

For email and phone verification, use the extended UsersAPI:

```typescript
import { createUsersManager } from '@dotdo/clerk'

const usersManager = createUsersManager({})

// Create email verification
const { verificationId, code } = await usersManager.createEmailVerification(
  user.id,
  'user@example.com'
)

// In production, send the code via email
// Then verify with the code user provides:
const verifiedUser = await usersManager.verifyEmail(user.id, code)

// Phone verification works the same way
const { verificationId: phoneVerificationId } = await usersManager.createPhoneVerification(
  user.id,
  '+1234567890'
)
```

### Password Management

```typescript
// Verify user password
const { verified } = await clerk.users.verifyPassword({
  userId: user.id,
  password: 'CurrentPassword123!',
})

// Update password via updateUser
await clerk.users.updateUser(user.id, {
  password: 'NewSecurePassword123!',
})
```

For advanced password management (strength checking, reset flows), use the extended UsersAPI:

```typescript
import { createUsersManager } from '@dotdo/clerk'

const usersManager = createUsersManager({ minPasswordLength: 8 })

// Check password strength
const strength = usersManager.checkPasswordStrength('MyP@ssw0rd!')
// { strength: 'strong', score: 6, warnings: [], suggestions: [] }

// Password reset flow
const { resetToken, expiresAt } = await usersManager.resetPassword(user.id)
```

### User Banning

```typescript
// Ban user
const banned = await clerk.users.banUser(user.id)
console.log(banned.banned) // true

// Check ban status by fetching user
const user = await clerk.users.getUser(user.id)
console.log(user.banned) // true

// Unban user
await clerk.users.unbanUser(user.id)
```

### MFA/TOTP

```typescript
// Verify TOTP code
const { verified } = await clerk.users.verifyTOTP({
  userId: user.id,
  code: '123456',
})

// Disable MFA for user
await clerk.users.disableMFA(user.id)
```

### Webhook Handling

```typescript
import { Webhook, WebhookVerificationError } from '@dotdo/clerk'

const webhook = new Webhook(process.env.CLERK_WEBHOOK_SECRET)

app.post('/webhooks/clerk', async (req, res) => {
  try {
    const event = await webhook.verify(req.body, {
      'svix-id': req.headers['svix-id'],
      'svix-timestamp': req.headers['svix-timestamp'],
      'svix-signature': req.headers['svix-signature'],
    })

    switch (event.type) {
      case 'user.created':
        await handleUserCreated(event.data)
        break
      case 'user.updated':
        await handleUserUpdated(event.data)
        break
      case 'session.created':
        await handleSessionCreated(event.data)
        break
      case 'organization.created':
        await handleOrgCreated(event.data)
        break
    }

    res.json({ received: true })
  } catch (error) {
    if (error instanceof WebhookVerificationError) {
      return res.status(400).json({ error: 'Invalid webhook signature' })
    }
    throw error
  }
})
```

## Type-Safe Usage

```typescript
import type {
  // Client types
  Clerk,
  ClerkClientOptions,

  // User types
  ClerkUser,
  ClerkEmailAddress,
  ClerkPhoneNumber,
  CreateUserParams,
  UpdateUserParams,

  // Session types
  ClerkSession,
  ClerkSessionClaims,

  // Organization types
  ClerkOrganization,
  ClerkOrganizationMembership,
  ClerkOrganizationInvitation,
  CreateOrganizationParams,

  // JWT types
  ClerkJWTTemplate,
  CreateJWTTemplateParams,

  // Response types
  ClerkPaginatedList,
  ClerkDeletedObject,

  // Webhook types
  ClerkWebhookEvent,
  ClerkWebhookEventType,

  // Error types
  ClerkError,
} from '@dotdo/clerk'
```

## Error Handling

```typescript
import { ClerkAPIError } from '@dotdo/clerk'

try {
  await clerk.users.getUser('nonexistent')
} catch (error) {
  if (error instanceof ClerkAPIError) {
    console.error('Status:', error.status)        // 404
    console.error('Trace ID:', error.clerkTraceId)
    console.error('Errors:', error.errors)
    // [{ code: 'resource_not_found', message: 'User not found' }]
  }
}

// Common error codes
// - resource_not_found: User, session, or organization not found
// - form_identifier_exists: Email, username, or phone already in use
// - form_password_pwned: Password too weak
// - session_not_active: Session is revoked or expired
// - verification_failed: Invalid verification code
// - verification_expired: Verification code expired
```

## Testing with @dotdo/clerk

@dotdo/clerk is ideal for unit tests - no external Clerk required:

```typescript
import { createClerkClient } from '@dotdo/clerk'

describe('AuthService', () => {
  let clerk: ReturnType<typeof createClerkClient>

  beforeEach(() => {
    // Fresh in-memory client for each test
    clerk = createClerkClient({
      secretKey: 'sk_test_...',
    })
  })

  it('should create and authenticate a user', async () => {
    const user = await clerk.users.createUser({
      email_address: ['test@example.com'],
      password: 'TestPassword123!',
    })
    expect(user.id).toBeDefined()

    const { verified } = await clerk.users.verifyPassword({
      userId: user.id,
      password: 'TestPassword123!',
    })
    expect(verified).toBe(true)
  })

  it('should manage organizations', async () => {
    const user = await clerk.users.createUser({
      email_address: ['owner@example.com'],
      password: 'TestPassword123!',
    })

    const org = await clerk.organizations.createOrganization({
      name: 'Test Org',
      created_by: user.id,
    })

    expect(org.name).toBe('Test Org')
  })
})
```

## Migration from Clerk SDK

### Package Change

```bash
# Remove
npm uninstall @clerk/clerk-sdk-node @clerk/backend

# Install
npm install @dotdo/clerk
```

### Import Change

```typescript
// Before
import { createClerkClient } from '@clerk/clerk-sdk-node'
import { Webhook } from 'svix'

// After
import { createClerkClient, Webhook } from '@dotdo/clerk'
```

### Environment Variables

```bash
# Same environment variables work
CLERK_SECRET_KEY=sk_test_...
CLERK_PUBLISHABLE_KEY=pk_test_...
CLERK_WEBHOOK_SECRET=whsec_...
```

## API Reference

### ClerkClient

| Method | Description |
|--------|-------------|
| `clerk.users.*` | User management API |
| `clerk.sessions.*` | Session management API |
| `clerk.organizations.*` | Organization management API |
| `clerk.jwtTemplates.*` | JWT template management |
| `clerk.verifyToken(token, options)` | Verify session token |

### Users API

| Method | Description |
|--------|-------------|
| `createUser(params)` | Create new user |
| `getUser(userId)` | Get user by ID |
| `getUserList(params)` | List/search users |
| `updateUser(userId, params)` | Update user (including password) |
| `deleteUser(userId)` | Delete user |
| `banUser(userId)` | Ban user |
| `unbanUser(userId)` | Unban user |
| `lockUser(userId)` | Lock user account |
| `unlockUser(userId)` | Unlock user account |
| `verifyPassword(params)` | Verify user password |
| `verifyTOTP(params)` | Verify TOTP code |
| `disableMFA(userId)` | Disable all MFA factors |

### Sessions API

| Method | Description |
|--------|-------------|
| `getSession(sessionId)` | Get session by ID |
| `getSessionList(params)` | List sessions |
| `getToken(sessionId, template?)` | Get session JWT |
| `revokeSession(sessionId)` | Revoke session |
| `verifySession(sessionId, token)` | Verify session and token |

### Organizations API

| Method | Description |
|--------|-------------|
| `createOrganization(params)` | Create organization |
| `getOrganization(orgId)` | Get organization |
| `updateOrganization(orgId, params)` | Update organization |
| `deleteOrganization(orgId)` | Delete organization |
| `createOrganizationMembership(params)` | Add member |
| `updateOrganizationMembership(params)` | Update member role |
| `deleteOrganizationMembership(params)` | Remove member |
| `createOrganizationInvitation(orgId, params)` | Send invitation |
| `revokeOrganizationInvitation(orgId, invitationId)` | Revoke invitation |

## Related

- [clerk.do](/docs/integrations/clerk/service) - Managed Clerk on the edge
- [Auth0 Integration](/docs/integrations/auth0) - Auth0 compatibility layer
- [API Middleware](/docs/api/middleware) - Request middleware including auth
