---
title: Shopify
description: Drop-in replacement for the Shopify API SDK with edge compatibility, webhook verification, and full Admin/Storefront API support.
---

# Shopify

Drop-in replacement for the Shopify JavaScript SDK (`@shopify/shopify-api`). Your existing Shopify code works unchanged - just swap the import.

```typescript
// Before: Shopify SDK
import { shopifyApi, LATEST_API_VERSION } from '@shopify/shopify-api'

// After: dotdo (import from compat/shopify)
import { shopifyApi, LATEST_API_VERSION } from 'compat/shopify'

// Code stays the same
const shopify = shopifyApi({
  apiKey: 'your-api-key',
  apiSecretKey: 'your-api-secret',
  scopes: ['read_products', 'write_orders'],
  hostName: 'my-store.myshopify.com',
  apiVersion: LATEST_API_VERSION,
})

const session = await shopify.auth.tokenExchange({ shop, code })
const restClient = new shopify.clients.Rest({ session })

const products = await restClient.get({ path: 'products' })
```

## Why @dotdo/shopify?

| Shopify SDK | dotdo Shopify |
|-------------|---------------|
| Node.js runtime required | Edge-compatible (Cloudflare Workers) |
| Complex session management | Simplified session handling |
| Limited retry configuration | Configurable retries with exponential backoff |
| Separate Storefront client | Unified Admin + Storefront APIs |
| No Flow automation support | Built-in Flow workflow engine |
| Basic webhook validation | Full webhook utilities with HMAC verification |
| No Shopify Functions support | Native Functions API for discounts, payments, delivery |

**This is a compatibility layer.** It forwards to real Shopify APIs in production while providing full TypeScript support and edge runtime compatibility.

## Features

### Admin API (REST & GraphQL)

**Products**
- `products.list()`, `products.get()`, `products.create()`, `products.update()`, `products.delete()`
- `products.variants` - Variant CRUD operations
- `products.images` - Product image management
- `products.metafields` - Product metafields

**Collections**
- Custom Collections (manual product assignment)
- Smart Collections (rule-based)
- Collects (product-collection associations)
- Collection metafields

**Orders**
- `orders.list()`, `orders.get()`, `orders.create()`, `orders.update()`, `orders.delete()`
- `orders.close()`, `orders.open()`, `orders.cancel()`
- `orders.fulfillments` - Fulfillment management
- `orders.refunds` - Refund processing
- `orders.transactions` - Payment transactions
- `orders.risks` - Fraud analysis integration
- `orders.fulfillmentOrders` - Modern fulfillment API
- `orders.draftOrders` - Draft order management

**Customers**
- `customers.list()`, `customers.get()`, `customers.create()`, `customers.update()`, `customers.delete()`
- `customers.search()` - Customer search
- `customers.addresses` - Address management
- `customers.metafields` - Customer metafields
- Account activation, password reset, marketing consent

**Inventory**
- `inventory.levels` - Inventory level management (adjust, set, connect)
- `inventory.items` - Inventory item updates
- `inventory.locations` - Location management

### Storefront API

**Products & Collections**
- Product queries by handle, collection, or search
- Collection queries with product filtering
- Pagination support with cursors

**Cart Management**
- Cart creation and updates
- Add/remove/update line items
- Discount codes and attributes
- Buyer identity management

**Checkout**
- Checkout creation and updates
- Shipping address and line items
- Complete checkout flow

**Customer Authentication**
- Customer login/logout
- Access token management
- Customer account creation

### Shopify Functions

**Discount Functions**
- Order discounts
- Product discounts
- Shipping discounts

**Payment Customization**
- Hide, move, or rename payment methods

**Delivery Customization**
- Hide, move, or rename delivery options

**Validation Functions**
- Cart and checkout validation

### Shopify Flow

**Workflow Automation**
- Triggers: Orders, customers, products, inventory events
- Conditions: Complex condition evaluation with AND/OR logic
- Actions: Tags, emails, webhooks, inventory adjustments
- Pre-built templates for common workflows

## Quick Start

### Basic Setup

```typescript
import { shopifyApi, LATEST_API_VERSION } from 'compat/shopify'

const shopify = shopifyApi({
  apiKey: env.SHOPIFY_API_KEY,
  apiSecretKey: env.SHOPIFY_API_SECRET,
  scopes: ['read_products', 'write_orders', 'read_customers'],
  hostName: 'my-store.myshopify.com',
  apiVersion: LATEST_API_VERSION,
})

// OAuth flow
const { url } = shopify.auth.getAuthorizationUrl({
  shop: 'my-store.myshopify.com',
  redirectUri: 'https://my-app.com/callback',
})

// Token exchange
const session = await shopify.auth.tokenExchange({
  shop: 'my-store.myshopify.com',
  code: 'authorization_code',
})

// Create clients
const restClient = new shopify.clients.Rest({ session })
const graphqlClient = new shopify.clients.Graphql({ session })
```

### Products API

```typescript
import { shopifyApi } from 'compat/shopify'

const shopify = shopifyApi({ /* config */ })
const restClient = new shopify.clients.Rest({ session })

// List products
const { body } = await restClient.get({ path: 'products' })
console.log(body.products)

// Create product
const { body: newProduct } = await restClient.post({
  path: 'products',
  data: {
    product: {
      title: 'Classic T-Shirt',
      body_html: '<p>Premium cotton t-shirt</p>',
      vendor: 'My Brand',
      product_type: 'Apparel',
      status: 'active',
      variants: [
        { title: 'Small', price: '29.99', sku: 'TSHIRT-S' },
        { title: 'Medium', price: '29.99', sku: 'TSHIRT-M' },
        { title: 'Large', price: '29.99', sku: 'TSHIRT-L' },
      ],
    },
  },
})

// Update product
await restClient.put({
  path: `products/${productId}`,
  data: {
    product: {
      title: 'Premium T-Shirt',
      tags: 'featured, bestseller',
    },
  },
})

// Delete product
await restClient.delete({ path: `products/${productId}` })
```

### Orders API

```typescript
import { shopifyApi } from 'compat/shopify'

const shopify = shopifyApi({ /* config */ })
const restClient = new shopify.clients.Rest({ session })

// List orders
const { body } = await restClient.get({
  path: 'orders',
  query: {
    status: 'open',
    financial_status: 'paid',
    limit: 50,
  },
})

// Create order
const { body: newOrder } = await restClient.post({
  path: 'orders',
  data: {
    order: {
      line_items: [
        { variant_id: 123456789, quantity: 2 },
      ],
      customer: { email: 'customer@example.com' },
      shipping_address: {
        first_name: 'John',
        last_name: 'Doe',
        address1: '123 Main St',
        city: 'New York',
        province: 'NY',
        country: 'US',
        zip: '10001',
      },
      financial_status: 'pending',
    },
  },
})

// Create fulfillment
await restClient.post({
  path: `orders/${orderId}/fulfillments`,
  data: {
    fulfillment: {
      location_id: 1234567890,
      tracking_number: '1Z999AA10123456784',
      tracking_company: 'UPS',
      notify_customer: true,
    },
  },
})

// Process refund
await restClient.post({
  path: `orders/${orderId}/refunds`,
  data: {
    refund: {
      refund_line_items: [
        { line_item_id: lineItemId, quantity: 1, restock_type: 'return' },
      ],
      notify: true,
    },
  },
})
```

### Customers API

```typescript
import { shopifyApi } from 'compat/shopify'

const shopify = shopifyApi({ /* config */ })
const restClient = new shopify.clients.Rest({ session })

// Search customers
const { body } = await restClient.get({
  path: 'customers/search',
  query: { query: 'email:*@example.com' },
})

// Create customer
const { body: newCustomer } = await restClient.post({
  path: 'customers',
  data: {
    customer: {
      email: 'new-customer@example.com',
      first_name: 'Jane',
      last_name: 'Doe',
      accepts_marketing: true,
      tags: 'newsletter, wholesale',
    },
  },
})

// Get customer orders
const { body: customerOrders } = await restClient.get({
  path: `customers/${customerId}/orders`,
})

// Send account invite
await restClient.post({
  path: `customers/${customerId}/send_invite`,
  data: {
    customer_invite: {
      subject: 'Welcome to our store!',
      custom_message: 'We\'re excited to have you.',
    },
  },
})
```

### GraphQL API

```typescript
import { shopifyApi } from 'compat/shopify'

const shopify = shopifyApi({ /* config */ })
const graphqlClient = new shopify.clients.Graphql({ session })

// Query products
const { body } = await graphqlClient.query({
  data: `
    query {
      products(first: 10) {
        edges {
          node {
            id
            title
            handle
            variants(first: 5) {
              edges {
                node {
                  id
                  title
                  price
                }
              }
            }
          }
        }
      }
    }
  `,
})

// Mutation with variables
const { body: mutationResult } = await graphqlClient.query({
  data: {
    query: `
      mutation productUpdate($input: ProductInput!) {
        productUpdate(input: $input) {
          product {
            id
            title
          }
          userErrors {
            field
            message
          }
        }
      }
    `,
    variables: {
      input: {
        id: 'gid://shopify/Product/123456789',
        title: 'Updated Product Title',
      },
    },
  },
})
```

### Webhook Handling

```typescript
import { shopifyApi } from 'compat/shopify'

const shopify = shopifyApi({
  apiKey: env.SHOPIFY_API_KEY,
  apiSecretKey: env.SHOPIFY_API_SECRET,
  scopes: [],
  hostName: 'my-store.myshopify.com',
})

export default {
  async fetch(request: Request, env: Env) {
    const body = await request.text()
    const hmac = request.headers.get('X-Shopify-Hmac-SHA256')

    // Validate webhook signature
    const isValid = await shopify.webhooks.validate({
      rawBody: body,
      hmac: hmac!,
    })

    if (!isValid) {
      return new Response('Invalid signature', { status: 401 })
    }

    const topic = request.headers.get('X-Shopify-Topic')
    const data = JSON.parse(body)

    switch (topic) {
      case 'orders/create':
        console.log('New order:', data.id, data.name)
        // Process new order
        break

      case 'orders/paid':
        console.log('Order paid:', data.id)
        // Update order status
        break

      case 'products/update':
        console.log('Product updated:', data.id, data.title)
        // Sync product data
        break

      case 'customers/create':
        console.log('New customer:', data.id, data.email)
        // Welcome email, sync to CRM, etc.
        break

      case 'inventory_levels/update':
        console.log('Inventory changed:', data.inventory_item_id)
        // Check stock levels, send alerts
        break
    }

    return new Response('OK', { status: 200 })
  },
}
```

### Storefront API

```typescript
import { createStorefrontClient } from 'compat/shopify'

const client = createStorefrontClient({
  storeDomain: 'my-store.myshopify.com',
  publicAccessToken: env.SHOPIFY_STOREFRONT_TOKEN,
})

// Get product by handle
const product = await client.product.getByHandle('classic-tee')

// Search products
const searchResults = await client.product.search('organic cotton', {
  first: 20,
  sortKey: 'RELEVANCE',
})

// Get collection with products
const collection = await client.collection.getByHandle('summer-sale', {
  productsFirst: 50,
})

// Cart operations
const cart = await client.cart.create()

await client.cart.addLines(cart.id, [
  { merchandiseId: 'gid://shopify/ProductVariant/123', quantity: 2 },
])

await client.cart.updateLines(cart.id, [
  { id: 'gid://shopify/CartLine/456', quantity: 3 },
])

// Get checkout URL
console.log('Checkout:', cart.checkoutUrl)

// Customer authentication
const { customerAccessToken } = await client.customer.login(
  'customer@example.com',
  'password123'
)

// Get customer info
const customer = await client.customer.get(customerAccessToken.accessToken)
```

### Shopify Flow Automation

```typescript
import { FlowEngine, FlowTemplates } from 'compat/shopify'

const engine = new FlowEngine()

// Create workflow from template
const vipWorkflow = engine.createFromTemplate(
  FlowTemplates.TAG_HIGH_VALUE_CUSTOMERS,
  { threshold: 500 }
)

// Register for automatic execution
engine.registerWorkflow(vipWorkflow)

// Create custom workflow
const customWorkflow = engine.createWorkflow({
  title: 'Flag Large Orders',
  description: 'Tag orders over $1000 for review',
  trigger: {
    type: 'order_created',
    title: 'When order is created',
  },
  conditions: [
    {
      property: 'order.total_price',
      operator: 'greater_than',
      value: 1000,
    },
  ],
  actions: [
    {
      type: 'add_order_tag',
      input: {
        order_id: '{{order.id}}',
        tag: 'high-value',
      },
    },
    {
      type: 'send_slack_message',
      input: {
        channel: '#orders',
        message: 'High-value order #{{order.name}}: ${{order.total_price}}',
      },
    },
  ],
})

engine.registerWorkflow(customWorkflow)

// Handle webhook trigger
export default {
  async fetch(request: Request) {
    const data = await request.json()
    const topic = request.headers.get('X-Shopify-Topic')

    if (topic === 'orders/create') {
      const executions = await engine.onTrigger('order_created', data)
      console.log('Executed workflows:', executions.length)
    }

    return new Response('OK')
  },
}
```

### Shopify Functions

```typescript
import {
  createDiscountFunction,
  percentageDiscount,
  orderSubtotalTarget,
  getCartTotal,
} from 'compat/shopify'

// Create a discount function
const volumeDiscount = createDiscountFunction({
  title: 'Volume Discount',
  description: '10% off orders over $100',
  handler: async (input, config) => {
    const cartTotal = getCartTotal(input.cart)

    if (cartTotal >= 100) {
      return {
        discounts: [
          {
            value: percentageDiscount(10),
            targets: [orderSubtotalTarget()],
            message: '10% volume discount applied',
          },
        ],
        discountApplicationStrategy: 'FIRST',
      }
    }

    return { discounts: [], discountApplicationStrategy: 'FIRST' }
  },
})

// Create payment customization
import { createPaymentCustomization } from 'compat/shopify'

const hidePaymentForPO = createPaymentCustomization({
  title: 'Hide COD for large orders',
  handler: async (input) => {
    const cartTotal = getCartTotal(input.cart)

    if (cartTotal > 500) {
      return {
        operations: [
          {
            hide: {
              paymentMethodId: input.paymentMethods.find(
                (m) => m.name === 'Cash on Delivery'
              )?.id,
            },
          },
        ],
      }
    }

    return { operations: [] }
  },
})
```

## Configuration

### Client Options

```typescript
import { shopifyApi, type ShopifyConfig } from 'compat/shopify'

const config: ShopifyConfig = {
  // Required
  apiKey: 'your-api-key',
  apiSecretKey: 'your-api-secret',
  scopes: ['read_products', 'write_orders'],
  hostName: 'my-store.myshopify.com',

  // Optional
  apiVersion: '2024-10', // Default: LATEST_API_VERSION
  retries: 3,            // Default: 2
  timeout: 30000,        // Default: 60000 (60s)
  debug: false,          // Enable debug logging

  // Custom fetch for testing
  fetch: customFetch,
}

const shopify = shopifyApi(config)
```

### Storefront Configuration

```typescript
import { createStorefrontClient, type StorefrontConfig } from 'compat/shopify'

const config: StorefrontConfig = {
  storeDomain: 'my-store.myshopify.com',
  publicAccessToken: 'storefront-token',

  // Optional
  privateAccessToken: 'private-token', // For server-side
  apiVersion: '2024-10',
  language: 'en',                       // ISO 639-1
  country: 'US',                        // ISO 3166-1
}

const client = createStorefrontClient(config)
```

## Error Handling

```typescript
import { shopifyApi, ShopifyAPIError } from 'compat/shopify'

const shopify = shopifyApi({ /* config */ })
const restClient = new shopify.clients.Rest({ session })

try {
  await restClient.post({
    path: 'products',
    data: { product: { title: '' } }, // Invalid - empty title
  })
} catch (error) {
  if (error instanceof ShopifyAPIError) {
    console.log('Status:', error.statusCode)
    console.log('Message:', error.message)
    console.log('Request ID:', error.requestId)
    console.log('Response:', error.response)

    // Handle specific errors
    if (error.statusCode === 422) {
      // Validation error
      console.log('Validation errors:', error.response?.errors)
    } else if (error.statusCode === 429) {
      // Rate limited
      console.log('Rate limited, retry later')
    } else if (error.statusCode === 401) {
      // Authentication error
      console.log('Invalid or expired token')
    }
  }
}
```

## Types

Full TypeScript support with all Shopify types:

```typescript
import type {
  // Configuration
  ShopifyConfig,
  Session,

  // Products
  Product,
  ProductVariant,
  ProductImage,
  ProductOption,

  // Orders
  Order,
  LineItem,
  Fulfillment,
  Refund,
  Transaction,
  FinancialStatus,
  FulfillmentStatus,

  // Customers
  Customer,
  CustomerAddress,

  // Inventory
  InventoryLevel,
  InventoryItem,
  Location,

  // Collections
  CustomCollection,
  SmartCollection,
  Collect,

  // Webhooks
  Webhook,
  WebhookTopic,

  // Flow
  FlowWorkflow,
  FlowTrigger,
  FlowCondition,
  FlowAction,
  FlowExecution,

  // Storefront
  StorefrontProduct,
  StorefrontCollection,
  Cart,
  CartLine,
  Checkout,
} from 'compat/shopify'
```

## Workflow Integration

Use Shopify with dotdo workflows for durable e-commerce operations:

```typescript
import { $ } from 'dotdo'
import { shopifyApi } from 'compat/shopify'

export class OrderWorkflow {
  shopify = shopifyApi({
    apiKey: this.env.SHOPIFY_API_KEY,
    apiSecretKey: this.env.SHOPIFY_API_SECRET,
    scopes: ['write_orders', 'write_fulfillments'],
    hostName: 'my-store.myshopify.com',
  })

  async processOrder(orderId: number) {
    const restClient = new this.shopify.clients.Rest({ session: this.session })

    // Durable order fetch
    const { body } = await $.do(() =>
      restClient.get({ path: `orders/${orderId}` })
    )

    const order = body.order

    // Wait for payment
    if (order.financial_status === 'pending') {
      await $.on.Order.paid({ filter: { id: orderId } })
    }

    // Create fulfillment durably
    await $.do(() =>
      restClient.post({
        path: `orders/${orderId}/fulfillments`,
        data: {
          fulfillment: {
            location_id: this.defaultLocation,
            tracking_number: await this.getTrackingNumber(),
            notify_customer: true,
          },
        },
      })
    )

    // Send custom notification
    await $.do(() => this.sendOrderConfirmation(order))
  }
}
```

## Migrating from Shopify SDK

### 1. Update imports

```typescript
// Before
import { shopifyApi, LATEST_API_VERSION } from '@shopify/shopify-api'

// After
import { shopifyApi, LATEST_API_VERSION } from 'compat/shopify'
```

### 2. Environment variables

Keep your existing environment variables:

```
SHOPIFY_API_KEY=your-api-key
SHOPIFY_API_SECRET=your-api-secret
SHOPIFY_STOREFRONT_TOKEN=your-storefront-token
```

### 3. Code changes

Most code works unchanged. Check for:

- **Session storage**: The compat layer uses simplified session handling
- **Node.js APIs**: Replace any Node.js-specific code with edge-compatible alternatives
- **Webhook handlers**: Use the built-in `webhooks.validate()` method

## Next Steps

<Cards>
  <Card title="Stripe Integration" href="/docs/integrations/stripe">
    Payment processing for subscriptions and one-time payments.
  </Card>
  <Card title="Workflows" href="/docs/workflows">
    Build durable e-commerce workflows with automatic retries.
  </Card>
  <Card title="Webhooks Guide" href="/docs/concepts/webhooks">
    Learn about webhook handling patterns in dotdo.
  </Card>
</Cards>
