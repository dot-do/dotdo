---
title: Mailgun
description: Drop-in replacement for mailgun.js with transactional email, templates, webhooks, and edge-native delivery.
---

# Mailgun

Drop-in replacement for `mailgun.js`. Your existing `mailgun.js` code works unchanged - just swap the import.

```typescript
// Before
import Mailgun from 'mailgun.js'
import formData from 'form-data'

// After
import { Mailgun } from '@dotdo/mailgun'
```

Your existing Mailgun code works unchanged. No migration required.

## Why @dotdo/mailgun?

| Feature | @dotdo/mailgun | Mailgun |
|---------|----------------|---------|
| **API compatibility** | 100% compatible | Native |
| **Runtime** | Edge (300+ cities) | Node.js |
| **Cold start** | 0ms (V8 isolates) | Variable |
| **Template storage** | DO SQLite | Mailgun servers |
| **Exactly-once delivery** | Yes (idempotency keys) | No |
| **Audit logs** | Built-in temporal store | Separate product |
| **Outbox pattern** | Built-in transactions | DIY |
| **FormData dependency** | Not needed | Required |

## Features

| Feature | Status |
|---------|--------|
| Single email send | Supported |
| Multiple recipients | Supported |
| MIME messages | Supported |
| Templates | Supported |
| Template variables | Supported |
| Attachments | Supported |
| Inline images | Supported |
| Custom headers | Supported |
| Tags | Supported |
| Tracking options | Supported |
| Scheduled sending | Supported |
| Batch sending | Supported |
| Recipient variables | Supported |
| Mailing lists | Supported |
| Domains API | Supported |
| Webhooks | Supported |
| Email validation | Planned |
| Suppressions API | Planned |

## Quick Start

### Install

```bash
npm install @dotdo/mailgun
```

### Basic Usage

```typescript
import { Mailgun } from '@dotdo/mailgun'

const mg = new Mailgun({
  apiKey: process.env.MAILGUN_API_KEY,
  domain: 'mg.example.com',
})

await mg.messages.create({
  from: 'Sender <sender@mg.example.com>',
  to: ['recipient@example.com'],
  subject: 'Hello from dotdo',
  text: 'This is a test email.',
  html: '<h1>Hello World</h1>',
})
```

### Multiple Recipients

```typescript
await mg.messages.create({
  from: 'sender@mg.example.com',
  to: ['user1@example.com', 'user2@example.com'],
  cc: ['manager@example.com'],
  bcc: ['archive@example.com'],
  subject: 'Team Update',
  html: '<p>Important announcement...</p>',
})
```

### With Name Format

```typescript
await mg.messages.create({
  from: 'Acme Inc <hello@mg.acme.com>',
  to: ['John Doe <john@example.com>'],
  subject: 'Welcome to Acme',
  html: '<h1>Hello John!</h1>',
})
```

## Templates

Use Mailgun-style templates with Handlebars syntax.

### Send with Template

```typescript
await mg.messages.create({
  from: 'noreply@mg.example.com',
  to: ['user@example.com'],
  template: 'order-confirmation',
  'h:X-Mailgun-Variables': JSON.stringify({
    name: 'John',
    orderNumber: '12345',
    items: [
      { name: 'Widget', quantity: 2, price: 19.99 },
      { name: 'Gadget', quantity: 1, price: 49.99 },
    ],
  }),
})
```

### Template Variables (Shorthand)

```typescript
await mg.messages.create({
  from: 'noreply@mg.example.com',
  to: ['user@example.com'],
  template: 'welcome',
  't:variables': JSON.stringify({
    name: 'John',
    company: 'Acme Inc',
  }),
})
```

## Batch Sending with Recipient Variables

Send personalized emails to multiple recipients in a single API call.

```typescript
await mg.messages.create({
  from: 'marketing@mg.example.com',
  to: ['alice@example.com', 'bob@example.com', 'carol@example.com'],
  subject: 'Hello %recipient.name%',
  html: '<p>Hi %recipient.name%, your code is %recipient.code%</p>',
  'recipient-variables': JSON.stringify({
    'alice@example.com': { name: 'Alice', code: 'ALICE10' },
    'bob@example.com': { name: 'Bob', code: 'BOB15' },
    'carol@example.com': { name: 'Carol', code: 'CAROL20' },
  }),
})
```

## Attachments

```typescript
await mg.messages.create({
  from: 'billing@mg.example.com',
  to: ['customer@example.com'],
  subject: 'Your Invoice',
  text: 'Please find your invoice attached.',
  attachment: [
    {
      filename: 'invoice.pdf',
      data: Buffer.from(pdfData),
      contentType: 'application/pdf',
    },
  ],
})
```

### Inline Images

```typescript
await mg.messages.create({
  from: 'marketing@mg.example.com',
  to: ['user@example.com'],
  subject: 'Check out our new product',
  html: '<p>See our logo: <img src="cid:logo.png" /></p>',
  inline: [
    {
      filename: 'logo.png',
      data: logoBuffer,
      contentType: 'image/png',
    },
  ],
})
```

## Tags and Tracking

```typescript
await mg.messages.create({
  from: 'notifications@mg.example.com',
  to: ['user@example.com'],
  subject: 'Order Update',
  html: '<p>Your order has shipped!</p>',
  'o:tag': ['transactional', 'order-update'],
  'o:tracking': true,
  'o:tracking-clicks': 'htmlonly',
  'o:tracking-opens': true,
})
```

## Scheduled Sending

Schedule emails for future delivery (up to 7 days in advance).

```typescript
// Send in 1 hour
const deliveryTime = new Date(Date.now() + 60 * 60 * 1000)

await mg.messages.create({
  from: 'reminders@mg.example.com',
  to: ['user@example.com'],
  subject: 'Meeting Reminder',
  html: '<p>Your meeting starts in 15 minutes.</p>',
  'o:deliverytime': deliveryTime.toUTCString(),
})
```

## Custom Headers

```typescript
await mg.messages.create({
  from: 'notifications@mg.example.com',
  to: ['user@example.com'],
  subject: 'Order Update',
  html: '<p>Your order has shipped!</p>',
  'h:X-Entity-Ref-ID': 'order-123',
  'h:X-Campaign-ID': 'shipping-notifications',
  'h:Reply-To': 'support@example.com',
})
```

## Inbound - Local Development

For local development and testing, use `mailgun.do` as a drop-in replacement endpoint. Emails are captured in DO SQLite for inspection.

```typescript
import { Mailgun } from '@dotdo/mailgun'

const mg = new Mailgun({
  apiKey: 'test-key',
  domain: 'sandbox.mailgun.do',
  host: 'https://mailgun.do', // Routes to your local DO
})

await mg.messages.create({
  from: 'dev@sandbox.mailgun.do',
  to: ['test@example.com'],
  subject: 'Test Email',
  text: 'Testing locally...',
})

// Emails captured in DO storage, not sent to real addresses
```

The compat layer captures all email activity locally, making it perfect for development without affecting production quotas or sending to real recipients.

## Outbound - Production

In production, connect to real Mailgun with your API key.

```typescript
import { Mailgun } from '@dotdo/mailgun'

const mg = new Mailgun({
  apiKey: process.env.MAILGUN_API_KEY,
  domain: 'mg.yourcompany.com',
  // Default host: https://api.mailgun.net (US) or https://api.eu.mailgun.net (EU)
})

await mg.messages.create({
  from: 'hello@mg.yourcompany.com',
  to: ['customer@example.com'],
  subject: 'Welcome!',
  html: '<h1>Welcome to our platform</h1>',
})
```

### EU Region

```typescript
const mg = new Mailgun({
  apiKey: process.env.MAILGUN_API_KEY,
  domain: 'mg.yourcompany.eu',
  host: 'https://api.eu.mailgun.net',
})
```

## Domains API

Manage your sending domains.

```typescript
// List domains
const domains = await mg.domains.list()

// Get domain info
const domain = await mg.domains.get('mg.example.com')

// Create domain
await mg.domains.create({
  name: 'mg.newdomain.com',
  smtp_password: 'supersecret',
  spam_action: 'disabled',
  wildcard: false,
})

// Verify domain
await mg.domains.verify('mg.example.com')

// Get DNS records
const records = await mg.domains.getTracking('mg.example.com')
```

## Mailing Lists

Manage mailing lists and subscribers.

```typescript
// Create list
await mg.lists.create({
  address: 'newsletter@mg.example.com',
  name: 'Newsletter',
  description: 'Weekly newsletter subscribers',
  access_level: 'readonly',
})

// Add members
await mg.lists.members.createMultiple('newsletter@mg.example.com', {
  members: [
    { address: 'user1@example.com', name: 'User One', subscribed: true },
    { address: 'user2@example.com', name: 'User Two', subscribed: true },
  ],
  upsert: true,
})

// Send to list
await mg.messages.create({
  from: 'newsletter@mg.example.com',
  to: ['newsletter@mg.example.com'],
  subject: 'Weekly Update',
  html: '<p>This week in tech...</p>',
})
```

## Webhooks

Handle Mailgun webhook events.

```typescript
import { Hono } from 'hono'
import { verifyWebhook } from '@dotdo/mailgun'

const app = new Hono()

app.post('/webhooks/mailgun', async (c) => {
  const body = await c.req.json()

  // Verify webhook signature
  const isValid = verifyWebhook({
    signingKey: process.env.MAILGUN_WEBHOOK_SIGNING_KEY,
    timestamp: body.signature.timestamp,
    token: body.signature.token,
    signature: body.signature.signature,
  })

  if (!isValid) {
    return c.json({ error: 'Invalid signature' }, 401)
  }

  const event = body['event-data']

  switch (event.event) {
    case 'delivered':
      console.log('Email delivered:', event['message-id'])
      break
    case 'opened':
      console.log('Email opened:', event['message-id'])
      break
    case 'clicked':
      console.log('Link clicked:', event.url)
      break
    case 'bounced':
      console.log('Email bounced:', event.recipient, event['error-code'])
      break
    case 'complained':
      console.log('Spam complaint:', event.recipient)
      break
    case 'unsubscribed':
      console.log('Unsubscribed:', event.recipient)
      break
  }

  return c.json({ success: true })
})
```

## Durable Client

For exactly-once delivery guarantees with idempotency.

```typescript
import { DurableMailgunClient } from '@dotdo/mailgun'

const mg = new DurableMailgunClient({
  apiKey: process.env.MAILGUN_API_KEY,
  domain: 'mg.example.com',
  eventIdTtl: 24 * 60 * 60 * 1000, // 24 hours
})

// Idempotent send - safe to retry
await mg.messages.create({
  from: 'noreply@mg.example.com',
  to: ['user@example.com'],
  subject: 'Order Confirmation',
  text: 'Your order has been confirmed.',
}, { idempotencyKey: 'order-123-confirmation' })

// Check if already processed
if (await mg.isProcessed('order-123-confirmation')) {
  console.log('Already sent')
}

// Transactional batch
await mg.transaction(async (tx) => {
  await tx.queueEmail({
    from: 'noreply@mg.example.com',
    to: ['user1@example.com'],
    subject: 'Update',
    text: '...',
  })
  await tx.queueEmail({
    from: 'noreply@mg.example.com',
    to: ['user2@example.com'],
    subject: 'Update',
    text: '...',
  })
})
await mg.flush()

// Email logs with time-travel
const log = await mg.getEmailLog('order-123-confirmation')
const history = await mg.getEmailStatusHistory('order-123-confirmation')
```

## TypeScript Types

Full TypeScript support with Mailgun-compatible types.

```typescript
import type {
  // Client types
  MailgunClientConfig,
  MailgunClient,
  DurableMailgunClient,

  // Message types
  MessageCreateParams,
  MessageCreateResponse,
  MimeMessage,
  Attachment,
  InlineAttachment,

  // Template types
  Template,
  TemplateVersion,
  TemplateCreateParams,

  // Domain types
  Domain,
  DomainCreateParams,
  DomainCredentials,
  DomainTracking,

  // List types
  MailingList,
  MailingListMember,
  MailingListCreateParams,

  // Webhook types
  WebhookEvent,
  WebhookSignature,
  DeliveredEvent,
  OpenedEvent,
  ClickedEvent,
  BouncedEvent,
  ComplainedEvent,
  UnsubscribedEvent,

  // Durable types
  DurableSendOptions,
  EmailLog,
  EmailLogStatus,
} from '@dotdo/mailgun'
```

## Error Handling

```typescript
import { Mailgun, MailgunError, MailgunAPIError } from '@dotdo/mailgun'

const mg = new Mailgun({
  apiKey: process.env.MAILGUN_API_KEY,
  domain: 'mg.example.com',
})

try {
  await mg.messages.create({
    from: 'invalid',
    to: ['user@example.com'],
    subject: 'Test',
    text: 'Hello',
  })
} catch (error) {
  if (error instanceof MailgunAPIError) {
    console.error('Mailgun API error:', error.status, error.message)
    // Handle 400 (bad request), 401 (unauthorized), 402 (payment required), etc.
  } else if (error instanceof MailgunError) {
    console.error('Mailgun error:', error.message)
  }
}
```

## Migration from mailgun.js

### Package Change

```bash
# Remove
npm uninstall mailgun.js form-data

# Install
npm install @dotdo/mailgun
```

### Import Change

```typescript
// Before
import Mailgun from 'mailgun.js'
import formData from 'form-data'

const mg = new Mailgun(formData)
const client = mg.client({
  username: 'api',
  key: process.env.MAILGUN_API_KEY,
})

// After
import { Mailgun } from '@dotdo/mailgun'

const client = new Mailgun({
  apiKey: process.env.MAILGUN_API_KEY,
  domain: 'mg.example.com',
})

// Everything else stays the same
await client.messages.create({ ... })
```

Note: The dotdo version doesn't require `form-data` as a separate dependency.

## Architecture

```
+-------------------------------------------------------------+
|                  mg.messages.create(data)                    |
|              DurableMailgunClient.messages.create()          |
+-------------------------------------------------------------+
                              |
              +---------------+---------------+
              v                               v
+--------------------------+    +--------------------------+
|    Development Mode       |    |    Production Mode        |
|   host: mailgun.do        |    |   host: api.mailgun.net   |
|                           |    |                           |
|   +-------------------+   |    |   Real Mailgun API        |
|   |   Durable Object  |   |    |   Emails delivered        |
|   |   SQLite Storage  |   |    |   Webhooks enabled        |
|   |                   |   |    |                           |
|   |  - Email logs     |   |    +--------------------------+
|   |  - Templates      |   |
|   |  - Deduplication  |   |
|   |  - Audit trail    |   |
|   +-------------------+   |
+--------------------------+
```

## Common Patterns

### Welcome Email Flow

```typescript
import { Mailgun } from '@dotdo/mailgun'

const mg = new Mailgun({
  apiKey: process.env.MAILGUN_API_KEY,
  domain: 'mg.yourapp.com',
})

async function sendWelcomeEmail(user: { email: string; name: string }) {
  await mg.messages.create({
    from: 'Acme <welcome@mg.yourapp.com>',
    to: [user.email],
    template: 'welcome',
    't:variables': JSON.stringify({
      name: user.name,
      loginUrl: 'https://yourapp.com/login',
    }),
  })
}
```

### Transactional Notifications

```typescript
import { DurableMailgunClient } from '@dotdo/mailgun'

const mg = new DurableMailgunClient({
  apiKey: process.env.MAILGUN_API_KEY,
  domain: 'mg.yourstore.com',
})

async function sendOrderConfirmation(order: Order) {
  await mg.messages.create({
    from: 'orders@mg.yourstore.com',
    to: [order.customerEmail],
    template: 'order-confirmation',
    't:variables': JSON.stringify({
      orderNumber: order.id,
      items: order.items,
      total: order.total,
    }),
    'o:tag': ['transactional', 'order-confirmation'],
  }, {
    // Idempotent - safe to retry if delivery uncertain
    idempotencyKey: `order-${order.id}-confirmation`,
  })
}
```

### Batch Newsletter

```typescript
import { Mailgun } from '@dotdo/mailgun'

const mg = new Mailgun({
  apiKey: process.env.MAILGUN_API_KEY,
  domain: 'mg.yourcompany.com',
})

async function sendNewsletter(
  subscribers: Array<{ email: string; name: string }>,
  content: { subject: string; html: string }
) {
  // Batch into chunks of 1000 (Mailgun limit)
  const chunks = chunkArray(subscribers, 1000)

  for (const chunk of chunks) {
    const recipientVariables: Record<string, { name: string }> = {}
    const toAddresses = chunk.map((sub) => {
      recipientVariables[sub.email] = { name: sub.name }
      return sub.email
    })

    await mg.messages.create({
      from: 'newsletter@mg.yourcompany.com',
      to: toAddresses,
      subject: content.subject,
      html: content.html.replace('{{name}}', '%recipient.name%'),
      'recipient-variables': JSON.stringify(recipientVariables),
      'o:tag': ['newsletter'],
    })
  }
}
```

### Password Reset

```typescript
import { Mailgun } from '@dotdo/mailgun'

const mg = new Mailgun({
  apiKey: process.env.MAILGUN_API_KEY,
  domain: 'mg.example.com',
})

async function sendPasswordReset(email: string, resetToken: string) {
  const resetUrl = `https://app.example.com/reset?token=${resetToken}`

  await mg.messages.create({
    from: 'security@mg.example.com',
    to: [email],
    subject: 'Reset Your Password',
    html: `
      <h1>Password Reset Request</h1>
      <p>Click the link below to reset your password:</p>
      <a href="${resetUrl}">Reset Password</a>
      <p>This link expires in 1 hour.</p>
    `,
    'o:tag': ['security', 'password-reset'],
    'o:tracking': false, // Disable tracking for security emails
  })
}
```

## Related

- [SendGrid Integration](/docs/integrations/sendgrid) - SendGrid compatibility layer
- [Resend Integration](/docs/integrations/resend) - Resend compatibility layer
- [Messaging SDKs](/docs/compat/messaging) - Email, SMS, and more
- [Human Escalation](/docs/humans/escalation) - Email-based approval workflows
- [Compat SDKs Overview](/docs/compat) - All API-compatible SDKs
