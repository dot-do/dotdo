---
title: "Sentry"
description: "Drop-in replacement for Sentry SDK with edge compatibility and local development mode."
---

# Sentry

Drop-in replacement for the Sentry JavaScript SDK. Your existing error tracking code works unchanged - just swap the import.

```typescript
// Before: Sentry
import * as Sentry from '@sentry/node'

// After: dotdo
import * as Sentry from '@dotdo/sentry'

// Code stays the same
Sentry.init({ dsn: 'https://xxx@sentry.io/123' })
Sentry.captureException(new Error('Something went wrong'))
```

## Prerequisites

Before integrating Sentry with dotdo, you need:

### 1. Sentry Account

1. Sign up at [sentry.io](https://sentry.io)
2. Create an organization

### 2. Create a Project

1. Go to **Projects** > **Create Project**
2. Select **JavaScript** or **Node.js**
3. Copy your **DSN** from Project Settings > Client Keys

### 3. Environment Setup

Store your DSN securely:

```bash
SENTRY_DSN=https://xxxxx@o123456.ingest.sentry.io/123456
```

## Environment Variables

| Variable | Required | Description |
|----------|----------|-------------|
| `SENTRY_DSN` | Yes (production) | Sentry Data Source Name |
| `SENTRY_RELEASE` | No | Release version for tracking |
| `SENTRY_ENVIRONMENT` | No | Environment name (production, staging) |

## Why @dotdo/sentry?

| @sentry/node | @dotdo/sentry |
|--------------|---------------|
| Node.js runtime required | Edge-compatible (Cloudflare Workers) |
| Always sends to Sentry | Local mode for testing |
| Heavy SDK size | Lightweight implementation |
| External dependency | Works offline |

**This is a compatibility layer.** It can either forward errors to real Sentry APIs (production) or capture events locally for testing and development.

## Features

### Implemented

**Error Capture**
- `captureException()` - Capture exceptions
- `captureMessage()` - Capture messages
- `captureEvent()` - Capture raw events
- Automatic stack trace capture
- Source map support

**Context**
- `setUser()` - Set user context
- `setTags()` - Set tags
- `setExtras()` - Set extra data
- `setContext()` - Set custom context
- Breadcrumbs

**Scopes**
- `withScope()` - Create isolated scope
- `configureScope()` - Configure current scope
- Scope inheritance

**Performance**
- `startTransaction()` - Start transactions
- `startSpan()` - Create spans
- Distributed tracing

### Not Yet Implemented

- Session tracking
- Replay integration
- Profiling

## Quick Start

### Install

```bash
npm install @dotdo/sentry
```

### Basic Usage

```typescript
import * as Sentry from '@dotdo/sentry'

// Initialize
Sentry.init({
  dsn: process.env.SENTRY_DSN,
  environment: process.env.NODE_ENV,
  release: 'my-app@1.0.0',
})

// Set user context
Sentry.setUser({
  id: 'user-123',
  email: 'user@example.com',
  username: 'johndoe',
})

// Capture an exception
try {
  await riskyOperation()
} catch (error) {
  Sentry.captureException(error, {
    tags: { component: 'auth' },
    extra: { attemptNumber: 3 },
  })
}

// Capture a message
Sentry.captureMessage('User completed onboarding', 'info')
```

### Breadcrumbs

```typescript
import * as Sentry from '@dotdo/sentry'

// Add breadcrumb
Sentry.addBreadcrumb({
  category: 'auth',
  message: 'User logged in',
  level: 'info',
  data: {
    userId: 'user-123',
    method: 'oauth',
  },
})

// Breadcrumbs are automatically attached to errors
try {
  await processPayment()
} catch (error) {
  // This error will include the breadcrumb above
  Sentry.captureException(error)
}
```

### Scopes

```typescript
import * as Sentry from '@dotdo/sentry'

// Configure the global scope
Sentry.configureScope((scope) => {
  scope.setTag('app-version', '1.0.0')
  scope.setExtra('serverRegion', 'us-east-1')
})

// Create an isolated scope
Sentry.withScope((scope) => {
  scope.setTag('transaction', 'payment')
  scope.setLevel('warning')

  // Only affects this scope
  Sentry.captureException(error)
})
```

## Configuration

### Init Options

```typescript
import * as Sentry from '@dotdo/sentry'
import type { SentryOptions } from '@dotdo/sentry'

const options: SentryOptions = {
  // Required
  dsn: process.env.SENTRY_DSN,

  // Environment
  environment: 'production',
  release: 'my-app@1.0.0',

  // Sampling
  sampleRate: 1.0,           // Error sample rate (0-1)
  tracesSampleRate: 0.1,     // Transaction sample rate

  // Context
  serverName: 'worker-1',
  maxBreadcrumbs: 100,

  // Filtering
  beforeSend: (event) => {
    // Filter sensitive data
    if (event.request?.headers?.authorization) {
      delete event.request.headers.authorization
    }
    return event
  },

  // Performance
  beforeSendTransaction: (transaction) => {
    // Filter transactions
    if (transaction.transaction === '/health') {
      return null // Don't send health checks
    }
    return transaction
  },
}

Sentry.init(options)
```

## Inbound - Local Development

For local development and testing, events are captured but not sent:

```typescript
import * as Sentry from '@dotdo/sentry'

// Initialize without DSN for local testing
Sentry.init({
  dsn: undefined, // Events are captured but not sent
  environment: 'development',
})

// Errors are still captured for debugging
try {
  throw new Error('Test error')
} catch (error) {
  const eventId = Sentry.captureException(error)
  console.log('Captured event:', eventId)
}
```

## Outbound - Production

For production, errors are sent to Sentry:

```typescript
// worker.ts
import * as Sentry from '@dotdo/sentry'

export default {
  async fetch(request: Request, env: Env, ctx: ExecutionContext): Promise<Response> {
    // Initialize per-request
    Sentry.init({
      dsn: env.SENTRY_DSN,
      environment: 'production',
    })

    try {
      return await handleRequest(request)
    } catch (error) {
      // Capture and report the error
      const eventId = Sentry.captureException(error, {
        extra: {
          url: request.url,
          method: request.method,
        },
      })

      // Wait for event to be sent before response
      ctx.waitUntil(Sentry.flush(2000))

      return new Response(`Error: ${eventId}`, { status: 500 })
    }
  },
}
```

## Performance Monitoring

Track transactions and spans:

```typescript
import * as Sentry from '@dotdo/sentry'

// Start a transaction
const transaction = Sentry.startTransaction({
  name: 'process-order',
  op: 'task',
})

// Create child spans
const dbSpan = transaction.startChild({
  op: 'db.query',
  description: 'SELECT * FROM orders',
})

await db.query('SELECT * FROM orders')
dbSpan.finish()

const apiSpan = transaction.startChild({
  op: 'http.request',
  description: 'POST /api/payment',
})

await fetch('/api/payment', { method: 'POST' })
apiSpan.finish()

// Finish the transaction
transaction.finish()
```

## Error Handling

```typescript
import * as Sentry from '@dotdo/sentry'

// With error hint
Sentry.captureException(error, {
  hint: {
    originalException: originalError,
  },
})

// Check if initialized
if (Sentry.getCurrentHub().getClient()) {
  Sentry.captureException(error)
}
```

## TypeScript Types

Full TypeScript support:

```typescript
import type {
  // Config
  SentryOptions,

  // Events
  Event,
  Exception,
  Stacktrace,

  // Context
  User,
  Scope,
  Breadcrumb,

  // Performance
  Transaction,
  Span,
  SpanContext,

  // Severity
  SeverityLevel,
} from '@dotdo/sentry'
```

## Workflow Integration

Use Sentry with dotdo workflows for durable error tracking:

```typescript
import { $ } from 'dotdo'
import * as Sentry from '@dotdo/sentry'

export class PaymentProcessor {
  async processPayment(payment: Payment) {
    const transaction = Sentry.startTransaction({
      name: 'process-payment',
      op: 'payment',
    })

    try {
      // Durable payment processing
      const result = await $.do(() => this.chargeCard(payment))

      transaction.setStatus('ok')
      return result
    } catch (error) {
      transaction.setStatus('internal_error')

      Sentry.captureException(error, {
        tags: { paymentId: payment.id },
        extra: { amount: payment.amount },
      })

      throw error
    } finally {
      transaction.finish()
    }
  }
}
```

## Migration from @sentry/node

### 1. Package Change

```bash
# Remove Sentry SDK
npm uninstall @sentry/node

# Install dotdo package
npm install @dotdo/sentry
```

### 2. Import Change

```typescript
// Before
import * as Sentry from '@sentry/node'

// After
import * as Sentry from '@dotdo/sentry'
```

### 3. Code Compatibility

Your existing code should work unchanged. The API surface matches the official Sentry SDK.

## Related

- [Datadog Integration](/docs/integrations/datadog) - APM and logging
- [Compat SDKs Overview](/docs/compat) - All API-compatible SDKs
