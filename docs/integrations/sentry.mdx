---
title: Sentry
description: Drop-in replacement for the Sentry SDK with edge compatibility and full error tracking support.
---

# Sentry

Drop-in replacement for the Sentry JavaScript SDK. Your existing `@sentry/browser` or `@sentry/node` code works unchanged - just swap the import.

```typescript
// Before: Sentry
import * as Sentry from '@sentry/browser'

// After: dotdo
import * as Sentry from '@dotdo/sentry'

// Code stays the same
Sentry.init({
  dsn: env.SENTRY_DSN,
  environment: 'production',
  release: 'my-app@1.0.0',
})

try {
  throw new Error('Something went wrong')
} catch (error) {
  Sentry.captureException(error)
}
```

## Why sentry.do?

| Sentry SDK | @dotdo/sentry |
|------------|---------------|
| Node.js runtime required | Edge-compatible (Cloudflare Workers) |
| Heavy bundle size (~100KB+) | Lightweight (~15KB) |
| Complex integrations setup | Zero configuration |
| Separate browser/node packages | Single universal package |
| No local testing mode | Built-in InMemoryTransport for tests |

**This is a compatibility layer.** It can either forward to real Sentry APIs (production) or run entirely locally for testing and development. The API surface matches Sentry's official SDK.

## Features

### Implemented (Core APIs)

**Error Capture**
- `captureException()` - Capture errors with stack traces
- `captureMessage()` - Capture messages at any severity level
- `captureEvent()` - Capture custom events

**Context Management**
- `setUser()` - Set user information (id, email, username)
- `setTags()`, `setTag()` - Add searchable key-value tags
- `setExtras()`, `setExtra()` - Add arbitrary extra data
- `setContext()` - Add structured context (browser, device, etc.)

**Breadcrumbs**
- `addBreadcrumb()` - Add navigation/action trail
- HTTP, navigation, console, UI, and query breadcrumb types
- Automatic timestamp enrichment
- Configurable max breadcrumbs limit

**Scope Management**
- `withScope()` - Isolated scope operations
- `configureScope()` - Modify current scope
- `getCurrentScope()` - Access current scope directly

**Performance Tracing**
- `startTransaction()` - Start a performance transaction
- `startSpan()` - Convenient async span helper
- `getActiveSpan()`, `getActiveTransaction()` - Access current trace
- `continueTrace()` - Distributed tracing support
- Span status mapping from HTTP codes

**Lifecycle**
- `init()` - Initialize with DSN and options
- `flush()` - Flush pending events
- `close()` - Close client and flush

### Not Yet Implemented

- Session replay
- Profiling
- Attachments
- Release health
- Cron monitoring (partial - `captureCheckIn` exists)

## Installation

```bash
npm install @dotdo/sentry
```

## Quick Start

### Basic Error Capture

```typescript
import * as Sentry from '@dotdo/sentry'

Sentry.init({
  dsn: env.SENTRY_DSN,
  environment: 'production',
  release: 'my-app@1.0.0',
})

// Capture an exception
try {
  riskyOperation()
} catch (error) {
  Sentry.captureException(error)
}

// Capture a message
Sentry.captureMessage('User completed onboarding', 'info')

// Capture with custom data
Sentry.captureMessage('Payment processed', 'info')
```

### With User Context

```typescript
import * as Sentry from '@dotdo/sentry'

Sentry.init({ dsn: env.SENTRY_DSN })

// Set user context for all events
Sentry.setUser({
  id: 'user-123',
  email: 'user@example.com',
  username: 'johndoe',
})

// Add tags for filtering in Sentry UI
Sentry.setTags({
  feature: 'checkout',
  tier: 'premium',
})

// Add extra data for debugging
Sentry.setExtra('orderId', 'order-456')
```

### With Breadcrumbs

```typescript
import * as Sentry from '@dotdo/sentry'

Sentry.init({ dsn: env.SENTRY_DSN })

// Add navigation breadcrumb
Sentry.addBreadcrumb({
  category: 'navigation',
  message: 'User clicked checkout button',
  level: 'info',
})

// Add HTTP breadcrumb
Sentry.addBreadcrumb({
  category: 'http',
  message: 'POST /api/orders',
  level: 'info',
  data: {
    method: 'POST',
    url: '/api/orders',
    status_code: 200,
  },
})

// When an error occurs, breadcrumbs are included automatically
Sentry.captureException(new Error('Checkout failed'))
```

### Scoped Operations

```typescript
import * as Sentry from '@dotdo/sentry'

Sentry.init({ dsn: env.SENTRY_DSN })

Sentry.withScope((scope) => {
  scope.setTag('component', 'payment')
  scope.setExtra('orderId', 'order-456')
  scope.setLevel('error')

  // This exception will include the scoped data
  Sentry.captureException(new Error('Payment failed'))
})

// Outside withScope, the extra data is not included
Sentry.captureMessage('General log message')
```

## Inbound Mode - Using sentry.do Locally

For testing and development, use `InMemoryTransport` to capture events without sending to Sentry:

```typescript
import * as Sentry from '@dotdo/sentry'
import { InMemoryTransport } from '@dotdo/sentry'

// Create in-memory transport for testing
const transport = new InMemoryTransport()

Sentry.init({
  dsn: 'https://key@sentry.example.com/1',
  transport: () => transport,
})

// Capture events
Sentry.captureException(new Error('Test error'))
Sentry.captureMessage('Test message')

// Access captured events
const events = transport.getEvents()
console.log(events) // [{ message: 'Test error', ... }, { message: 'Test message', ... }]

// Clear for next test
transport.clear()
```

### Testing with Vitest

```typescript
import { describe, it, expect, beforeEach } from 'vitest'
import * as Sentry from '@dotdo/sentry'
import { InMemoryTransport, _clear } from '@dotdo/sentry'

describe('Error handling', () => {
  let transport: InMemoryTransport

  beforeEach(() => {
    _clear() // Reset global Sentry state
    transport = new InMemoryTransport()

    Sentry.init({
      dsn: 'https://key@sentry.example.com/1',
      transport: () => transport,
    })
  })

  it('should capture validation errors', async () => {
    try {
      validateInput({ email: 'invalid' })
    } catch (error) {
      Sentry.captureException(error)
    }

    // Wait for async transport
    await new Promise((resolve) => setTimeout(resolve, 10))

    const events = transport.getEvents()
    expect(events).toHaveLength(1)
    expect(events[0].exception?.values?.[0].type).toBe('ValidationError')
  })
})
```

### Storage Client for Persistence

For advanced use cases, use `SentryClientWithStorage` which persists events to a TemporalStore:

```typescript
import { createStorageClient } from '@dotdo/sentry'

const client = createStorageClient({
  dsn: env.SENTRY_DSN,
  environment: 'development',
  offlineQueueing: true,
  isOnline: () => navigator.onLine,
})

// Events are stored locally and synced when online
client.captureException(new Error('Offline error'))

// Replay events from storage
await client.replayEvents(Date.now() - 3600000) // Last hour
```

## Outbound Mode - Connecting to Real Sentry

For production, the client connects to Sentry's API:

```typescript
import * as Sentry from '@dotdo/sentry'

Sentry.init({
  dsn: env.SENTRY_DSN,
  environment: 'production',
  release: 'my-app@1.0.0',
  sampleRate: 1.0, // Capture 100% of errors
  tracesSampleRate: 0.1, // Sample 10% of transactions
})

// All events go to Sentry
Sentry.captureException(new Error('Production error'))
```

### Cloudflare Worker Integration

```typescript
import * as Sentry from '@dotdo/sentry'

export default {
  async fetch(request: Request, env: Env, ctx: ExecutionContext) {
    Sentry.init({
      dsn: env.SENTRY_DSN,
      environment: env.ENVIRONMENT,
      release: env.RELEASE,
    })

    try {
      return await handleRequest(request, env)
    } catch (error) {
      Sentry.captureException(error)
      ctx.waitUntil(Sentry.flush(2000))
      throw error
    }
  },
}
```

### beforeSend Hook

Filter or modify events before sending:

```typescript
import * as Sentry from '@dotdo/sentry'

Sentry.init({
  dsn: env.SENTRY_DSN,
  beforeSend(event, hint) {
    // Filter out certain errors
    if (event.message?.includes('ResizeObserver')) {
      return null // Drop the event
    }

    // Scrub sensitive data
    if (event.user?.email) {
      event.user.email = '[REDACTED]'
    }

    // Add custom tags
    event.tags = { ...event.tags, handler: 'beforeSend' }

    return event
  },
})
```

## Performance Tracing

### Transactions and Spans

```typescript
import * as Sentry from '@dotdo/sentry'

Sentry.init({
  dsn: env.SENTRY_DSN,
  tracesSampleRate: 1.0,
})

// Start a transaction
const transaction = Sentry.startTransaction({
  name: 'GET /api/users',
  op: 'http.server',
})

// Create child spans
const dbSpan = transaction.startChild({
  op: 'db.query',
  description: 'SELECT * FROM users',
})

// Do database work...
dbSpan.setHttpStatus(200)
dbSpan.finish()

const cacheSpan = transaction.startChild({
  op: 'cache.get',
  description: 'users:list',
})
cacheSpan.finish()

// Finish transaction
transaction.setHttpStatus(200)
transaction.finish()
```

### Convenient startSpan Helper

```typescript
import * as Sentry from '@dotdo/sentry'

// Automatically creates and finishes span
const result = await Sentry.startSpan(
  { name: 'fetch-user-data', op: 'http.client' },
  async (span) => {
    const response = await fetch('/api/user')
    span.setHttpStatus(response.status)
    return response.json()
  }
)
```

### Distributed Tracing

```typescript
import * as Sentry from '@dotdo/sentry'

// Continue trace from incoming request
const transaction = Sentry.continueTrace(
  {
    sentryTrace: request.headers.get('sentry-trace') ?? undefined,
    baggage: request.headers.get('baggage') ?? undefined,
  },
  (ctx) => Sentry.startTransaction({
    name: 'POST /api/order',
    op: 'http.server',
    ...ctx,
  })
)
```

## API Reference

### Initialization

```typescript
Sentry.init(options: SentryOptions): void
```

| Option | Type | Description |
|--------|------|-------------|
| `dsn` | `string` | Sentry DSN (Data Source Name) |
| `environment` | `string` | Environment name (e.g., 'production') |
| `release` | `string` | Release version identifier |
| `sampleRate` | `number` | Error event sample rate (0.0 to 1.0) |
| `tracesSampleRate` | `number` | Transaction sample rate (0.0 to 1.0) |
| `maxBreadcrumbs` | `number` | Maximum breadcrumbs to store (default: 100) |
| `attachStacktrace` | `boolean` | Attach stack traces to messages |
| `sendDefaultPii` | `boolean` | Send default PII (IP address, etc.) |
| `beforeSend` | `function` | Hook to filter/modify events |
| `beforeBreadcrumb` | `function` | Hook to filter/modify breadcrumbs |
| `initialScope` | `object` | Initial scope configuration |

### Capture Methods

```typescript
// Capture an exception
Sentry.captureException(error: unknown, hint?: EventHint): string

// Capture a message
Sentry.captureMessage(message: string, level?: SeverityLevel): string

// Capture a custom event
Sentry.captureEvent(event: SentryEvent, hint?: EventHint): string
```

### Context Methods

```typescript
// Set user information
Sentry.setUser(user: User | null): void

// Set tags (searchable)
Sentry.setTags(tags: Record<string, string>): void
Sentry.setTag(key: string, value: string): void

// Set extras (arbitrary data)
Sentry.setExtras(extras: Record<string, unknown>): void
Sentry.setExtra(key: string, value: unknown): void

// Set context (structured data)
Sentry.setContext(name: string, context: Record<string, unknown> | null): void
```

### Breadcrumbs

```typescript
Sentry.addBreadcrumb(breadcrumb: Breadcrumb, hint?: BreadcrumbHint): void
```

| Property | Type | Description |
|----------|------|-------------|
| `category` | `string` | Category (e.g., 'http', 'navigation') |
| `message` | `string` | Breadcrumb message |
| `level` | `SeverityLevel` | Severity ('fatal', 'error', 'warning', 'info', 'debug') |
| `type` | `BreadcrumbType` | Type ('http', 'navigation', 'ui', 'query', etc.) |
| `data` | `object` | Additional data |
| `timestamp` | `number` | Unix timestamp (auto-added if missing) |

### Scope Methods

```typescript
// Run callback with isolated scope
Sentry.withScope(callback: (scope: Scope) => void): void

// Modify current scope
Sentry.configureScope(callback: (scope: Scope) => void): void

// Get current scope
Sentry.getCurrentScope(): Scope

// Get current hub
Sentry.getCurrentHub(): Hub
```

### Lifecycle

```typescript
// Flush pending events
await Sentry.flush(timeout?: number): Promise<boolean>

// Close client and flush
await Sentry.close(timeout?: number): Promise<boolean>
```

## Types

```typescript
import type {
  // Core types
  SentryEvent,
  SentryOptions,
  SeverityLevel,

  // User & Context
  User,
  Tags,
  Extras,
  Context,

  // Breadcrumbs
  Breadcrumb,
  BreadcrumbHint,
  BreadcrumbType,

  // Stack traces
  StackFrame,
  Stacktrace,
  ExceptionValue,

  // Scope & Hub
  Scope,
  Hub,

  // Transport
  Transport,
  TransportResult,
  Envelope,

  // Tracing
  Transaction,
  Span,
  SpanContext,
  SpanStatus,
} from '@dotdo/sentry'
```

## Breadcrumb Factory Functions

```typescript
import {
  createHttpBreadcrumb,
  createNavigationBreadcrumb,
  createConsoleBreadcrumb,
  createClickBreadcrumb,
  createErrorBreadcrumb,
  createQueryBreadcrumb,
  BreadcrumbManager,
} from '@dotdo/sentry'

// HTTP breadcrumb with auto-level based on status
const httpBreadcrumb = createHttpBreadcrumb({
  method: 'POST',
  url: '/api/users',
  statusCode: 201,
  duration: 150,
})

// Navigation breadcrumb
const navBreadcrumb = createNavigationBreadcrumb({
  from: '/home',
  to: '/checkout',
  navigationType: 'push',
})

// Database query breadcrumb
const queryBreadcrumb = createQueryBreadcrumb({
  system: 'postgresql',
  query: 'SELECT * FROM users WHERE id = $1',
  duration: 25,
  rowCount: 1,
})
```

## API Coverage

| Feature | Coverage | Notes |
|---------|----------|-------|
| Error Capture | Full | captureException, captureMessage, captureEvent |
| Context | Full | User, tags, extras, contexts |
| Breadcrumbs | Full | All types with factory functions |
| Scope | Full | withScope, configureScope, clone |
| Transactions | Full | startTransaction, startSpan |
| Spans | Full | Child spans, status mapping |
| Distributed Tracing | Full | continueTrace, traceparent headers |
| Sampling | Full | sampleRate, tracesSampleRate |
| beforeSend | Full | Sync and async |
| beforeBreadcrumb | Full | Filter/modify breadcrumbs |
| Session Replay | Not yet | |
| Profiling | Not yet | |

## Related

- [Events Overview](/docs/events) - Event handling patterns
- [Observability](/docs/observability) - Monitoring and tracing
- [Compat SDKs](/docs/compat) - All API-compatible SDKs
