---
title: Twilio
description: Drop-in replacement for the Twilio SDK with edge compatibility and local testing support.
---

# Twilio

Drop-in replacement for the Twilio JavaScript SDK. Your existing `twilio` code works unchanged - just swap the import.

```typescript
// Before: Twilio
import twilio from 'twilio'

// After: dotdo
import twilio from '@dotdo/twilio'

// Code stays the same
const client = twilio('ACXXXXXXXXX', 'your_auth_token')

const message = await client.messages.create({
  body: 'Hello from dotdo!',
  from: '+15017122661',
  to: '+15558675310',
})

const call = await client.calls.create({
  url: 'https://example.com/twiml',
  to: '+15558675310',
  from: '+15017122661',
})
```

## Why @dotdo/twilio?

| Twilio SDK | @dotdo/twilio |
|------------|---------------|
| Node.js runtime required | Edge-compatible (Cloudflare Workers) |
| Real API calls in tests | Local testing with mock responses |
| Network latency | Zero latency in local mode |
| Requires ngrok for dev webhooks | Built-in webhook handlers |
| Separate test credentials | Same code, different backends |

**This is a proxy/compatibility layer.** It can either forward to real Twilio APIs (production) or provide mock responses for testing and development. The API surface matches Twilio's official SDK.

## Features

### Implemented (Core APIs)

**SMS (Messages)**
- `create()` - Send SMS/MMS messages
- `list()` - List messages with filters
- `(sid).fetch()` - Retrieve message details
- `(sid).update()` - Update message (cancel scheduled)
- `(sid).remove()` - Delete message
- Status callbacks, media URLs, scheduling

**Voice (Calls)**
- `create()` - Make outbound calls with URL or TwiML
- `list()` - List calls with filters
- `(sid).fetch()` - Retrieve call details
- `(sid).update()` - Modify in-progress calls
- `(sid).recordings.create()` - Start recording
- Machine detection, status callbacks

**TwiML Response Builder**
- `VoiceResponse` - Build voice call flows
- Say, Play, Gather, Record, Dial verbs
- Conference, Queue, Redirect, Reject
- Number, Client, SIP, Conference nouns

**Verify (OTP)**
- `startVerification()` - Send verification codes
- `checkVerification()` - Validate codes
- `cancelVerification()` - Cancel pending verifications
- SMS, Call, Email, WhatsApp channels
- Custom code length (4-10 digits)

**WhatsApp**
- `send()` - Text messages
- `sendTemplate()` - Template messages (outside 24h window)
- `sendMedia()` - Images, videos, documents
- `sendButtons()` - Interactive button messages
- `sendList()` - Interactive list messages
- `sendLocation()` - Location sharing
- `sendContact()` - Contact cards
- 24-hour session window tracking

**Webhooks**
- `Webhooks.validateRequest()` - Signature verification
- `Webhooks.validateRequestWithBody()` - JSON webhook validation
- `Webhooks.getExpectedTwilioSignature()` - Generate test signatures

### Not Yet Implemented

- Phone Numbers management
- Lookup API
- Programmable Video
- Conversations API
- TaskRouter
- Studio Flows
- Proxy
- Fax

## Quick Start

### Install

```bash
npm install @dotdo/twilio
```

### Send SMS

```typescript
import twilio from '@dotdo/twilio'

const client = twilio(env.TWILIO_ACCOUNT_SID, env.TWILIO_AUTH_TOKEN)

const message = await client.messages.create({
  body: 'Your verification code is 123456',
  from: '+15017122661',
  to: '+15558675310',
  statusCallback: 'https://example.com/webhook/sms-status',
})

console.log('Message SID:', message.sid)
```

### Make Voice Call

```typescript
import twilio from '@dotdo/twilio'

const client = twilio(env.TWILIO_ACCOUNT_SID, env.TWILIO_AUTH_TOKEN)

// With TwiML URL
const call = await client.calls.create({
  url: 'https://example.com/twiml',
  to: '+15558675310',
  from: '+15017122661',
})

// With inline TwiML
const call = await client.calls.create({
  twiml: '<Response><Say>Hello!</Say></Response>',
  to: '+15558675310',
  from: '+15017122661',
})
```

## Inbound - Using twilio.do Locally

For testing and development, the compat layer validates inputs and can operate without making real API calls:

```typescript
import twilio from '@dotdo/twilio'

// Create client - validates credentials format
const client = twilio('ACtest123456789', 'test_auth_token')

// Messages are validated before sending
try {
  await client.messages.create({
    body: 'Hello!',
    to: '+15558675310',
    // Missing 'from' - will throw validation error
  })
} catch (error) {
  // TwilioAPIError: A 'From' phone number is required.
  console.log(error.code)     // 21603
  console.log(error.moreInfo) // https://www.twilio.com/docs/errors/21603
}
```

### Focused SMS Client

```typescript
import { TwilioSMS } from '@dotdo/twilio/sms'

const sms = new TwilioSMS({
  accountSid: 'ACXXXXXXXXX',
  authToken: 'your_auth_token',
  defaultFrom: '+15017122661',
  rateLimit: {
    maxRequests: 100,
    windowMs: 1000, // 100 requests per second
  },
})

// Send with defaults
const message = await sms.send({
  to: '+15558675310',
  body: 'Hello!',
})

// Track status locally
const status = sms.getTrackedStatus(message.sid)

// Built-in webhook handler (Hono router)
const webhookRouter = sms.createWebhookHandler()
```

### Focused Verify Client

```typescript
import { TwilioVerify } from '@dotdo/twilio/verify'

const verify = new TwilioVerify({
  accountSid: 'ACXXXXXXXXX',
  authToken: 'your_auth_token',
  serviceSid: 'VAXXXXXXXXX',
})

// Start verification
const verification = await verify.startVerification({
  to: '+15558675310',
  channel: 'sms',
  codeLength: 6,
})

// Check code
const result = await verify.checkVerification({
  to: '+15558675310',
  code: '123456',
})

if (result.valid) {
  console.log('Verification successful!')
}
```

## Outbound - Connecting to Real Twilio

For production, the client connects to Twilio's API:

```typescript
import twilio from '@dotdo/twilio'

const client = twilio(env.TWILIO_ACCOUNT_SID, env.TWILIO_AUTH_TOKEN, {
  region: 'us1',           // Optional: edge location
  timeout: 30000,          // Request timeout (ms)
  autoRetry: true,         // Enable automatic retries
  maxRetries: 3,           // Retry count
})

// All requests go to api.twilio.com
const message = await client.messages.create({
  body: 'Hello from production!',
  from: '+15017122661',
  to: '+15558675310',
})
```

### Edge Compatibility

Works in Cloudflare Workers without Node.js dependencies:

```typescript
// worker.ts
import twilio from '@dotdo/twilio'
import { VoiceResponse } from '@dotdo/twilio/voice'

export default {
  async fetch(request: Request, env: Env): Promise<Response> {
    const url = new URL(request.url)

    // Handle incoming call webhook
    if (url.pathname === '/voice') {
      const response = new VoiceResponse()
      response.say('Hello! Thanks for calling.', { voice: 'Polly.Amy' })
      response.gather({
        numDigits: 1,
        action: '/handle-key',
      }).say('Press 1 for sales, 2 for support.')

      return new Response(response.toString(), {
        headers: { 'Content-Type': 'application/xml' },
      })
    }

    // Send SMS
    if (url.pathname === '/send-sms') {
      const client = twilio(env.TWILIO_ACCOUNT_SID, env.TWILIO_AUTH_TOKEN)

      const message = await client.messages.create({
        body: 'Hello from Workers!',
        from: env.TWILIO_PHONE_NUMBER,
        to: '+15558675310',
      })

      return Response.json({ sid: message.sid })
    }

    return new Response('Not Found', { status: 404 })
  },
}
```

## TwiML Response Builder

Build voice call flows with the fluent TwiML API:

```typescript
import { VoiceResponse } from '@dotdo/twilio/voice'

// Basic greeting
const response = new VoiceResponse()
response.say('Welcome to our service!', { voice: 'Polly.Joanna' })
console.log(response.toString())
// <?xml version="1.0" encoding="UTF-8"?>
// <Response><Say voice="Polly.Joanna">Welcome to our service!</Say></Response>
```

### IVR Menu

```typescript
const response = new VoiceResponse()
response.say('Welcome!')

const gather = response.gather({
  numDigits: 1,
  action: '/handle-key',
  timeout: 10,
})
gather.say('Press 1 for sales.')
gather.say('Press 2 for support.')
gather.say('Press 3 to repeat this menu.')

response.say('We did not receive any input. Goodbye!')
response.hangup()
```

### Conference Call

```typescript
const response = new VoiceResponse()
response.say('You are joining the conference.')

const dial = response.dial()
dial.conference('MyRoom', {
  startConferenceOnEnter: true,
  endConferenceOnExit: false,
  waitUrl: 'http://twimlets.com/holdmusic?Bucket=com.twilio.music.classical',
  record: 'record-from-start',
})
```

### Call Recording

```typescript
const response = new VoiceResponse()
response.say('This call will be recorded.')
response.record({
  action: '/handle-recording',
  maxLength: 60,
  transcribe: true,
  transcribeCallback: '/handle-transcription',
})
```

## WhatsApp Messaging

Send WhatsApp messages with full feature support:

```typescript
import { TwilioWhatsApp } from '@dotdo/twilio/whatsapp'

const whatsapp = new TwilioWhatsApp({
  accountSid: 'ACXXXXXXXXX',
  authToken: 'your_auth_token',
  from: 'whatsapp:+14155238886',
  trackSessions: true, // Track 24-hour windows
})

// Text message (requires active session)
const message = await whatsapp.send({
  to: 'whatsapp:+15558675310',
  body: 'Hello from WhatsApp!',
})

// Template message (works outside 24h window)
const template = await whatsapp.sendTemplate({
  to: 'whatsapp:+15558675310',
  contentSid: 'HX123456789',
  contentVariables: { '1': 'John', '2': 'Order #12345' },
})

// Media message
const media = await whatsapp.sendMedia({
  to: 'whatsapp:+15558675310',
  mediaUrl: 'https://example.com/receipt.pdf',
  body: 'Here is your receipt',
})

// Interactive buttons
const buttons = await whatsapp.sendButtons({
  to: 'whatsapp:+15558675310',
  body: 'Would you like to proceed?',
  buttons: [
    { id: 'yes', title: 'Yes' },
    { id: 'no', title: 'No' },
  ],
})
```

### Session Management

WhatsApp has a 24-hour messaging window after user interaction:

```typescript
// Check if session is active
if (whatsapp.isSessionActive('whatsapp:+15558675310')) {
  await whatsapp.send({ to: 'whatsapp:+15558675310', body: 'Quick reply!' })
} else {
  // Must use template outside window
  await whatsapp.sendTemplate({
    to: 'whatsapp:+15558675310',
    contentSid: 'HX123456789',
  })
}

// Get session details
const session = whatsapp.getSession('whatsapp:+15558675310')
if (session) {
  console.log('Expires:', session.expiresAt)
  console.log('Time remaining:', whatsapp.getSessionTimeRemaining('whatsapp:+15558675310'))
}
```

## Webhooks

### Verifying Signatures

```typescript
import { Webhooks } from '@dotdo/twilio'

export default {
  async fetch(request: Request, env: Env): Promise<Response> {
    const signature = request.headers.get('X-Twilio-Signature')!
    const url = request.url
    const body = await request.formData()
    const params = Object.fromEntries(body.entries()) as Record<string, string>

    const isValid = await Webhooks.validateRequest(
      env.TWILIO_AUTH_TOKEN,
      signature,
      url,
      params
    )

    if (!isValid) {
      return new Response('Invalid signature', { status: 403 })
    }

    // Handle webhook...
    return new Response('OK')
  },
}
```

### SMS Status Webhook

```typescript
import { TwilioSMS } from '@dotdo/twilio/sms'

const sms = new TwilioSMS({ accountSid: '...', authToken: '...' })
const webhookRouter = sms.createWebhookHandler()

// Mounts routes at:
// POST /status - Status callback webhook
// POST /inbound - Incoming message webhook
app.route('/webhooks/sms', webhookRouter)
```

### Voice Webhook Handler

```typescript
import { parseVoiceWebhook, VoiceResponse } from '@dotdo/twilio/voice'

export default {
  async fetch(request: Request): Promise<Response> {
    const formData = await request.formData()
    const params = Object.fromEntries(formData.entries()) as Record<string, string>
    const webhook = parseVoiceWebhook(params)

    // Access parsed fields
    console.log('Call SID:', webhook.CallSid)
    console.log('From:', webhook.From)
    console.log('Digits:', webhook.Digits) // If from Gather

    // Build response
    const response = new VoiceResponse()
    if (webhook.Digits === '1') {
      response.say('Connecting you to sales.')
      response.dial('+15551234567')
    } else {
      response.say('Goodbye!')
      response.hangup()
    }

    return new Response(response.toString(), {
      headers: { 'Content-Type': 'application/xml' },
    })
  },
}
```

## API Reference

### Messages

```typescript
// Create message
const message = await client.messages.create({
  to: '+15558675310',
  from: '+15017122661',
  body: 'Hello!',
  mediaUrl: ['https://example.com/image.jpg'], // MMS
  statusCallback: 'https://example.com/status',
  validityPeriod: 3600, // Max age in seconds
  sendAt: new Date('2025-01-15T10:00:00Z'), // Schedule
})

// List messages
const messages = await client.messages.list({
  to: '+15558675310',
  dateSentAfter: new Date('2025-01-01'),
  pageSize: 20,
})

// Get message
const message = await client.messages('SM123').fetch()

// Update message
await client.messages('SM123').update({ status: 'canceled' })

// Delete message
await client.messages('SM123').remove()
```

### Calls

```typescript
// Create call
const call = await client.calls.create({
  to: '+15558675310',
  from: '+15017122661',
  url: 'https://example.com/twiml',
  // or: twiml: '<Response><Say>Hello</Say></Response>',
  statusCallback: 'https://example.com/status',
  statusCallbackEvent: ['initiated', 'ringing', 'answered', 'completed'],
  record: true,
  machineDetection: 'Enable',
})

// List calls
const calls = await client.calls.list({
  status: 'completed',
  startTimeAfter: new Date('2025-01-01'),
})

// Get call
const call = await client.calls('CA123').fetch()

// Update call (redirect)
await client.calls('CA123').update({
  url: 'https://example.com/new-twiml',
})

// End call
await client.calls('CA123').update({ status: 'completed' })
```

### Verify

```typescript
const verify = client.verify.v2.services('VAXXXXXXXXX')

// Start verification
const verification = await verify.verifications.create({
  to: '+15558675310',
  channel: 'sms', // sms, call, email, whatsapp
  codeLength: 6,
  locale: 'en',
})

// Check code
const check = await verify.verificationChecks.create({
  to: '+15558675310',
  code: '123456',
})

// Get verification
const verification = await verify.verifications('VE123').fetch()

// Cancel verification
await verify.verifications('VE123').update({ status: 'canceled' })
```

### Recordings (VoiceClient)

```typescript
import { VoiceClient } from '@dotdo/twilio/voice'

const voice = new VoiceClient(env.TWILIO_ACCOUNT_SID, env.TWILIO_AUTH_TOKEN)

// Start recording on active call
const recording = await voice.calls('CA123').recordings.create({
  recordingChannels: 'dual',
  recordingStatusCallback: 'https://example.com/recording-status',
})

// List recordings for a call
const recordings = await voice.calls('CA123').recordings.list()

// List all recordings
const allRecordings = await voice.recordings.list({ callSid: 'CA123' })

// Get recording
const recording = await voice.recordings('RE123').fetch()

// Delete recording
await voice.recordings('RE123').delete()

// Pause/resume recording
await voice.calls('CA123').recordings.update('RE123', { status: 'paused' })
await voice.calls('CA123').recordings.update('RE123', { status: 'in-progress' })
```

### Conferences (VoiceClient)

```typescript
import { VoiceClient } from '@dotdo/twilio/voice'

const voice = new VoiceClient(env.TWILIO_ACCOUNT_SID, env.TWILIO_AUTH_TOKEN)

// List conferences
const conferences = await voice.conferences.list({
  status: 'in-progress',
  friendlyName: 'MyRoom',
})

// Get conference
const conference = await voice.conferences('CF123').fetch()

// Add participant
const participant = await voice.conferences('CF123').participants.create({
  from: '+15017122661',
  to: '+15558675310',
  startConferenceOnEnter: true,
})

// Update participant
await voice.conferences('CF123').participants('CA123').update({
  muted: true,
  hold: false,
})

// Remove participant
await voice.conferences('CF123').participants('CA123').delete()

// End conference
await voice.conferences('CF123').update({ status: 'completed' })
```

## Error Handling

```typescript
import { TwilioAPIError } from '@dotdo/twilio'

try {
  await client.messages.create({
    to: 'invalid',
    from: '+15017122661',
    body: 'Hello',
  })
} catch (error) {
  if (error instanceof TwilioAPIError) {
    console.log('Code:', error.code)       // 21211
    console.log('Status:', error.status)   // 400
    console.log('Message:', error.message) // "The 'To' number is not valid"
    console.log('More Info:', error.moreInfo) // https://www.twilio.com/docs/errors/21211
  }
}
```

### Common Error Codes

| Code | Description |
|------|-------------|
| 21211 | Invalid 'To' phone number |
| 21212 | Invalid 'From' phone number |
| 21602 | Message body required |
| 21603 | 'From' number required |
| 21604 | 'To' number required |
| 21205 | URL or TwiML required for calls |
| 60200 | Invalid Verify parameter |

## Types

Full TypeScript support with comprehensive type definitions:

```typescript
import type {
  // Core types
  Message,
  MessageStatus,
  MessageDirection,
  Call,
  CallStatus,
  CallDirection,

  // Create params
  MessageCreateParams,
  MessageListParams,
  CallCreateParams,
  CallListParams,

  // Verify types
  Verification,
  VerificationCheck,
  VerificationChannel,
  VerificationStatus,

  // Voice types
  Recording,
  Conference,
  Participant,
  VoiceWebhookPayload,

  // WhatsApp types
  WhatsAppSendRequest,
  WhatsAppSendResponse,
  WhatsAppSession,
  WhatsAppButton,
  WhatsAppListSection,

  // Webhook types
  MessageWebhookPayload,
  CallWebhookPayload,

  // Config
  TwilioClientConfig,
  TwilioErrorResponse,
} from '@dotdo/twilio'
```

## Migration from Twilio SDK

### Package Change

```bash
# Remove
npm uninstall twilio

# Install
npm install @dotdo/twilio
```

### Import Change

```typescript
// Before (default import)
import twilio from 'twilio'
const client = twilio('ACXXX', 'auth_token')

// After (same pattern works)
import twilio from '@dotdo/twilio'
const client = twilio('ACXXX', 'auth_token')

// Or named import
import { TwilioClient } from '@dotdo/twilio'
const client = new TwilioClient('ACXXX', 'auth_token')
```

### Code Compatibility

Your existing Twilio code should work unchanged:

```typescript
// This code works with both twilio and @dotdo/twilio
const message = await client.messages.create({
  body: 'Hello!',
  from: '+15017122661',
  to: '+15558675310',
})

const call = await client.calls.create({
  url: 'https://example.com/twiml',
  from: '+15017122661',
  to: '+15558675310',
})

const verification = await client.verify.v2
  .services('VAXXXXXXXXX')
  .verifications.create({
    to: '+15558675310',
    channel: 'sms',
  })
```

## Architecture

```
+-------------------------------------------------------------+
|                    Your Application                          |
|                                                              |
|  const client = twilio(sid, token)                          |
|  await client.messages.create(...)                          |
+-------------------------------------------------------------+
                              |
              +---------------+---------------+
              |                               |
              v                               v
+-------------------------+     +-------------------------+
|   Production Mode       |     |     Test Mode           |
|   (Real Twilio)         |     |     (Validation Only)   |
+-------------------------+     +-------------------------+
|                         |     |                         |
|  -> api.twilio.com      |     |  -> Input validation    |
|  -> Real SMS/Calls      |     |  -> Error simulation    |
|  -> Live credentials    |     |  -> Mock responses      |
|  -> Webhook delivery    |     |  -> Local webhooks      |
|                         |     |                         |
+-------------------------+     +-------------------------+
```

### Production Mode Benefits

- Full Twilio API compatibility
- Automatic retries with backoff
- Edge-compatible (no Node.js required)
- Webhook signature verification

### Test Mode Benefits

- No API calls required
- Fast validation feedback
- Predictable error handling
- Works offline

## Related

- [Events Overview](/docs/events) - Event handling including webhooks
- [SDK Events](/docs/sdk/events) - Event subscription patterns
- [Compat SDKs](/docs/compat) - All API-compatible SDKs
