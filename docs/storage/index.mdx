---
title: Storage Architecture
description: Tiered storage with automatic data flow - $0 egress, pennies per TB
---

import { Cards, Card } from 'fumadocs-ui/components/card'

# Storage Architecture

dotdo uses a three-tier storage architecture that automatically moves data based on access patterns. Your data flows from hot working sets to cold analytics without manual intervention.

```
┌─────────────────────────────────────────────────────────────────────┐
│                    HOT: DO SQLite                                   │
│  Active working set. 50ms reads. 10GB per shard.                   │
└────────────────────────────┬────────────────────────────────────────┘
                             │ Cloudflare Pipelines (streaming)
                             ▼
┌─────────────────────────────────────────────────────────────────────┐
│                  WARM: R2 + Iceberg/Parquet                         │
│  Cross-DO queries. 100-150ms. Partitioned by (ns, type, visibility) │
└────────────────────────────┬────────────────────────────────────────┘
                             │ R2 SQL / ClickHouse
                             ▼
┌─────────────────────────────────────────────────────────────────────┐
│                  COLD: ClickHouse + R2 Archive                      │
│  Analytics, aggregations, time-series. Pennies per TB.              │
└─────────────────────────────────────────────────────────────────────┘
```

## The Tiers

| Tier | Storage | Latency | Use Case |
|------|---------|---------|----------|
| **[Hot](/docs/storage/hot-tier)** | DO SQLite | ~50ms | Active working set, real-time state |
| **[Warm](/docs/storage/warm-tier)** | R2 + Iceberg/Parquet | 100-150ms | Cross-DO queries, historical data |
| **[Cold](/docs/storage/cold-tier)** | ClickHouse + R2 Archive | Variable | Analytics, aggregations, time-series |

## Automatic Data Flow

Data moves through tiers automatically:

1. **Active data** lives in DO SQLite for sub-100ms access
2. **Old versions** archive to R2 via Cloudflare Pipelines
3. **Analytics** stream to Iceberg tables for SQL queries
4. **Time-series** aggregate in ClickHouse for dashboards

You don't manage this. It just works.

## Zero Egress, Massive Savings

The entire architecture runs on Cloudflare R2, which has **$0 egress fees**.

| Service | Egress | Storage |
|---------|--------|---------|
| **Cloudflare R2** | **$0** | $0.015/GB-mo |
| AWS S3 | $0.09/GB | $0.023/GB-mo |
| Snowflake | $0.05-0.12/GB | Credit-based |

A typical data warehouse that costs $10,000/month on AWS runs for under $1,000 on this stack. Your analytics queries don't cost per-byte. Your agents don't pay to read their own data.

## Quick Example

```typescript
// Hot tier: Real-time state in DO SQLite
const customer = await $.Customer('cust_abc').get()

// Warm tier: Cross-DO query via Iceberg
const orders = await $.query(`
  SELECT * FROM orders
  WHERE customer_id = 'cust_abc'
  AND created_at > NOW() - INTERVAL '30 days'
`)

// Cold tier: Analytics aggregation
const metrics = await $.analytics(`
  SELECT
    date_trunc('day', created_at) as day,
    count(*) as orders,
    sum(total) as revenue
  FROM orders
  WHERE created_at > NOW() - INTERVAL '1 year'
  GROUP BY 1
`)
```

Same data, different access patterns, automatic tier selection.

## Technical Details

For implementation details and architecture documentation:

| Component | README | Description |
|-----------|--------|-------------|
| **db/** | [README](https://github.com/dotdo/dotdo/blob/main/db/README.md) | Database architecture overview, columnar storage, query accelerator |
| **db/iceberg/** | [README](https://github.com/dotdo/dotdo/blob/main/db/iceberg/README.md) | Direct Iceberg navigation for fast point lookups |
| **db/edge-postgres/** | [README](https://github.com/dotdo/dotdo/blob/main/db/edge-postgres/README.md) | PGLite + FSX + Iceberg for Postgres on edge |

### Key Concepts

- **Columnar storage** - Each column stored as separate SQLite row for 99%+ cost savings
- **Iceberg navigation** - 50-150ms point lookups vs 500ms-2s R2 SQL
- **Tiered architecture** - Automatic data flow from hot (DO SQLite) to warm (R2/Iceberg) to cold (ClickHouse)

## Storage Tiers

<Cards>
  <Card title="Hot Tier" href="/docs/storage/hot-tier">
    DO SQLite for active working set with ~50ms reads.
  </Card>
  <Card title="Warm Tier" href="/docs/storage/warm-tier">
    R2 + Iceberg/Parquet for cross-DO queries and historical data.
  </Card>
  <Card title="Cold Tier" href="/docs/storage/cold-tier">
    ClickHouse + R2 Archive for analytics and aggregations.
  </Card>
</Cards>

## Storage Components

<Cards>
  <Card title="KV Storage" href="/docs/storage/kv">
    Cloudflare KV for globally distributed key-value storage.
  </Card>
  <Card title="R2 Object Storage" href="/docs/storage/r2">
    R2 for blob storage with $0 egress and S3 compatibility.
  </Card>
  <Card title="Durable Objects Storage" href="/docs/storage/durable-objects">
    Built-in DO storage for transactional state.
  </Card>
  <Card title="Migrations" href="/docs/storage/migrations">
    Schema evolution and data migration patterns.
  </Card>
</Cards>

## Related

- [Database](/docs/database) - SQL, document, vector, and time-series database primitives
- [Database: Things](/docs/database/things) - Entity storage with append-only versioning
- [Database: Stores](/docs/database/stores) - Typed store accessors
- [Database: Iceberg](/docs/database/iceberg) - Apache Iceberg format for cold storage
