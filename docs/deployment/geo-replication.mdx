---
title: Geo-Replication
description: Multi-region deployment with jurisdiction controls, read replicas, and automatic failover
---

# Geo-Replication

dotdo runs on Cloudflare's global edge network. Geo-replication distributes your data across regions for lower latency, higher availability, and data residency compliance.

## Basic Usage

```typescript
startup.replicate({
  primary: 'us-east',
  secondaries: ['eu-west', 'asia-pacific'],
  readPreference: 'nearest',
})
```

## Placement Hierarchy

dotdo supports three levels of placement precision:

### 1. Jurisdictions (Guaranteed)

```typescript
startup.replicate({
  jurisdiction: 'eu',     // GDPR compliance
  readFrom: 'nearest',
})
```

Cloudflare guarantees that data never leaves the specified jurisdiction:

| Jurisdiction | Description | Regions Allowed |
|--------------|-------------|-----------------|
| `eu` | European Union | eu-west-1, eu-west-2, eu-west-3, eu-central-1, eu-north-1 |
| `us` | United States | us-east-1, us-east-2, us-west-1, us-west-2, ca-central-1 |
| `fedramp` | US Government | us-gov-west-1, us-gov-east-1 |

### 2. Regions (Location Hints)

```typescript
startup.replicate({
  regions: ['us-east-1', 'eu-west-1', 'ap-northeast-1'],
  readFrom: 'nearest',
})
```

Regions use AWS-style names and map to Cloudflare location hints:

| Region | Cloudflare Hint | Primary Colo |
|--------|-----------------|--------------|
| us-east-1 | enam | iad (Virginia) |
| us-west-2 | wnam | sea (Seattle) |
| eu-west-1 | weur | dub (Dublin) |
| eu-central-1 | weur | fra (Frankfurt) |
| ap-northeast-1 | apac | nrt (Tokyo) |
| ap-southeast-1 | apac | sin (Singapore) |
| ap-southeast-2 | oc | syd (Sydney) |
| sa-east-1 | sam | gru (Sao Paulo) |

### 3. Cities (IATA Codes)

```typescript
startup.replicate({
  cities: ['fra', 'lhr', 'ams'],  // Frankfurt, London, Amsterdam
  readFrom: 'nearest',
})
```

Cities provide guaranteed colo placement using IATA airport codes:

| Code | City | Region |
|------|------|--------|
| `iad` | Washington DC | us-east |
| `dfw` | Dallas | us-east |
| `sea` | Seattle | us-west |
| `lax` | Los Angeles | us-west |
| `sfo` | San Francisco | us-west |
| `ord` | Chicago | us-east |
| `lhr` | London | eu-west |
| `cdg` | Paris | eu-west |
| `fra` | Frankfurt | eu-west |
| `ams` | Amsterdam | eu-west |
| `nrt` | Tokyo | asia-pacific |
| `sin` | Singapore | asia-pacific |
| `hkg` | Hong Kong | asia-pacific |
| `syd` | Sydney | oceania |

## Read Preferences

### Nearest

```typescript
startup.replicate({
  regions: ['us-east-1', 'eu-west-1', 'ap-northeast-1'],
  readFrom: 'nearest',  // Default
})
```

Reads route to the geographically closest replica based on the request's origin. Provides lowest latency but eventual consistency.

### Primary

```typescript
startup.replicate({
  regions: ['us-east-1', 'eu-west-1'],
  readFrom: 'primary',
})
```

All reads go to the primary replica. Strong consistency, higher latency for distant users.

### Secondary

```typescript
startup.replicate({
  regions: ['us-east-1', 'eu-west-1', 'ap-northeast-1'],
  readFrom: 'secondary',
})
```

Reads prefer secondary replicas, falling back to primary if none available. Offloads read traffic from primary.

## Write Behavior

Writes always go to the primary:

```typescript
const manager = new ReplicaManager(env.DO, {
  jurisdiction: 'eu',
  regions: ['eu-west-1', 'eu-central-1'],
  readFrom: 'nearest',
  writeThrough: true,  // Replicate writes to secondaries
})

// Write goes to primary
const writeStub = await manager.getWriteStub('my-database')
await writeStub.fetch('/write', { method: 'POST', body: data })
```

### Write-Through Replication

```typescript
const results = await manager.writeThroughAll(
  'my-database',
  '/write',
  { method: 'POST', body: data }
)

// Check replication status
for (const result of results) {
  if (result.error) {
    console.error(`Replica ${result.region || result.city} failed: ${result.error}`)
  }
}
```

Write-through replicates writes to all secondaries synchronously. Use when you need strong consistency guarantees.

## Colo Targeting

For precise placement, use colo targeting with IATA codes:

```typescript
// Create a DO in a specific city
thing.promote({
  colo: 'Tokyo',           // City name
  // OR
  colo: 'nrt',             // IATA code
  region: 'asia-pacific',
  preserveHistory: true
})
```

### Colo Bindings

```typescript
// Map cities to their DO namespaces
const coloBindings: ColoBindings = {
  fra: env.DO_FRANKFURT,
  lhr: env.DO_LONDON,
  nrt: env.DO_TOKYO,
}

const manager = new ReplicaManager(env.DO, {
  cities: ['fra', 'lhr', 'nrt'],
  readFrom: 'nearest',
}, coloBindings)

// Get stub in specific city
const tokyoStub = await manager.getStubInCity('my-db', 'nrt')
```

## Data Residency Compliance

### GDPR (EU)

```typescript
startup.replicate({
  jurisdiction: 'eu',          // Data stays in EU
  cities: ['fra', 'ams'],      // Frankfurt, Amsterdam
  readFrom: 'nearest',
})
```

### FedRAMP (US Government)

```typescript
startup.replicate({
  jurisdiction: 'fedramp',
  regions: ['us-gov-east-1'],
  readFrom: 'primary',
})
```

### Mixed Jurisdictions

```typescript
// Global users, regional data
const userRegion = getUserRegion(request)

if (userRegion === 'eu') {
  startup.replicate({
    jurisdiction: 'eu',
    cities: ['fra', 'lhr'],
    readFrom: 'nearest',
  })
} else {
  startup.replicate({
    jurisdiction: 'us',
    regions: ['us-east-1', 'us-west-2'],
    readFrom: 'nearest',
  })
}
```

## Failover

### Automatic Failover

When a primary becomes unavailable, dotdo automatically promotes a secondary:

```typescript
startup.replicate({
  primary: 'us-east-1',
  secondaries: ['eu-west-1', 'ap-northeast-1'],
  readFrom: 'nearest',
  failover: {
    automatic: true,
    healthCheckInterval: 30000,  // 30s
    failoverThreshold: 3,        // 3 failed checks
  }
})
```

### Manual Failover

```typescript
// Force promotion of a secondary
await startup.promoteReplica('eu-west-1')

// Demote the old primary back to secondary
await startup.demoteReplica('us-east-1')
```

## Monitoring

```typescript
const status = await startup.replicaStatus()

console.log(status)
// {
//   primary: { region: 'us-east-1', healthy: true, lag: 0 },
//   secondaries: [
//     { region: 'eu-west-1', healthy: true, lag: 150 },
//     { region: 'ap-northeast-1', healthy: true, lag: 280 }
//   ],
//   lastSync: '2024-01-15T10:30:00Z'
// }
```

## Geographic Regions

| Region | CF Hint | Description |
|--------|---------|-------------|
| `us-west` | wnam | Western North America |
| `us-east` | enam | Eastern North America |
| `south-america` | sam | South America |
| `eu-west` | weur | Western Europe |
| `eu-east` | eeur | Eastern Europe |
| `asia-pacific` | apac | Asia-Pacific |
| `oceania` | oc | Australia/NZ |
| `africa` | afr | Africa |
| `middle-east` | me | Middle East |

## Limits

| Limit | Value |
|-------|-------|
| Replicas per DO | Unlimited |
| Jurisdictions | 3 (eu, us, fedramp) |
| Supported regions | 21 |
| Supported cities | 35+ |

## Related

- [Sharding](/docs/deployment/sharding) - Horizontal scaling
- [Promote/Demote](/docs/deployment/promote-demote) - Dynamic entity scaling
