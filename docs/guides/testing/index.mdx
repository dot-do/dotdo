---
title: Testing Overview
description: How to test dotdo applications with Vitest and Cloudflare Workers
---

# Testing Overview

dotdo uses Vitest with `@cloudflare/vitest-pool-workers` for testing Durable Objects, agents, and workflows. This setup provides true Workers runtime testing with Miniflare for local simulation.

## Testing Stack

| Tool | Purpose |
|------|---------|
| Vitest | Test runner with TypeScript support |
| @cloudflare/vitest-pool-workers | Workers runtime pool for Miniflare |
| Miniflare | Local DO/KV/R2 simulation |
| Test fixtures | Deterministic agent mocking |

## Project Structure

Tests are organized in a workspace configuration:

```
vitest.workspace.ts          # Workspace definitions
tests/config/
  vitest.shared.ts           # Shared configuration
  vitest.workers.config.ts   # Workers pool config
```

Run tests by project:

```bash
npx vitest --project=workers      # Workers runtime tests
npx vitest --project=objects      # Durable Objects (mocked)
npx vitest --project=agents       # Agent SDK tests
npx vitest --project=compat       # Compat layer tests
```

## Quick Start

Here is a minimal test for a Durable Object:

```typescript title="objects/tests/my-startup.test.ts"
import { describe, it, expect } from 'vitest'

// Mock infrastructure
function createMockState() {
  const storage = new Map()
  return {
    id: { toString: () => 'test-id' },
    storage: {
      get: async (key: string) => storage.get(key),
      put: async (key: string, value: unknown) => storage.set(key, value),
    },
  }
}

describe('MyStartup', () => {
  it('initializes with default state', async () => {
    const { MyStartup } = await import('../MyStartup')
    const state = createMockState()
    const startup = new MyStartup(state, {})

    expect(startup).toBeDefined()
  })
})
```

## Environment Configuration

The Workers pool configuration enables true runtime testing:

```typescript title="tests/config/vitest.workers.config.ts"
import { defineWorkersConfig } from '@cloudflare/vitest-pool-workers/config'

export default defineWorkersConfig({
  test: {
    globals: true,
    pool: '@cloudflare/vitest-pool-workers',
    poolOptions: {
      workers: {
        wrangler: { configPath: './wrangler.jsonc' },
        isolatedStorage: true,  // Clean slate per test
        singleWorker: true,     // CI stability
        miniflare: {
          compatibilityDate: '2026-01-08',
          compatibilityFlags: ['nodejs_compat', 'nodejs_compat_v2'],
        },
      },
    },
  },
})
```

## Test Categories

dotdo tests fall into three categories:

### Unit Tests

Test individual components in isolation with mocked dependencies. These run in Node.js environment for speed.

```typescript
// Test DO methods with mocked storage
const result = await startup.configure({ name: 'Test' })
expect(result).toBeDefined()
```

See [Unit Testing](/guides/testing/unit-tests) for patterns.

### Integration Tests

Test components working together in the Workers runtime with real bindings.

```typescript
import { env, SELF } from 'cloudflare:test'

const response = await SELF.fetch('/api/startup')
expect(response.ok).toBe(true)
```

See [Integration Testing](/guides/testing/integration-tests) for patterns.

### Agent Tests

Test agent interactions with mocked providers and deterministic responses.

```typescript
const provider = createMockProvider({
  responses: [mockResponses.text('Hello')]
})
const agent = provider.createAgent(fixtures.minimalAgent)
const result = await agent.run({ prompt: 'Hi' })
```

See [Agent Testing](/guides/testing/agent-tests) for patterns.

## Running Tests

```bash
# All tests in watch mode
npm test

# Single run
npm run test:run

# Specific file
npx vitest run path/to/test.ts

# Specific project
npx vitest --project=workers

# With coverage
npx vitest --coverage
```

## Test Organization

Follow these conventions:

| Pattern | Location |
|---------|----------|
| `*.test.ts` | Colocated with source |
| `tests/` directories | Grouped by domain |
| `__tests__/` | Legacy pattern (avoid) |

Example structure:

```
objects/
  Startup.ts
  tests/
    Startup.test.ts           # Unit tests
    startup-integration.test.ts
agents/
  Agent.ts
  Agent.test.ts               # Colocated
  testing.test.ts             # Test utilities
```

## Next Steps

- [Unit Testing DOs](/guides/testing/unit-tests) - Mock infrastructure patterns
- [Integration Testing](/guides/testing/integration-tests) - Workers runtime tests
- [Agent Testing](/guides/testing/agent-tests) - Mock providers and fixtures
