---
title: Durable Objects
description: The DO class hierarchy - persistent, stateful actors that form the foundation of dotdo.
---

import { Callout } from 'fumadocs-ui/components/callout'
import { Cards, Card } from 'fumadocs-ui/components/card'

# Durable Objects

Durable Objects (DOs) are the core building blocks of dotdo. They're persistent, stateful actors that run on Cloudflare's edge network with automatic global distribution, zero cold starts, and built-in storage.

<Callout type="info">
Every entity in dotdo - Businesses, Agents, Humans, Apps - is a Durable Object with its own identity, state, and behavior.
</Callout>

## Class Hierarchy

The DO class hierarchy is designed for tree-shaking and bundle size optimization:

```
DOTiny (~15KB)        - Identity, db, fetch, toJSON
   |
   v
DOBase (~80KB)        - + WorkflowContext, stores, events, scheduling
   |
   v
DOFull (~120KB)       - + Lifecycle, sharding, branching, promotion
```

From `DOFull`, several specialized classes extend the hierarchy:

```
                              DO (DOFull)
                                  |
          +-----------+-----------+-----------+-----------+
          |           |           |           |           |
       Business      App        Site       Worker      Entity
          |                                   |           |
       Startup                         +------+------+    |
                                       |             |    |
                                     Agent        Human   +-- Collection
                                                          +-- Directory
```

## Import Paths

Choose the import path based on your bundle size requirements:

```typescript
// Minimal (~15KB) - Identity and basic fetch only
import { DO } from 'dotdo/tiny'

// Base (~80KB) - WorkflowContext, stores, events
import { DO } from 'dotdo/base'

// Full (~120KB) - All lifecycle operations
import { DO } from 'dotdo/full'

// Default - Full + fs/git/bash mixins
import { DO } from 'dotdo'
```

## Core Classes

| Class | Purpose | Key Features |
|-------|---------|--------------|
| [DO](/docs/objects/do) | Base class | Identity, storage, WorkflowContext (`$`) |
| [Worker](/docs/objects/worker) | Work performer | Tasks, decisions, approvals |
| [Agent](/docs/objects/agent) | AI worker | Tools, memory, autonomous execution |
| [Human](/docs/objects/human) | Human worker | Notifications, escalation, approval queues |
| [Entity](/docs/objects/entity) | Domain object | Schema, CRUD, indexed queries |
| [Business](/docs/objects/business) | Organization | Apps, members, configuration |
| [Startup](/docs/objects/startup) | Business container | Agents, services, HUNCH metrics |

## Quick Example

```typescript
import { DO } from 'dotdo'

class CustomerService extends DO {
  async onStart() {
    // Register event handlers
    this.$.on.Customer.signup(async (event) => {
      await this.$.do('send-welcome-email', event.data)
    })

    // Schedule recurring tasks
    this.$.every.day.at9am(async () => {
      await this.$.do('generate-daily-report', {})
    })
  }

  // Custom methods become RPC endpoints
  async getCustomer(id: string) {
    return this.things.get(id)
  }
}
```

## The WorkflowContext (`$`)

Every DO has a `$` property (WorkflowContext) that provides:

- **Execution modes**: `$.send()`, `$.try()`, `$.do()`
- **Event subscriptions**: `$.on.Noun.verb(handler)`
- **Scheduling**: `$.every.hour()`, `$.every.Monday.at9am`
- **AI functions**: `$.ai()`, `$.write()`, `$.summarize()`
- **Domain resolution**: `$.Customer('123').notify()`

```typescript
// Fire-and-forget (non-blocking)
this.$.send('notification.sent', { userId: '123' })

// Quick attempt (blocking, no retries)
const result = await this.$.try('validate-input', data)

// Durable execution (blocking, with retries)
const order = await this.$.do('process-order', orderData)
```

## Storage

Every DO has access to seven built-in stores:

| Store | Purpose |
|-------|---------|
| `this.things` | Domain entities (Things) |
| `this.rels` | Relationships between Things |
| `this.actions` | Action log with lifecycle tracking |
| `this.events` | Event emission and streaming |
| `this.search` | Full-text and semantic search |
| `this.objects` | DO registry and resolution |
| `this.dlq` | Dead Letter Queue for failed events |

## Type Discrimination

Every DO class has a `$type` property for runtime type checking:

```typescript
class Customer extends Entity {
  static override readonly $type = 'Customer'
}

// Runtime type checks
customer.$type           // 'Customer'
customer.isType('Customer')        // true
customer.extendsType('Entity')     // true
customer.getTypeHierarchy()        // ['Customer', 'Entity', 'DO']
```

## Next Steps

<Cards>
  <Card title="DO Base Class" href="/docs/objects/do">
    Deep dive into the core DO functionality - identity, storage, and WorkflowContext.
  </Card>
  <Card title="Worker Class" href="/docs/objects/worker">
    Building AI and Human workers with tasks, decisions, and approvals.
  </Card>
  <Card title="Agent Class" href="/docs/objects/agent">
    AI workers with tools, memory, and autonomous execution.
  </Card>
  <Card title="Entity Class" href="/docs/objects/entity">
    Domain modeling with schemas, CRUD, and indexed queries.
  </Card>
  <Card title="Lifecycle" href="/docs/objects/lifecycle">
    DO lifecycle management - creation, persistence, and destruction.
  </Card>
  <Card title="Transport" href="/docs/objects/transport">
    DO transport layer - REST, RPC, and WebSocket protocols.
  </Card>
</Cards>

## Related

<Cards>
  <Card title="Workflows" href="/docs/workflows">
    Durable workflow orchestration with the $ context DSL.
  </Card>
  <Card title="Architecture" href="/docs/architecture">
    Technical deep dive into V8 isolates and DO internals.
  </Card>
  <Card title="Human Workers" href="/docs/humans">
    Human-in-the-loop escalation and approval workflows.
  </Card>
  <Card title="Storage" href="/docs/storage">
    Tiered storage architecture from DO SQLite to R2 and Iceberg.
  </Card>
</Cards>
