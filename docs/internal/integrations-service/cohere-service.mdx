---
title: cohere.do
description: Cohere on the Edge — A managed AI service with built-in key management, usage analytics, and global edge deployment.
---

# cohere.do

**Cohere on the Edge** — A managed Cohere-compatible service that runs on Cloudflare Workers, with built-in API key management, usage analytics, rate limiting, and multi-tenant billing.

```typescript
import { CohereClient } from 'cohere.do'

const cohere = new CohereClient('https://your-cohere.workers.dev')

// It's just Cohere
const response = await cohere.generate({
  prompt: 'Write a tagline for an ice cream shop',
  model: 'command',
  maxTokens: 50,
})

console.log(response.generations[0].text)
```

<Callout type="info">
Looking for a local development solution? See [@dotdo/cohere](/docs/integrations/cohere/package) for an edge-compatible SDK you can use with your own API key.
</Callout>

## Why cohere.do?

Traditional AI API integrations require managing API keys, handling rate limits, and building usage tracking from scratch. cohere.do eliminates all of that:

- **Zero Key Management** — API keys stored securely in Workers secrets with automatic rotation
- **Global Edge Proxy** — Requests routed from nearest edge location for lowest latency
- **Built-in Analytics** — Usage dashboards, cost tracking, and per-tenant billing
- **Rate Limit Handling** — Automatic retries, backoff, and queue management
- **Multi-tenant Ready** — Isolate usage by tenant, team, or user
- **Agent Integration** — Native support for dotdo named agents and workflows

## Features

### AI Capabilities

| Feature | Description |
|---------|-------------|
| **Text Generation** | `generate()`, `generateStream()` with Command models |
| **Chat (v2 API)** | `chat()`, `chatStream()` with conversation memory |
| **Embeddings** | `embed()` with multiple formats and dimensions |
| **Reranking** | `rerank()` for document relevance scoring |
| **Classification** | `classify()` with few-shot learning |
| **Function Calling** | Tool use for structured data extraction |

### Platform Features

| Feature | Description |
|---------|-------------|
| **Key Management** | Secure storage, rotation, and per-environment keys |
| **Usage Analytics** | Request counts, token usage, latency metrics |
| **Cost Tracking** | Per-tenant, per-model cost attribution |
| **Rate Limiting** | Configurable limits with automatic queuing |
| **Caching** | Response caching for repeated requests |
| **Audit Logs** | Full request/response logging for compliance |

## Installation

```bash
npm install cohere.do
```

## Quick Start

### Deploy to Cloudflare Workers

```typescript
// src/index.ts
import { CohereEntrypoint, CohereService } from 'cohere.do'

export { CohereService }
export default CohereEntrypoint
```

```jsonc
// wrangler.jsonc
{
  "name": "my-cohere-do",
  "main": "src/index.ts",
  "compatibility_date": "2025-01-01",
  "compatibility_flags": ["nodejs_compat"],
  "durable_objects": {
    "bindings": [{ "name": "COHERE_SERVICE", "class_name": "CohereService" }]
  },
  "migrations": [{ "tag": "v1", "new_sqlite_classes": ["CohereService"] }],
  "vars": {
    "COHERE_API_KEY": "your-cohere-api-key"
  }
}
```

```bash
# Store API key securely
npx wrangler secret put COHERE_API_KEY

# Deploy
npx wrangler deploy
```

### Use the Service

```typescript
import { CohereClient } from 'cohere.do'

const cohere = new CohereClient('https://my-cohere-do.workers.dev')

// Generate text
const response = await cohere.generate({
  prompt: 'Explain machine learning in simple terms',
  model: 'command',
  maxTokens: 200,
})

// Chat conversation
const chat = await cohere.chat({
  message: 'What are the benefits of serverless computing?',
  model: 'command-r',
})

// Generate embeddings
const embeddings = await cohere.embed({
  texts: ['Hello world', 'Goodbye world'],
  model: 'embed-english-v3.0',
  inputType: 'search_document',
})
```

## Examples

### Streaming Generation

```typescript
const stream = await cohere.generateStream({
  prompt: 'Write a short story about a robot learning to paint',
  model: 'command',
  maxTokens: 500,
})

for await (const event of stream) {
  if (!event.is_finished && event.text) {
    process.stdout.write(event.text)
  }
}
```

### Multi-turn Chat with Streaming

```typescript
const stream = await cohere.chatStream({
  message: 'Explain quantum computing',
  model: 'command-r',
  chatHistory: [
    { role: 'USER', message: 'What topics can you help me with?' },
    { role: 'CHATBOT', message: 'I can help with science, technology, math, and more!' },
  ],
})

for await (const event of stream) {
  if (event.type === 'content-delta' && event.delta?.message?.content?.text) {
    process.stdout.write(event.delta.message.content.text)
  }
}
```

### Semantic Search with Embeddings

```typescript
// Index documents
const docs = [
  'Serverless computing eliminates server management',
  'Edge functions run close to users',
  'Durable Objects provide strong consistency',
]

const docEmbeddings = await cohere.embed({
  texts: docs,
  model: 'embed-english-v3.0',
  inputType: 'search_document',
})

// Search query
const queryEmbedding = await cohere.embed({
  texts: ['How do I deploy without managing servers?'],
  model: 'embed-english-v3.0',
  inputType: 'search_query',
})

// Calculate similarity and rank results
const results = rankBySimilarity(queryEmbedding, docEmbeddings, docs)
```

### RAG with Reranking

```typescript
// Initial retrieval (e.g., from vector search)
const candidates = await vectorSearch(query, limit: 20)

// Rerank for relevance
const reranked = await cohere.rerank({
  query: 'What is the capital of France?',
  documents: candidates.map(c => c.text),
  model: 'rerank-english-v2.0',
  topN: 5,
})

// Use top results for generation
const topDocs = reranked.results.map(r => candidates[r.index].text)
const answer = await cohere.chat({
  message: query,
  model: 'command-r',
  preamble: `Use these documents to answer: ${topDocs.join('\n')}`,
})
```

### Function Calling for Structured Extraction

```typescript
const response = await cohere.chat({
  message: 'Schedule a meeting with Alice tomorrow at 3pm to discuss the Q4 roadmap',
  model: 'command-r',
  tools: [{
    type: 'function',
    function: {
      name: 'schedule_meeting',
      description: 'Schedule a calendar meeting',
      parameters: {
        type: 'object',
        properties: {
          attendees: {
            type: 'array',
            items: { type: 'string' },
            description: 'List of attendee names',
          },
          datetime: {
            type: 'string',
            description: 'Meeting date and time in ISO format',
          },
          topic: {
            type: 'string',
            description: 'Meeting topic or agenda',
          },
        },
        required: ['attendees', 'datetime', 'topic'],
      },
    },
  }],
})

if (response.message.tool_calls) {
  const call = response.message.tool_calls[0]
  const meeting = JSON.parse(call.function.arguments)
  // { attendees: ['Alice'], datetime: '2025-01-13T15:00:00', topic: 'Q4 roadmap' }
  await calendar.createEvent(meeting)
}
```

### Few-shot Classification

```typescript
const classified = await cohere.classify({
  inputs: [
    'I need help with my order',
    'Your product is amazing!',
    'How do I reset my password?',
    'This is the worst service ever',
  ],
  examples: [
    { text: 'Where is my package?', label: 'support' },
    { text: 'How do I return an item?', label: 'support' },
    { text: 'Great product, love it!', label: 'feedback' },
    { text: 'Terrible experience', label: 'feedback' },
    { text: 'How do I change my email?', label: 'account' },
    { text: 'I forgot my login', label: 'account' },
  ],
})

for (const result of classified.classifications) {
  console.log(`${result.input}: ${result.prediction}`)
  // Route to appropriate handler
  await routeToTeam(result.input, result.prediction)
}
```

## Multi-tenant Configuration

### Per-tenant API Keys

```typescript
// Configure tenant-specific keys
export default {
  async fetch(request: Request, env: Env) {
    const tenantId = getTenantFromRequest(request)
    const apiKey = await env.KV.get(`cohere:${tenantId}:key`)

    const cohere = new CohereClient({
      endpoint: env.COHERE_SERVICE,
      apiKey,
      tenant: tenantId,
    })

    // Usage tracked per tenant
    const response = await cohere.generate({ ... })
    return Response.json(response)
  }
}
```

### Usage Limits and Billing

```typescript
// Set per-tenant limits
await cohere.admin.setLimits(tenantId, {
  requestsPerDay: 10000,
  tokensPerDay: 1000000,
  models: ['command', 'embed-english-v3.0'],
})

// Get usage stats
const usage = await cohere.admin.getUsage(tenantId, {
  start: startOfMonth,
  end: now,
})

console.log(usage)
// {
//   requests: 4523,
//   tokens: { input: 125000, output: 89000 },
//   cost: 12.34,
//   byModel: { 'command': { requests: 3000, ... }, ... }
// }
```

## Integration with Named Agents

cohere.do integrates natively with dotdo's named agents:

```typescript
import { priya, ralph, tom } from 'agents.do'

// Configure agents to use Cohere models
const config = {
  provider: 'cohere.do',
  endpoint: 'https://your-cohere.workers.dev',
  models: {
    generation: 'command-r-plus',
    embedding: 'embed-english-v3.0',
  },
}

// Agents automatically use your cohere.do instance
const spec = await priya`define the MVP for ${hypothesis}`
let app = await ralph`build ${spec}`

do {
  app = await ralph`improve ${app} per ${tom}`
} while (!await tom.approve(app))
```

## Architecture

```
┌─────────────────────────────────────────────────────────────────────────┐
│                           Client Applications                           │
├─────────────────┬─────────────────┬─────────────────┬───────────────────┤
│   HTTP/JSON     │   Streaming     │   WebSocket     │  Service Binding  │
│   REST API      │   SSE/Fetch     │   Real-time     │  Worker-to-Worker │
├─────────────────┴─────────────────┴─────────────────┴───────────────────┤
│                       cohere.do Worker (Edge)                           │
├─────────────────────────────────────────────────────────────────────────┤
│  Request Router │  Rate Limiter  │  Cache Layer   │  Usage Tracker     │
├─────────────────────────────────────────────────────────────────────────┤
│                      Durable Objects (State & Analytics)                │
├─────────────────────────────────────────────────────────────────────────┤
│                           Cohere API (Upstream)                         │
└─────────────────────────────────────────────────────────────────────────┘
```

cohere.do acts as an intelligent edge proxy:

1. **Request Routing** — Route to appropriate Cohere endpoint based on method
2. **Rate Limiting** — Per-tenant limits with automatic queuing and backoff
3. **Caching** — Cache identical requests to reduce API calls
4. **Usage Tracking** — Log all requests for billing and analytics
5. **Key Management** — Securely inject API keys from Workers secrets

## Configuration

### Basic Setup

```jsonc
{
  "vars": {
    "COHERE_API_KEY": "your-key"
  }
}
```

### With Caching

```jsonc
{
  "vars": {
    "COHERE_API_KEY": "your-key",
    "CACHE_ENABLED": "true",
    "CACHE_TTL": "3600"
  },
  "kv_namespaces": [
    { "binding": "CACHE", "id": "your-kv-id" }
  ]
}
```

### With Analytics

```jsonc
{
  "vars": {
    "COHERE_API_KEY": "your-key",
    "ANALYTICS_ENABLED": "true"
  },
  "analytics_engine_datasets": [
    { "binding": "ANALYTICS", "dataset": "cohere_usage" }
  ]
}
```

## Monitoring and Observability

### Built-in Metrics

```typescript
// Get service health
const health = await cohere.admin.health()
// {
//   status: 'healthy',
//   latency: { p50: 120, p95: 450, p99: 890 },
//   uptime: 99.99,
//   requestsToday: 45230
// }

// Get error rates
const errors = await cohere.admin.errors({ period: '24h' })
// {
//   total: 23,
//   byType: { 'rate_limit': 15, 'timeout': 5, 'server_error': 3 }
// }
```

### Integration with Observability Stack

```typescript
// Export metrics to your observability platform
export default {
  async scheduled(event: ScheduledEvent, env: Env) {
    const metrics = await cohere.admin.exportMetrics()
    await env.METRICS_QUEUE.send(metrics)
  }
}
```

## Development

```bash
# Local development with remote Cohere API
npx wrangler dev

# Run tests
npm test

# Deploy to production
npx wrangler deploy
```

## Related

- [@dotdo/cohere](/docs/integrations/cohere/package) - OSS SDK for development
- [Anthropic Integration](/docs/integrations/anthropic) - Claude API
- [OpenAI Integration](/docs/integrations/openai) - GPT models
- [Named Agents](/docs/agents/named-agents) - Priya, Ralph, Tom, Mark, Sally, Quinn
- [Durable Objects](/docs/architecture/durable-objects) - DO-backed storage
