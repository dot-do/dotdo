---
title: Segment
description: Choose between @dotdo/segment (OSS package) and segment.do (managed edge service) for your analytics needs.
---

# Segment Integration

dotdo provides two ways to work with Segment-compatible analytics APIs:

| | @dotdo/segment | segment.do |
|---|----------------|------------|
| **Type** | OSS npm package | Managed edge service |
| **Backend** | In-memory or real Segment | Durable Object SQLite |
| **Persistence** | Depends on mode | Full durability |
| **Use case** | Testing, Segment proxy | Production analytics |
| **Infrastructure** | Your Segment or none | Zero (we manage it) |
| **Install** | `npm install @dotdo/segment` | Deploy to Cloudflare |

## Quick Comparison

```typescript
// @dotdo/segment - Analytics SDK compatible, great for tests
import { Analytics, InMemoryTransport } from '@dotdo/segment'

const transport = new InMemoryTransport()
const analytics = new Analytics({
  writeKey: 'test-key',
  transport: () => transport,
})

analytics.track({
  userId: 'user123',
  event: 'Order Completed',
  properties: { total: 99.99 },
})

// Inspect events in tests
const events = transport.getEvents()
```

```typescript
// segment.do - Native edge analytics
import { Analytics } from 'segment.do'

const analytics = new Analytics(env)

await analytics.track({
  userId: 'user123',
  event: 'Order Completed',
  properties: { total: 99.99 },
})
// Data persists globally at the edge
```

## When to Use Each

### Use @dotdo/segment when:

- **Migrating from Segment SDK** - Drop-in replacement with same API
- **Unit testing** - Local mode with InMemoryTransport for tests without network
- **Proxy to real Segment** - Connect to Segment's API in production
- **Gradual migration** - Keep using real Segment while moving to edge

<Callout type="info">
@dotdo/segment is a Segment Analytics SDK-compatible library. Use it when you need the familiar Segment API or want to connect to real Segment infrastructure.
</Callout>

### Use segment.do when:

- **Edge-native analytics** - Built for Cloudflare Workers from the ground up
- **Zero infrastructure** - No Segment account needed
- **Self-hosted analytics** - Keep your data in your infrastructure
- **Predictable pricing** - No per-event or MTU fees
- **Real-time processing** - Process events at the edge with destinations

<Callout type="info">
segment.do is Segment-compatible analytics built natively on Cloudflare. Use it for production edge workloads without per-event pricing.
</Callout>

## Feature Comparison

| Feature | @dotdo/segment | segment.do |
|---------|----------------|------------|
| Tracking Methods | identify, track, page, screen, group, alias | identify, track, page, screen, group, alias |
| Batch API | batch(), flush() | batch(), flush() |
| Custom Destinations | Console, Webhook, Buffer, Callback | Built-in + Custom |
| Source Middleware | Event enrichment/filtering | Event enrichment/filtering |
| Destination Middleware | Per-destination transforms | Per-destination transforms |
| Plugin System | Before, enrichment, destination, after | Full plugin support |
| Real Segment Backend | Forwards to api.segment.io | Self-contained |
| InMemory Testing | InMemoryTransport, BufferDestination | N/A (use @dotdo/segment) |
| Primitives Integration | KeyedRouter, WindowManager, TemporalStore | Built-in |
| Durable Storage | No | Durable Object SQLite |

## Getting Started

<div className="grid grid-cols-1 md:grid-cols-2 gap-4 mt-6">
  <a href="/docs/integrations/segment/package" className="block p-4 border rounded-lg hover:border-primary">
    <h3 className="font-semibold">@dotdo/segment</h3>
    <p className="text-sm text-muted-foreground">Segment SDK compatible analytics for migration and testing</p>
  </a>
  <a href="/docs/integrations/segment/service" className="block p-4 border rounded-lg hover:border-primary">
    <h3 className="font-semibold">segment.do</h3>
    <p className="text-sm text-muted-foreground">Managed Segment-compatible analytics on the edge</p>
  </a>
</div>

## Migration Path

Start with `@dotdo/segment` pointing to real Segment, then migrate to `segment.do`:

```typescript
// Phase 1: Use @dotdo/segment with real Segment (drop-in for @segment/analytics-node)
import { Analytics } from '@dotdo/segment'

const analytics = new Analytics({
  writeKey: env.SEGMENT_WRITE_KEY,
  host: 'https://api.segment.io',
})

analytics.track({
  userId: 'user123',
  event: 'Order Completed',
  properties: { total: 99.99 },
})

await analytics.flush()
```

```typescript
// Phase 2: Migrate to segment.do for zero-infrastructure
import { Analytics } from 'segment.do'

const analytics = new Analytics(env)

await analytics.track({
  userId: 'user123',
  event: 'Order Completed',
  properties: { total: 99.99 },
})
// No flush needed - events are durably stored
```

## Architecture Comparison

### @dotdo/segment

```
                    Your Application
                           |
            +--------------+--------------+
            |                             |
            v                             v
+-----------------------+     +-----------------------+
|   Local Mode          |     | Production            |
|   (InMemoryTransport) |     | (FetchTransport)      |
+-----------------------+     +-----------------------+
            |                             |
            v                             v
+-----------------------+     +-----------------------+
|  In-memory storage    |     |  api.segment.io       |
|  Event inspection     |     |  Real event delivery  |
|  Testing utilities    |     |  Segment destinations |
+-----------------------+     +-----------------------+
```

### segment.do

```
+-----------------------------------------+
|            Your Application              |
|                                         |
|  import { Analytics } from 'segment.do' |
+-----------------------------------------+
                    |
                    v
+-----------------------------------------+
|           segment.do Worker             |
+-----------------------------------------+
|  Event Router  |  Destination Engine    |
+-----------------------------------------+
|        Durable Object SQLite            |
+-----------------------------------------+
```

Both approaches support the same analytics patterns (user identification, event tracking, destinations) - choose based on whether you need real Segment compatibility or native edge deployment.
