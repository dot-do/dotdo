---
title: Compliance
description: GDPR, SOC 2, HIPAA, PCI-DSS, and regulatory compliance for autonomous businesses
---

import { Callout } from 'fumadocs-ui/components/callout'

# Compliance

Meet regulatory requirements by default. When AI agents process customer data, compliance teams have questions. dotdo provides the infrastructure to answer them with confidence.

## Overview

Autonomous businesses face unique compliance challenges. AI agents make decisions, process data, and interact with customers - all requiring clear audit trails and regulatory adherence. dotdo builds compliance into the foundation, not as an afterthought.

<Callout type="info" title="Built-in Compliance">
Every action in dotdo is automatically logged with actor identity, timestamps, and full context. You get audit trails without writing a single line of logging code.
</Callout>

## GDPR Compliance

The General Data Protection Regulation governs data protection for EU citizens. dotdo provides primitives for all data subject rights.

### Data Subject Rights

#### Right to Access (Article 15)

Export all user data on request:

```typescript
$.on.GDPR.accessRequest(async ($, { userId }) => {
  const data = await $.data.export(userId, {
    include: ['customers', 'orders', 'preferences', 'audit_logs'],
    format: 'json',
  })

  await $.email.send({
    to: user.email,
    subject: 'Your Data Export',
    attachments: [{ name: 'data-export.json', content: data }],
  })

  await $.audit.log('gdpr.access_request', { userId, status: 'completed' })
})
```

#### Right to Erasure (Article 17)

Delete personal data while retaining necessary records:

```typescript
$.on.GDPR.deletionRequest(async ($, { userId }) => {
  // Verify identity first
  const verified = await $.identity.verify(userId, {
    method: 'email-confirmation',
  })

  if (!verified) {
    return $.escalate.to('privacy-team', {
      reason: 'Identity verification failed',
      userId,
    })
  }

  // Delete personal data
  await $.data.delete(userId, {
    tables: ['customers', 'orders', 'preferences'],
    cascadeRelations: true,
  })

  // Anonymize data we must retain (e.g., financial records)
  await $.data.anonymize(userId, {
    tables: ['transactions', 'invoices'],
    retain: ['amount', 'date', 'currency'], // Non-PII fields
  })

  await $.audit.log('gdpr.deletion_request', {
    userId,
    status: 'completed',
    timestamp: new Date().toISOString(),
  })
})
```

#### Right to Portability (Article 20)

Provide data in machine-readable format:

```typescript
$.on.GDPR.portabilityRequest(async ($, { userId, format }) => {
  const data = await $.data.export(userId, {
    format: format || 'json',
    machineReadable: true,
  })

  const downloadUrl = await $.storage.createSignedUrl(data, {
    expiresIn: '7d',
  })

  await $.email.send({
    to: user.email,
    subject: 'Your Data Export is Ready',
    body: `Download your data: ${downloadUrl}`,
  })
})
```

### Consent Management

Track and manage consent with full audit trails:

```typescript
// Record consent
await $.consent.record({
  userId,
  purpose: 'marketing-emails',
  granted: true,
  timestamp: new Date().toISOString(),
  source: 'signup-form',
  version: 'privacy-policy-v2.1',
})

// Check consent before processing
const hasConsent = await $.consent.check(userId, 'marketing-emails')
if (!hasConsent) return // Don't process without consent

// Handle consent withdrawal
$.on.User.consentWithdrawn(async ($, { userId, purpose }) => {
  await $.consent.revoke(userId, purpose)
  await $.audit.log('consent.revoked', { userId, purpose })
})
```

### Lawful Basis Documentation

Document legal basis for all data processing:

```typescript
await $.data.setProcessingBasis({
  dataType: 'customer-email',
  basis: 'contract', // consent, contract, legal-obligation, vital-interests, public-task, legitimate-interests
  description: 'Required for order fulfillment',
})

await $.data.setProcessingBasis({
  dataType: 'marketing-preferences',
  basis: 'consent',
  description: 'Email marketing opted in by user',
})
```

### Breach Notification

GDPR requires notification within 72 hours of discovering a breach:

```typescript
$.on.Security.breach(async ($, breach) => {
  const impact = await $.security.assessImpact(breach)

  if (impact.affectedUsers > 0 && impact.piiExposed) {
    // Schedule DPA notification
    await $.compliance.scheduleNotification({
      type: 'breach',
      deadline: '72h',
      authority: 'dpa',
      affectedUsers: impact.affectedUsers,
      dataTypes: impact.exposedDataTypes,
    })

    // Notify affected users
    await $.email.sendBatch({
      template: 'security-breach-notification',
      recipients: impact.affectedUserEmails,
      data: {
        incidentDate: breach.timestamp,
        dataAffected: impact.exposedDataTypes,
        actionsTaken: breach.containment,
        nextSteps: breach.remediation,
      },
    })
  }

  await $.audit.log('security.breach', {
    breach,
    impact,
    notifications: impact.notifications,
  })
})
```

## Data Residency

Control where data is stored and processed to meet regional requirements.

### Region Configuration

```typescript
$.configure({
  dataResidency: {
    default: 'eu-west-1',
    customers: {
      eu: 'eu-west-1',
      us: 'us-east-1',
      apac: 'ap-southeast-1',
    },
  },
})

// Store data in correct region based on user
await $.storage.put('customer-data', data, {
  region: customer.region,
})
```

### Per-User Residency

Respect individual data residency preferences:

```typescript
$.on.Customer.created(async ($, customer) => {
  const region = determineRegion(customer.country)

  await $.db.customers.create({
    ...customer,
    dataRegion: region,
  })

  await $.audit.log('customer.created', {
    customerId: customer.id,
    dataRegion: region,
  })
})

function determineRegion(country: string): string {
  const euCountries = ['DE', 'FR', 'IT', 'ES', 'NL', 'BE', 'AT', 'PL', 'SE', 'DK', 'FI', 'IE', 'PT', 'GR', 'CZ', 'HU', 'RO', 'BG', 'HR', 'SK', 'SI', 'LT', 'LV', 'EE', 'CY', 'MT', 'LU']
  if (euCountries.includes(country)) return 'eu-west-1'
  if (country === 'US' || country === 'CA') return 'us-east-1'
  return 'ap-southeast-1'
}
```

### Cross-Border Data Transfers

Document and control international data transfers:

```typescript
await $.data.transfer({
  from: 'eu-west-1',
  to: 'us-east-1',
  data: analyticsData,
  mechanism: 'standard-contractual-clauses',
  purpose: 'Analytics processing',
})

// Block unauthorized transfers
$.on.Data.transferAttempt(async ($, { from, to, data }) => {
  const allowed = await $.compliance.checkTransfer(from, to)

  if (!allowed) {
    throw new ComplianceError('Cross-border transfer not permitted')
  }
})
```

### Edge Processing

Process data locally to avoid transfers:

```typescript
export default {
  async fetch(request, env, ctx) {
    const region = request.cf?.country

    // Route to regional handler
    if (isEU(region)) {
      return handleInRegion(request, 'eu')
    }

    return handleInRegion(request, 'us')
  },
}

async function handleInRegion(request, region) {
  // Data processed entirely within region
  const result = await processLocally(request)
  return new Response(result)
}
```

## SOC 2 Compliance

SOC 2 covers five trust service criteria. dotdo provides controls for each.

### Trust Service Criteria

```typescript
// Security - Access controls
$.authorize({
  'Customer.read': ['support', 'admin'],
  'Customer.write': ['admin'],
  'System.configure': ['admin'],
})

// Availability - Health monitoring
$.on.System.healthCheck(async ($) => {
  const status = await $.health.check([
    'database',
    'cache',
    'external-apis',
  ])

  if (!status.healthy) {
    await $.alert.ops('System health degraded', status)
  }
})

// Processing Integrity - Data validation
$.on.Order.created(async ($, order) => {
  const valid = await $.validate(order, OrderSchema)
  if (!valid) {
    throw new ProcessingError('Invalid order data')
  }
})

// Confidentiality - Encryption
const encrypted = await $.crypto.encrypt(sensitiveData)
await $.storage.put('confidential', encrypted)

// Privacy - Data minimization
const customer = await $.db.customers.get(id, {
  select: ['name', 'email'], // Only fetch needed fields
})
```

### Continuous Monitoring

```typescript
$.on.Audit.event(async ($, event) => {
  const violations = await $.compliance.check(event, {
    frameworks: ['soc2', 'gdpr'],
  })

  if (violations.length > 0) {
    await $.alert.compliance('Compliance violation detected', {
      event,
      violations,
      severity: 'high',
    })
  }
})
```

### Evidence Collection

Automate audit evidence collection:

```typescript
await $.compliance.collectEvidence({
  framework: 'soc2',
  period: { start: '2024-01-01', end: '2024-03-31' },
  controls: [
    'access-control',
    'change-management',
    'incident-response',
    'data-encryption',
  ],
})

const report = await $.compliance.generateReport({
  framework: 'soc2',
  type: 'type-2',
  period: 'Q1-2024',
})
```

## HIPAA Compliance

For healthcare data, dotdo supports HIPAA requirements.

### PHI Protection

```typescript
$.configure({
  hipaa: {
    enabled: true,
    phi: {
      encryption: 'AES-256',
      accessLogging: 'mandatory',
      minimumNecessary: true,
    },
  },
})

// PHI access is always logged
const patient = await $.db.patients.get(patientId)
// Automatic audit: "PHI accessed by user_123 for patient_456"
```

### Access Controls

```typescript
// Role-based PHI access
$.authorize.hipaa({
  'Patient.demographics': ['nurse', 'doctor', 'admin'],
  'Patient.diagnosis': ['doctor', 'specialist'],
  'Patient.billing': ['billing-staff', 'admin'],
})

// Minimum necessary principle
const patientRecord = await $.db.patients.get(patientId, {
  role: $.user.role, // Only returns fields user can access
})
```

### Business Associate Agreements

Track BAAs with third parties:

```typescript
await $.compliance.registerBAA({
  vendor: 'Cloud Storage Provider',
  effectiveDate: '2024-01-01',
  services: ['data-storage', 'backup'],
  review: 'annual',
})
```

## PCI-DSS Compliance

Secure payment card data handling.

### Card Data Handling

```typescript
$.configure({
  pci: {
    enabled: true,
    cardholderData: {
      storage: 'tokenized',
      transmission: 'encrypted',
      display: 'masked',
    },
  },
})

// Tokenize card data - never store raw numbers
const token = await $.pci.tokenize(cardNumber)
await $.db.payments.create({
  cardToken: token,
  amount: 1000,
})
```

### Scope Reduction

```typescript
// Use iframe for card entry to reduce PCI scope
$.configure({
  payments: {
    cardEntry: 'hosted-fields', // Card data never touches your servers
    provider: 'stripe',
  },
})
```

## Data Classification

Classify data by sensitivity and apply appropriate controls:

```typescript
await $.data.classify({
  'customer.email': 'pii',
  'customer.name': 'pii',
  'customer.ssn': 'sensitive-pii',
  'order.total': 'business-confidential',
  'product.name': 'public',
})

// Apply controls based on classification
$.on.Data.access(async ($, { field, classification }) => {
  if (classification === 'sensitive-pii') {
    await $.auth.requireMFA()
  }
})
```

## Compliance Reporting

### Multi-Framework Status

```typescript
const status = await $.compliance.status({
  frameworks: ['gdpr', 'soc2', 'hipaa', 'pci-dss'],
})

// {
//   gdpr: { compliant: true, lastAudit: '2024-01-15' },
//   soc2: { compliant: true, lastAudit: '2024-01-10' },
//   hipaa: { compliant: false, issues: ['encryption-gap'] },
//   pci_dss: { compliant: true, lastAudit: '2024-01-12' }
// }
```

### Scheduled Reviews

```typescript
$.every.quarter(async ($) => {
  const report = await $.compliance.audit({
    frameworks: ['gdpr', 'soc2'],
    scope: ['access-controls', 'data-handling', 'encryption'],
  })

  await $.email.send({
    to: 'compliance@company.com',
    subject: 'Quarterly Compliance Report',
    attachments: [report],
  })
})
```

## Best Practices

### Privacy by Design

```typescript
// Collect only what you need
await $.db.customers.create({
  email: customer.email,
  name: customer.name,
  // Don't collect: SSN, DOB, etc. unless required
})

// Pseudonymize when possible
const analyticsData = {
  visitorId: hash(userId), // Not real user ID
  pageViews: 5,
  country: 'US', // Region, not exact location
}
```

### Regular Reviews

- Quarterly compliance audits
- Annual policy reviews
- Continuous violation monitoring
- Third-party vendor assessments

### Documentation

- Maintain data processing records
- Document consent collection
- Keep BAAs current
- Track policy versions

## Related Documentation

- [Security Hardening](/docs/platform/security) - Production security configuration
- [Audit Logging](/docs/platform/audit-logging) - Comprehensive audit trail
- [Encryption](/docs/security/encryption) - Data protection mechanisms
- [Vault](/docs/security/vault) - Secure secret storage
- [Authorization](/docs/security/authorization) - Access control
