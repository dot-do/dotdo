---
title: Channel Adapters
description: Multi-channel notification adapters for human-in-the-loop workflows
---

# Channel Adapters

Channel adapters provide a unified interface for sending notifications and receiving responses across multiple platforms. Each channel supports the core send/receive pattern while offering platform-specific features.

## Available Channels

| Channel | Class | Features |
|---------|-------|----------|
| Slack | `SlackBlockKitChannel` | BlockKit blocks, interactive buttons, forms |
| Discord | `DiscordChannel` | Embeds, action buttons, reaction responses |
| Email | `EmailChannel` | HTML templates, SendGrid/Resend providers |
| MDXUI Chat | `MDXUIChatChannel` | Real-time, forms, MDX content, typing indicators |

## Quick Start

```typescript
import {
  SlackBlockKitChannel,
  DiscordChannel,
  EmailChannel,
  createChannel
} from 'lib/channels'

// Create channels directly
const slack = new SlackBlockKitChannel({
  webhookUrl: 'https://hooks.slack.com/services/...',
  botToken: 'xoxb-...'
})

const discord = new DiscordChannel({
  webhookUrl: 'https://discord.com/api/webhooks/...'
})

const email = new EmailChannel({
  provider: 'sendgrid',
  apiKey: 'SG.xxx',
  from: 'notifications@yourapp.com'
})

// Or use the factory
const channel = createChannel('slack', { webhookUrl: '...' })
```

## Slack BlockKit Channel

Full support for Slack's Block Kit with approval workflows and form inputs.

### Sending Messages

```typescript
const slack = new SlackBlockKitChannel({
  webhookUrl: 'https://hooks.slack.com/services/T00/B00/xxx'
})

// Simple message
await slack.send({ message: 'Hello team!' })

// With channel targeting (requires botToken)
await slack.send({
  message: 'Deployment complete',
  channel: '#deployments'
})

// With approval blocks
await slack.send({
  message: 'Approval needed',
  blocks: buildApprovalBlocks({
    message: 'Deploy v2.0 to production?',
    requestId: 'deploy-123',
    actions: [
      { label: 'Approve', value: 'approve', style: 'primary' },
      { label: 'Reject', value: 'reject', style: 'danger' }
    ]
  })
})
```

### Building Blocks

```typescript
import { buildApprovalBlocks, buildFormBlocks } from 'lib/channels'

// Approval blocks with custom actions
const approvalBlocks = buildApprovalBlocks({
  message: 'Refund request for $500',
  requestId: 'refund-456',
  actions: [
    { label: 'Approve', value: 'approve', style: 'primary' },
    { label: 'Reject', value: 'reject', style: 'danger' },
    { label: 'Review', value: 'review' }
  ]
})

// Form blocks
const formBlocks = buildFormBlocks({
  fields: [
    { name: 'reason', type: 'text', label: 'Reason' },
    {
      name: 'priority',
      type: 'select',
      label: 'Priority',
      options: ['low', 'medium', 'high']
    }
  ]
})
```

### Handling Interactions

```typescript
const response = await slack.handleInteraction({
  type: 'block_actions',
  user: { id: 'U123', name: 'alice' },
  actions: [{ action_id: 'approve_deploy-123', value: 'approve' }]
})
// => { action: 'approve', userId: 'U123', requestId: 'deploy-123' }
```

## Discord Channel

Support for Discord webhooks with embeds and interactive buttons.

### Sending Messages

```typescript
const discord = new DiscordChannel({
  webhookUrl: 'https://discord.com/api/webhooks/xxx/yyy'
})

// Simple message
await discord.send({ message: 'Hello!' })

// With embeds and buttons
await discord.send({
  message: 'Approval Required',
  embeds: [buildEmbed({
    title: 'Refund Request',
    description: 'Customer requests $500 refund',
    color: 0x5865F2,
    fields: [
      { name: 'Customer', value: 'Alice', inline: true },
      { name: 'Amount', value: '$500', inline: true }
    ],
    timestamp: true
  })],
  components: [buildActionRow({
    requestId: 'refund-789',
    actions: [
      { label: 'Approve', value: 'approve', style: 'success' },
      { label: 'Reject', value: 'reject', style: 'danger' }
    ]
  })]
})
```

### Building Components

```typescript
import { buildEmbed, buildActionRow } from 'lib/channels'

const embed = buildEmbed({
  title: 'Deploy to Production',
  description: 'Version 2.0.0 is ready',
  color: 0x00FF00,
  fields: [
    { name: 'Branch', value: 'main', inline: true },
    { name: 'Commits', value: '15', inline: true }
  ],
  timestamp: true
})

const actionRow = buildActionRow({
  requestId: 'deploy-001',
  actions: [
    { label: 'Approve', value: 'approve', style: 'primary' },
    { label: 'Reject', value: 'reject', style: 'secondary' },
    { label: 'More Info', value: 'https://example.com', style: 'link' }
  ]
})
```

## Email Channel

HTML email templates with SendGrid and Resend provider support.

### Configuration

```typescript
const email = new EmailChannel({
  provider: 'sendgrid', // or 'resend'
  apiKey: 'SG.xxx',
  from: 'notifications@yourapp.com',
  tracking: { opens: true }
})
```

### Sending Emails

```typescript
// Notification email
await email.send({
  to: 'alice@example.com',
  subject: 'Deployment Complete',
  message: 'Version 2.0 deployed successfully'
})

// With custom HTML
await email.send({
  to: 'bob@example.com',
  subject: 'Weekly Report',
  message: 'See attached',
  html: '<h1>Custom HTML</h1>'
})
```

### Email Templates

```typescript
import { renderApprovalEmail, renderNotificationEmail } from 'lib/channels'

// Approval email with Approve/Reject buttons
const html = renderApprovalEmail({
  message: 'Customer requests refund of $500',
  requestId: 'refund-123',
  baseUrl: 'https://app.yourapp.com',
  metadata: {
    customer: 'Alice',
    amount: '$500',
    reason: 'Product defect'
  }
})

// Simple notification
const notificationHtml = renderNotificationEmail({
  subject: 'Task Completed',
  message: 'Your export is ready for download'
})
```

## MDXUI Chat Channel

Real-time chat interactions through Durable Objects with MDX content support.

### Basic Usage

```typescript
const chat = new MDXUIChatChannel({
  env: { USER_DO: env.USER_DO },
  realtime: true
})

// Send a message
await chat.send({
  userId: 'user-123',
  message: 'Your order has shipped!'
})

// Send with MDX content
await chat.send({
  userId: 'user-123',
  message: 'Review the changes',
  mdxContent: `
    ## Code Review

    <CodeBlock language="typescript">
    const x = 1
    </CodeBlock>

    <Button onClick={() => approve()}>Approve</Button>
  `
})
```

### Waiting for Responses

```typescript
await chat.send({
  userId: 'user-123',
  message: 'Approve this deployment?'
})

const response = await chat.waitForResponse({ timeout: 60000 })
// => { action: 'approve', data: {} }
```

### Chat Conversations

```typescript
import { ChatConversation } from 'lib/channels'

const conversation = new ChatConversation({
  userId: 'user-123',
  initialMessage: 'How can I help you today?',
  actions: [
    { label: 'Check Status', value: 'status' },
    { label: 'Get Help', value: 'help' }
  ],
  form: {
    fields: [
      { name: 'query', type: 'text', label: 'Search' },
      { name: 'urgent', type: 'boolean', label: 'Urgent?' }
    ]
  }
})

conversation.addMessage({ role: 'user', content: 'Check my order' })
```

## Channel Registry

The global registry provides factory methods for creating channels.

```typescript
import { channelRegistry, createChannel } from 'lib/channels'

// Check available types
channelRegistry.types() // => ['slack', 'discord', 'email', 'mdxui']

// Create instances (type-safe)
const slack = channelRegistry.create('slack', { webhookUrl: '...' })
const discord = channelRegistry.create('discord', { webhookUrl: '...' })
const email = channelRegistry.create('email', {
  provider: 'sendgrid',
  apiKey: '...',
  from: '...'
})

// Convenience function
const channel = createChannel('slack', { webhookUrl: '...' })
```

## Shared Types

```typescript
import type {
  Action,
  StyledAction,
  HumanResponse,
  ChannelType
} from 'lib/channels'

interface Action {
  label: string
  value: string
}

interface StyledAction extends Action {
  style?: 'primary' | 'secondary' | 'success' | 'danger' | 'link'
}

interface HumanResponse {
  action: string
  userId: string
  requestId?: string
  data?: Record<string, unknown>
}

type ChannelType = 'slack' | 'discord' | 'email' | 'mdxui'
```

## Utility Functions

```typescript
import {
  generateMessageId,
  withTimeout,
  parseActionId,
  buildActionId
} from 'lib/channels'

// Generate unique message ID
const id = generateMessageId() // 'msg_1234567890_abc123'

// Wrap promise with timeout
const result = await withTimeout(fetch(url), 5000)

// Parse action IDs from interactions
const { action, requestId } = parseActionId('approve_req-123')
// => { action: 'approve', requestId: 'req-123' }

// Build action ID string
const actionId = buildActionId('approve', 'req-123')
// => 'approve_req-123'
```

## Related

- [Human Escalation](/docs/lib/humans) - Template literal syntax for humans
- [Human-in-the-Loop](/docs/humans) - High-level patterns
- [Approval Workflows](/docs/humans/approval-workflows) - Building approval chains
