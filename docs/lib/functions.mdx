---
title: Function Registry
description: Register, discover, and compose typed functions with the FunctionRegistry
---

# Function Registry

The `FunctionRegistry` provides centralized management of function definitions with type-based indexing, tag-based discovery, and metadata management.

## Overview

```typescript
import { FunctionRegistry, createRegistry } from 'lib/functions/FunctionRegistry'

const registry = new FunctionRegistry()

registry.registerCode({
  name: 'processOrder',
  handler: async (input) => { /* ... */ }
}, { tags: ['orders', 'core'] })

registry.registerGenerative({
  name: 'summarize',
  model: 'claude-sonnet-4-20250514',
  prompt: 'Summarize: {{text}}'
})

// Find functions by type
const codeFunctions = registry.findByType('code')

// Find by tag
const orderFunctions = registry.findByTag('orders')
```

## Registration

### Register Code Functions

```typescript
registry.registerCode({
  name: 'calculateTotal',
  description: 'Calculate order total with tax',
  handler: async (input, ctx) => {
    const { items, taxRate } = input
    const subtotal = items.reduce((sum, item) =>
      sum + item.price * item.quantity, 0
    )
    return {
      subtotal,
      tax: subtotal * taxRate,
      total: subtotal * (1 + taxRate)
    }
  }
}, {
  tags: ['math', 'orders'],
  version: '1.0.0',
  author: 'engineering'
})
```

### Register Generative Functions

```typescript
registry.registerGenerative({
  name: 'generateProductDescription',
  model: 'claude-sonnet-4-20250514',
  prompt: 'Write a compelling product description for: {{product}}',
  temperature: 0.8,
  maxTokens: 500
}, {
  tags: ['ai', 'content'],
  deprecated: false
})
```

### Register Agentic Functions

```typescript
registry.registerAgentic({
  name: 'researchCompetitor',
  model: 'claude-opus-4-20250514',
  goal: 'Research competitor and summarize findings',
  tools: ['web_search', 'scrape_url', 'summarize']
}, {
  tags: ['research', 'ai'],
  version: '2.0.0'
})
```

### Register Human Functions

```typescript
registry.registerHuman({
  name: 'approveRefund',
  channel: 'slack:finance',
  prompt: 'Approve refund of {{amount}} for {{customer}}?',
  timeout: 14400000
}, {
  tags: ['approvals', 'finance']
})
```

## Discovery

### Find by Type

```typescript
// All code functions
const codeFns = registry.findByType('code')

// All human functions
const humanFns = registry.findByType('human')

// Multiple types
const fns = registry.find({ type: ['code', 'generative'] })
```

### Find by Tags

```typescript
// Single tag
const orderFns = registry.findByTag('orders')

// All tags must match
const fns = registry.findByTags(['orders', 'core'])
```

### Find by Name Pattern

```typescript
// String contains
const fns = registry.find({ name: 'order' })

// Regex pattern
const fns = registry.find({ name: /^process/ })
```

### Complex Filters

```typescript
const results = registry.find({
  type: 'code',
  tags: ['orders'],
  name: /Handler$/,
  deprecated: false
})
```

## Metadata Management

### Update Metadata

```typescript
registry.updateMetadata('processOrder', {
  description: 'Updated description',
  tags: ['orders', 'core', 'v2'],
  version: '2.0.0'
})
```

### Deprecate Functions

```typescript
registry.deprecate('oldFunction', 'Use newFunction instead')

// Find deprecated functions
const deprecated = registry.find({ deprecated: true })
```

## Statistics

```typescript
const stats = registry.getStats()
// {
//   total: 15,
//   byType: { code: 8, generative: 4, agentic: 2, human: 1 },
//   deprecated: 2,
//   tags: Map { 'orders' => 5, 'ai' => 6, ... }
// }
```

## Import/Export

```typescript
// Export registry to JSON
const data = registry.toJSON()
fs.writeFileSync('functions.json', JSON.stringify(data))

// Import from JSON
const newRegistry = new FunctionRegistry()
newRegistry.fromJSON(JSON.parse(fs.readFileSync('functions.json')))
```

## Default Registry

For convenience, a singleton registry is available:

```typescript
import { getDefaultRegistry } from 'lib/functions/FunctionRegistry'

const registry = getDefaultRegistry()
registry.registerCode({ name: 'myFn', handler: () => {} })
```

## Error Handling

```typescript
import {
  FunctionNotFoundError,
  FunctionAlreadyExistsError,
  FunctionValidationError
} from 'lib/functions/FunctionRegistry'

try {
  registry.register({ name: 'invalid!name', type: 'code', handler: () => {} })
} catch (error) {
  if (error instanceof FunctionValidationError) {
    console.error('Invalid function definition:', error.message)
  }
}
```

## Function Config Types

```typescript
interface CodeFunctionConfig {
  type: 'code'
  name: string
  description?: string
  handler: (input: unknown, ctx: FunctionContext) => unknown
}

interface GenerativeFunctionConfig {
  type: 'generative'
  name: string
  model: string
  prompt: string | ((input: unknown) => string)
  temperature?: number
  maxTokens?: number
  schema?: object
}

interface AgenticFunctionConfig {
  type: 'agentic'
  name: string
  model: string
  goal: string
  tools: string[]
  maxIterations?: number
}

interface HumanFunctionConfig {
  type: 'human'
  name: string
  channel: string
  prompt: string | ((input: unknown) => string)
  timeout: number
  escalation?: { timeout: number; to: string }
}
```

## Related

- [createFunction Factory](/docs/functions/create-function) - Create function instances
- [Function Composition](/docs/functions/composition) - Chain and compose functions
- [Function Middleware](/docs/functions/middleware) - Add cross-cutting concerns
