---
title: Response Utilities
description: JSON-LD style API response builders with linked data properties
---

# Response Utilities (lib/response/)

The response module provides utilities for building consistent API responses with JSON-LD style linked data properties (`$context`, `$type`, `$id`). These utilities ensure all API responses follow a uniform format with proper hypermedia links.

## Overview

| Module | Purpose |
|--------|---------|
| `linked-data.ts` | Build responses with $context, $type, $id |
| `collection.ts` | Paginated collection responses |
| `urls.ts` | URL builders for type and ID URLs |
| `links.ts` | Navigation link builders |
| `pagination.ts` | Cursor-based pagination utilities |
| `actions.ts` | Clickable action builders |
| `relationships.ts` | Entity relationship links |

## Linked Data Response

Build responses with JSON-LD style properties for semantic web compatibility.

### Basic Response

```typescript
import { buildResponse } from 'lib/response/linked-data'

const customer = buildResponse(
  { name: 'Alice', email: 'alice@example.com' },
  { ns: 'https://api.example.com', type: 'Customer', id: 'alice' }
)

// Result:
// {
//   $context: 'https://api.example.com',
//   $type: 'https://api.example.com/customers',
//   $id: 'https://api.example.com/customers/alice',
//   name: 'Alice',
//   email: 'alice@example.com'
// }
```

### Collection Response

```typescript
const customers = buildResponse(
  { items: [], count: 0 },
  { ns: 'https://api.example.com', type: 'Customer', isCollection: true }
)

// Result:
// {
//   $context: 'https://api.example.com',
//   $type: 'https://api.example.com/customers',
//   $id: 'https://api.example.com/customers',
//   items: [],
//   count: 0
// }
```

### Root Response (DO Level)

```typescript
const startup = buildResponse(
  { name: 'My Startup', founded: 2024 },
  {
    ns: 'https://my-startup.do',
    type: 'Startup',
    isRoot: true,
    parent: 'https://startups.do'
  }
)

// Result:
// {
//   $context: 'https://startups.do',  // Uses parent for context
//   $type: 'https://my-startup.do',   // Root uses ns as type
//   $id: 'https://my-startup.do',     // Root uses ns as id
//   name: 'My Startup',
//   founded: 2024
// }
```

## Error Response

Build standardized error responses:

```typescript
import { buildErrorResponse } from 'lib/response/linked-data'

const error = buildErrorResponse('NOT_FOUND', 'Customer not found: alice')

// Result:
// {
//   $type: 'Error',
//   code: 'NOT_FOUND',
//   message: 'Customer not found: alice'
// }
```

### Error Codes

| Code | HTTP Status | Use Case |
|------|-------------|----------|
| `NOT_FOUND` | 404 | Resource does not exist |
| `BAD_REQUEST` | 400 | Invalid request format |
| `DUPLICATE` | 409 | Resource already exists |
| `CREATE_FAILED` | 500 | Creation operation failed |
| `UPDATE_FAILED` | 500 | Update operation failed |
| `DELETE_FAILED` | 500 | Delete operation failed |
| `METHOD_NOT_ALLOWED` | 405 | HTTP method not supported |
| `UNSUPPORTED_MEDIA_TYPE` | 415 | Content-Type not supported |
| `INTERNAL_ERROR` | 500 | Unexpected server error |

## Collection Response Builder

Build paginated, filterable collection responses:

```typescript
import { buildCollectionResponse } from 'lib/response/collection'

const items = [
  { id: 'alice', name: 'Alice' },
  { id: 'bob', name: 'Bob' }
]

const response = buildCollectionResponse(items, 100, {
  ns: 'https://api.example.com',
  type: 'Customer',
  pagination: {
    after: 'cursor_abc',
    hasNext: true,
    hasPrev: false
  },
  facets: {
    sort: ['name', 'createdAt'],
    filter: { status: ['active', 'pending'] }
  },
  customActions: ['export', 'bulkDelete']
})
```

### Collection Response Structure

```typescript
interface CollectionResponse<T> {
  $context: string
  $type: string
  $id: string
  count: number
  links: {
    home: string
    self: string
    first: string
    next?: string
    prev?: string
    last?: string
  }
  facets?: {
    sort?: string[]
    filter?: Record<string, string[]>
  }
  actions: {
    create: { method: 'POST', href: string }
    [custom: string]: { method: string, href: string }
  }
  items: Array<T & {
    $context: string
    $type: string
    $id: string
    links: Record<string, string>
  }>
}
```

### Nested Collections (with Parent Context)

```typescript
const orders = buildCollectionResponse(
  [{ id: 'ord-1', total: 99.99 }],
  50,
  {
    ns: 'https://api.example.com',
    type: 'Order',
    parent: 'https://api.example.com/customers/alice'
  }
)

// Items will have:
// $context: 'https://api.example.com/customers/alice'
// $type: 'https://api.example.com/customers/alice/orders'
// $id: 'https://api.example.com/customers/alice/orders/ord-1'
```

## URL Builders

Low-level URL construction utilities:

### Type URL

```typescript
import { buildTypeUrl, pluralize } from 'lib/response/urls'

buildTypeUrl('https://api.example.com', 'Customer')
// => 'https://api.example.com/customers'

buildTypeUrl('https://api.example.com', 'Category')
// => 'https://api.example.com/categories'

// Pluralization handles irregular forms
pluralize('person')   // => 'people'
pluralize('child')    // => 'children'
pluralize('category') // => 'categories'
```

### ID URL

```typescript
import { buildIdUrl } from 'lib/response/urls'

buildIdUrl('https://api.example.com', 'Customer', 'alice')
// => 'https://api.example.com/customers/alice'

// Special characters are URL-encoded
buildIdUrl('https://api.example.com', 'Customer', 'user@domain.com')
// => 'https://api.example.com/customers/user%40domain.com'
```

### Context URL

```typescript
import { buildContextUrl } from 'lib/response/urls'

// Standard context
buildContextUrl('https://api.example.com')
// => 'https://api.example.com'

// Root with parent
buildContextUrl('https://my-startup.do', { isRoot: true, parent: 'https://startups.do' })
// => 'https://startups.do'

// Orphan DO (no parent)
buildContextUrl('https://my-do.do', { isRoot: true, type: 'Startup' })
// => 'https://schema.org.ai/Startup'
```

### Namespace Normalization

```typescript
import { normalizeNs } from 'lib/response/urls'

normalizeNs('https://api.example.com/')  // => 'https://api.example.com'
normalizeNs('https://api.example.com')   // => 'https://api.example.com'
```

## Pagination

Cursor-based pagination utilities:

```typescript
import {
  paginate,
  createCursor,
  parseCursor,
  buildPaginationMeta,
  DEFAULT_LIMIT,
  MAX_LIMIT
} from 'lib/response/pagination'

// Paginate an array
const result = paginate(allItems, { limit: 20 })
// => { data: [...20 items...], meta: { total, limit, hasMore, cursor } }

// Get next page
const page2 = paginate(allItems, { limit: 20, cursor: result.meta.cursor })

// Build pagination metadata manually
const meta = buildPaginationMeta({
  limit: 20,
  totalItems: 100,
  currentOffset: 0,
  lastItemKey: 'item-20'
})
```

### Pagination Types

```typescript
interface PaginationParams {
  limit?: number           // Max items (default: 20, max: 100)
  cursor?: string          // Opaque cursor from previous response
  direction?: 'forward' | 'backward'
  offset?: number          // Deprecated, prefer cursor
}

interface PaginationMeta {
  total?: number           // Total count (optional for performance)
  limit: number            // Actual limit used
  hasMore: boolean         // More items exist
  cursor?: string          // Next page cursor
  prevCursor?: string      // Previous page cursor
}
```

## Item Links

Build navigation links for items:

```typescript
import { buildItemLinks } from 'lib/response/links'

const links = buildItemLinks({
  ns: 'https://api.example.com',
  type: 'Customer',
  id: 'alice'
})

// => {
//   self: 'https://api.example.com/customers/alice',
//   collection: 'https://api.example.com/customers',
//   edit: 'https://api.example.com/customers/alice'
// }
```

## Response Options

```typescript
interface ResponseOptions {
  /** Namespace URL like "https://api.example.com" */
  ns: string
  /** Entity type in PascalCase, e.g., "Customer" */
  type: string
  /** Entity ID, e.g., "alice" (undefined for collection) */
  id?: string
  /** Parent namespace for root responses */
  parent?: string
  /** True if this is the DO root response */
  isRoot?: boolean
  /** True for collection responses */
  isCollection?: boolean
}
```

## Full Example

Complete example showing all response builders together:

```typescript
import { buildResponse, buildErrorResponse } from 'lib/response/linked-data'
import { buildCollectionResponse } from 'lib/response/collection'

// In a Hono route handler
app.get('/customers', async (c) => {
  const customers = await db.query('SELECT * FROM customers')

  return c.json(buildCollectionResponse(
    customers,
    customers.length,
    {
      ns: c.req.url.split('/customers')[0],
      type: 'Customer',
      pagination: { hasNext: false }
    }
  ))
})

app.get('/customers/:id', async (c) => {
  const customer = await db.get(c.req.param('id'))

  if (!customer) {
    return c.json(
      buildErrorResponse('NOT_FOUND', `Customer not found: ${c.req.param('id')}`),
      404
    )
  }

  return c.json(buildResponse(customer, {
    ns: c.req.url.split('/customers')[0],
    type: 'Customer',
    id: customer.id
  }))
})
```

## Type Exports

```typescript
import type {
  ResponseOptions,
  LinkedDataResponse,
  ErrorResponse,
  ErrorCode,
  CollectionResponse,
  CollectionResponseOptions,
  ClickableAction,
  PaginationParams,
  PaginationMeta,
  PaginatedResult,
  CursorPosition
} from 'lib/response'
```

## Related

- [REST Router](/docs/objects/rest-router) - DO REST API routing
- [RPC](/docs/lib/rpc) - RPC response format
- [API Design](/docs/api/design) - API design guidelines
