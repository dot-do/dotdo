name = "dotdo-v2"
# Main entry exports all DO classes for wrangler bindings
main = "objects/index.ts"
compatibility_date = "2024-12-30"

[durable_objects]
bindings = [
  { name = "DOCore", class_name = "DOCore" },
  { name = "DOSemantic", class_name = "DOSemantic" },
  { name = "DOStorage", class_name = "DOStorageClass" },
  { name = "DOWorkflow", class_name = "DOWorkflowClass" },
  { name = "DOFull", class_name = "DOFull" },
  { name = "MCP", class_name = "McpServer" }
]

[[migrations]]
tag = "v1"
new_sqlite_classes = ["DOCore"]

[[migrations]]
tag = "v2"
new_classes = ["McpServer"]

[[migrations]]
tag = "v3"
new_sqlite_classes = ["DOSemantic", "DOStorageClass", "DOWorkflowClass", "DOFull"]

# KV namespace for OAuth session storage
[[kv_namespaces]]
binding = "OAUTH_KV"
id = "placeholder-oauth-kv-id"
preview_id = "placeholder-oauth-kv-preview-id"

# AI binding for tool execution
[ai]
binding = "AI"

# Rate limiting binding for MCP server
# Uses Cloudflare's native rate limiting across edge locations
[[ratelimits]]
name = "RATE_LIMITER"
namespace_id = "1001"
# 100 requests per 60 second window per unique key
simple = { limit = 100, period = 60 }

# Environment variables (set via wrangler secret or .dev.vars)
# WORKOS_API_KEY = "sk_..."
# WORKOS_CLIENT_ID = "client_..."
# OAUTH_REDIRECT_URI = "https://..."
# JWT_SECRET = "..."

# ============================================================================
# CORS Configuration
# ============================================================================
# CORS origins can be configured via the ALLOWED_ORIGINS environment variable.
# If not set, sensible defaults are used based on the ENVIRONMENT setting.
#
# Development defaults (when ENVIRONMENT != 'production'):
#   - http://localhost:3000
#   - http://localhost:5173
#   - http://localhost:8787
#   - http://127.0.0.1:3000
#   - http://127.0.0.1:5173
#   - http://127.0.0.1:8787
#
# Production defaults (when ENVIRONMENT = 'production'):
#   - https://dotdo.dev
#   - https://api.dotdo.dev
#   - https://app.dotdo.dev
#
# Example configuration:
# [vars]
# ALLOWED_ORIGINS = "https://app.example.com,https://api.example.com"
# ENVIRONMENT = "production"
#
# For staging environments:
# [env.staging.vars]
# ALLOWED_ORIGINS = "https://staging.example.com,https://preview.example.com"
# ENVIRONMENT = "staging"
